---
title: Shellå­¦ä¹ 
date: 2018-12-15 12:10:46
tags: 
    - Shell
categories: 
    - Linux
---

ğŸ’ 

- 1. [å­¦ä¹ Shell](#å­¦ä¹ shell)
    - 1.1. [shellç±»åˆ«](#shellç±»åˆ«)
    - 1.2. [æ‰§è¡Œæ–¹å¼](#æ‰§è¡Œæ–¹å¼)
- 2. [åŸºç¡€ç»“æ„](#åŸºç¡€ç»“æ„)
    - 2.1. [è¾“å…¥è¾“å‡º](#è¾“å…¥è¾“å‡º)
        - 2.1.1. [è¾“å…¥](#è¾“å…¥)
        - 2.1.2. [è¾“å‡º](#è¾“å‡º)
    - 2.2. [å˜é‡](#å˜é‡)
        - 2.2.1. [å˜é‡ä½œç”¨åŸŸ](#å˜é‡ä½œç”¨åŸŸ)
        - 2.2.2. [åµŒå¥—](#åµŒå¥—)
    - 2.3. [æ•°æ®ç±»å‹](#æ•°æ®ç±»å‹)
        - 2.3.1. [æ•´å‹](#æ•´å‹)
        - 2.3.2. [å­—ç¬¦ä¸²](#å­—ç¬¦ä¸²)
        - 2.3.3. [æ•°ç»„](#æ•°ç»„)
    - 2.4. [ç»“æ„](#ç»“æ„)
        - 2.4.1. [ä¼ é€’å‚æ•°](#ä¼ é€’å‚æ•°)
        - 2.4.2. [åˆ¤æ–­](#åˆ¤æ–­)
            - 2.4.2.1. [if](#if)
            - 2.4.2.2. [case](#case)
        - 2.4.3. [å¾ªç¯](#å¾ªç¯)
    - 2.5. [å‡½æ•°](#å‡½æ•°)
    - 2.6. [å¤šçº¿ç¨‹](#å¤šçº¿ç¨‹)
    - 2.7. [å®šæ—¶æ‰§è¡Œ](#å®šæ—¶æ‰§è¡Œ)
        - 2.7.1. [watch](#watch)
        - 2.7.2. [sleep](#sleep)
- 3. [é›†æˆ](#é›†æˆ)
    - 3.1. [æ–‡ä»¶å¤„ç†](#æ–‡ä»¶å¤„ç†)
        - 3.1.1. [é…ç½®æ–‡ä»¶](#é…ç½®æ–‡ä»¶)
            - 3.1.1.1. [iniå’Œconf](#iniå’Œconf)
        - 3.1.2. [shyaml](#shyaml)
    - 3.2. [è„šæœ¬çš„å‚æ•°è‡ªåŠ¨è¡¥å…¨](#è„šæœ¬çš„å‚æ•°è‡ªåŠ¨è¡¥å…¨)
        - 3.2.1. [Bash](#bash)
        - 3.2.2. [Zsh](#zsh)
- 4. [Tips](#tips)
    - 4.1. [å¸¸ç”¨ä»£ç ç‰‡æ®µ](#å¸¸ç”¨ä»£ç ç‰‡æ®µ)

ğŸ’  2024-09-20 11:10:09
****************************************
# å­¦ä¹ Shell
> [Shell ç¼–ç¨‹ä¹‹è¯­æ³•åŸºç¡€](https://linuxtoy.org/archives/shell-programming-basic.html) | [Shell ç¼–ç¨‹ä¹‹æ‰§è¡Œè¿‡ç¨‹](https://linuxtoy.org/archives/shell-programming-execute.html)  

> [èœé¸Ÿæ•™ç¨‹: Shell æ•™ç¨‹](http://www.runoob.com/linux/linux-shell.html)  
> [Cè¯­è¨€ä¸­æ–‡ç½‘: Shellæ•™ç¨‹](http://c.biancheng.net/shell/)  

> [å‚è€ƒ: ç¼–å†™ Bash Shell è„šæœ¬çš„æœ€ä½³å®è·µ](https://blog.mythsman.com/post/5d2ab67ff678ba2eb3bd346f/)  

************************

> [shellcheck](https://github.com/koalaman/shellcheck)`Shellè¯­æ³•æ£€æµ‹`  
> [cmd-wrapped](https://github.com/YiNNx/cmd-wrapped)`ç»Ÿè®¡å‘½ä»¤æ‰§è¡Œå†å²`  

## shellç±»åˆ«
> åˆ‡æ¢é»˜è®¤shell `chsh -s /bin/zsh`

- sh
    - å¤§å¤šLinuxéƒ½æ”¯æŒçš„shellç±»åˆ«
- bash
- zsh
  - é«˜æ‰©å±•æ€§ [é…ç½®oh my zsh](https://segmentfault.com/a/1190000004695131)
- dash
    - å®ƒä¸»è¦æ˜¯ä¸ºäº†æ‰§è¡Œè„šæœ¬è€Œå‡ºç°ï¼Œè€Œä¸æ˜¯äº¤äº’ï¼Œå®ƒé€Ÿåº¦æ›´å¿«ï¼Œä½†åŠŸèƒ½ç›¸æ¯”bashè¦å°‘å¾ˆå¤šï¼Œè¯­æ³•ä¸¥æ ¼éµå®ˆPOSIXæ ‡å‡†
    - é€Ÿåº¦ç¡®å®è¦å¿«,è¾“å…¥ä¸Šçš„äº¤äº’ç¡®å®äº¤äº’ä¸äº†
- fish
    - äº¤äº’å¼çš„, è¡¥å…¨åŠŸèƒ½æ¯”è¾ƒå¥½ 

> [å‚è€ƒ: å¸¸è§shellç±»å‹](http://www.cnblogs.com/happycxz/p/7840077.html)  
> [Github: zsh guide](https://github.com/goreliu/zshguide)  

*******************

## æ‰§è¡Œæ–¹å¼
- [sourceå‘½ä»¤](http://blog.csdn.net/xiaolang85/article/details/7861441) | [ç‚¹å’Œsourceå‘½ä»¤](http://www.cnblogs.com/my_life/articles/4323528.html)

- æ–‡ä»¶å¤´éƒ¨ `#!/bin/sh`è¡¨ç¤ºè¦ä½¿ç”¨shè§£é‡Šå™¨æ¥æ‰§è¡Œ, å¯ä»¥æ›¿æ¢æˆbash dash
    -  åªè¦è¯¥æ–‡ä»¶å…·æœ‰æ‰§è¡Œæƒé™å°±å¯ä»¥ç›´æ¥è¿è¡Œäº† `./a.sh` æˆ–è€…ç»å¯¹è·¯å¾„

- [pueue](https://github.com/Nukesor/pueue)`shellåå°æ‰§è¡Œé˜Ÿåˆ—`

**********************
# åŸºç¡€ç»“æ„
## è¾“å…¥è¾“å‡º
### è¾“å…¥
- `read answer`

å¤„ç†ç®¡é“çš„è¾“å…¥ä¹Ÿæ˜¯ä½¿ç”¨ read
```sh
while read line; do
  echo $line
done
```

- `select`

```sh
  echo "What is your favourite OS?"
  select var in "Linux" "Gnu Hurd" "Free BSD" "Other"; do
    break;
  done
  echo "You have selected $var"
```
### è¾“å‡º
echo  printf 

> printf
1. åŸæ ·è¾“å‡ºå­—ç¬¦ä¸²:
    - printf("%s", str);
2. è¾“å‡ºæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸², è¶…é•¿æ—¶ä¸æˆªæ–­, ä¸è¶³æ—¶å³å¯¹é½:
    - printf("%Ns", str);  N ä¸ºæŒ‡å®šé•¿åº¦çš„10è¿›åˆ¶æ•°å€¼
3. è¾“å‡ºæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸², è¶…é•¿æ—¶ä¸æˆªæ–­, ä¸è¶³æ—¶å·¦å¯¹é½:
    - printf("%-Ns", str); N ä¸ºæŒ‡å®šé•¿åº¦çš„10è¿›åˆ¶æ•°å€¼
4. è¾“å‡ºæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸², è¶…é•¿æ—¶æˆªæ–­, ä¸è¶³æ—¶å³å¯¹é½: 
    - printf("%N.Ms", str);  N ä¸ºæœ€ç»ˆçš„å­—ç¬¦ä¸²è¾“å‡ºé•¿åº¦  M ä¸ºä»å‚æ•°å­—ç¬¦ä¸²ä¸­å–å‡ºçš„å­ä¸²é•¿åº¦
5. è¾“å‡ºæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸², è¶…é•¿æ—¶æˆªæ–­, ä¸è¶³æ—¶å·¦å¯¹é½æ˜¯:
    - printf("%-N.Ms", str);  N ä¸ºæœ€ç»ˆçš„å­—ç¬¦ä¸²è¾“å‡ºé•¿åº¦  M ä¸ºä»å‚æ•°å­—ç¬¦ä¸²ä¸­å–å‡ºçš„å­ä¸²é•¿åº¦
6. ä¸Šè¿°N,Mæ˜¯å¯ä»¥åŠ¨æ€æŒ‡å®šçš„ï¼Œæ–¹æ³•æ˜¯ç”¨*ä»£æ›¿Mæˆ–è€…Nï¼Œç„¶ååœ¨å‚æ•°åˆ—è¡¨é‡ŒåŠ ä¸Šä¸€ä¸ªæ•°å­—å‚æ•°ã€‚
    - `printf("%-*.*s", 5, 2, "123");`  ç­‰ä»·äº `printf("%-5.2s", "123");`
    - `printf("%*s", 5, "123");` `printf("%5s", "123");`

******************
## å˜é‡

- è·å–å‘½ä»¤è¾“å‡ºä½œä¸ºå˜é‡
    - `$(ls)`
    - ``` `ls` ```

### å˜é‡ä½œç”¨åŸŸ
> æ¯”Pythonçš„ä½œç”¨åŸŸæ›´åŠ å®½æ³›å’Œä¸å¯æ§ï¼Œå¼•ç”¨ä¸€ä¸ªå˜é‡æ—¶éœ€è¦æ³¨æ„å€¼çš„æ¥æºã€‚

### åµŒå¥—
```sh
    # å®ç°äº†è¯»å– A_hostå˜é‡çš„å€¼
    perfix='A_'
    name=${perfix}host
    host=${!name}
```

> [shellå°†å˜é‡å½“å‘½ä»¤æ‰§è¡Œé—®é¢˜](http://www.bitscn.com/os/linux/201505/506409.html)

1. `${command}` æ‰§è¡Œ commandå˜é‡ å†…å®¹
    - `echo ${command} |awk '{run=$0;system(run)}'` æ¨èæ–¹å¼

*****************
## æ•°æ®ç±»å‹
### æ•´å‹

- è‡ªå¢ï¼š
    - i=$(( $i + 1 )) _dash sh éƒ½æœ‰æ•ˆ_
    - ((a++))
    - ``` i=`expr $i + 1`;```
    - let i+=1;
    - i=$[$i+1];
- å–ä½™
    - i=$(( $i % 3))

> [å–éšæœºæ•°](http://www.cnblogs.com/chengmo/archive/2010/10/23/1858879.html)

- å››åˆ™è¿ç®— [å‚è€ƒåšå®¢ ](https://blog.csdn.net/taijianyu/article/details/6907288)
  - ((i=$j+$k))     ç­‰ä»·äº   i=`expr $j + $k`
  - ((i=$j-$k))     ç­‰ä»·äº   i=`expr $j -$k`
  - ((i=$j*$k))     ç­‰ä»·äº   i=`expr $j \*$k`
  - ((i=$j/$k))     ç­‰ä»·äº   i=`expr $j /$k`

_åˆ¤æ–­å˜é‡æ˜¯å¦ä¸ºæ•°å€¼_
> [åšå®¢ åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å€¼](http://www.jb51.net/article/67468.htm)
```sh
  if [ "$1" -gt 0 ] 2>/dev/null ;then 
    echo "$1 is number." 
  else 
    echo 'no.' 
  fi 
```

************************

### å­—ç¬¦ä¸²
- [å­—ç¬¦ä¸²æˆªå–](https://www.2cto.com/os/201305/208219.html) | [Blog:å˜é‡å­—ç¬¦ä¸²æˆªå–](http://www.jb51.net/article/56563.htm) | [Shellæ­£åˆ™](http://man.linuxde.net/docs/shell_regex.html)
> [å­—ç¬¦ä¸²æ“ä½œ](https://www.cnblogs.com/gaochsh/p/6901809.html)

| Pattern | æè¿° ||
|:----|:----|:---|
| `${varible#*str}`  | æˆªå– `é¦–ä¸ª` |str `å³` çš„å­—ç¬¦ä¸² |
| `${varible##*str}` | æˆªå– `æœ€æœ«` |str `å³` çš„å­—ç¬¦ä¸² |
| `${varible%%str*}` | æˆªå– `é¦–ä¸ª` |str `å·¦` çš„å­—ç¬¦ä¸² |
| `${varible%str*}`  | æˆªå– `æœ€æœ«` |str `å·¦` çš„å­—ç¬¦ä¸² |

1. `${varible:start:end}` å®šé•¿æˆªå–
  - `${varible:4}` ç¬¬å››ä¸ªå­—ç¬¦åˆ°ç»“æŸ
1. `ls -al | cut -d "." -f 2` å–å¸¸è§„æ–‡ä»¶åç¼€å

************************

**`è·å–å‘½ä»¤çš„è¾“å‡º`**
- ä½¿ç”¨  ä¿å­˜ç»“æœçš„å˜é‡å=`éœ€è¦æ‰§è¡Œçš„linuxå‘½ä»¤` è¿™ç§æ–¹å¼æ¥è·å–å‘½ä»¤çš„è¾“å‡ºæ—¶ï¼Œæ³¨æ„çš„æƒ…å†µæ€»ç»“å¦‚ä¸‹ï¼š
- 1ï¼‰ä¿è¯åå•å¼•å·å†…çš„å‘½ä»¤æ‰§è¡Œæ—¶æˆåŠŸçš„ï¼Œä¹Ÿå°±æ˜¯æ‰€å‘½ä»¤æ‰§è¡Œå$?çš„è¾“å‡ºå¿…é¡»æ˜¯0ï¼Œå¦åˆ™è·å–ä¸åˆ°å‘½ä»¤çš„è¾“å‡º
- 2ï¼‰å³ä¾¿æ˜¯å‘½ä»¤çš„è¿”å›å€¼æ˜¯0ï¼Œä¹Ÿéœ€è¦ä¿è¯ç»“æœæ˜¯é€šè¿‡æ ‡å‡†è¾“å‡ºæ¥è¾“å‡ºçš„ï¼Œè€Œä¸æ˜¯æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™éœ€è¦é‡å®šå‘
- å› æ­¤æˆ‘ä»¬æ¨èä½¿ç”¨  ä¿å­˜ç»“æœçš„å˜é‡å=`éœ€è¦æ‰§è¡Œçš„linuxå‘½ä»¤ 2>&1 `çš„æ–¹å¼æ¥è·å–å‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚

- è¾“å‡ºå˜é‡æ—¶: `$var`ä¼šä¸¢å¤±æ¢è¡Œå’Œç©ºæ ¼ `"$var"`ä¸ä¼š

`å­—ç¬¦ä¸²çš„åŒ…å«é—®é¢˜`
```sh
  isGithub=`expr match "$line" ".*"$2`
  # ç®€å•çš„å°±æ˜¯ä½¿ç”¨grep
  isGithub=`echo $line | grep "github" `
  # return 0 is $1 is substring of $2, otherwise 1
  strIsSubstring(){
      local x=1
      case "$2" in
          *$1*) x=0;;
      esac
      echo $x
  }
```
_æ±‚é•¿_ ```${#var}```

_å­—ç¬¦ä¸²æ‹†åˆ†æˆæ•°ç»„_
> [ä¿®æ”¹åˆ†éš”ç¬¦](http://www.cnblogs.com/FlyFive/p/3640243.html) | [ä¸‰ç§æ–¹æ³•æ¦‚è¿°](https://blog.csdn.net/bitcarmanlee/article/details/50973454)

1. å¦‚æœæ˜¯ç©ºæ ¼åˆ†å‰²çš„å­—ç¬¦ä¸²
    - ç›´æ¥ `for element in $target`

************************

### æ•°ç»„

> [shellå¤„ç†æ—¶é—´æ ¼å¼](http://blog.csdn.net/superbfly/article/details/52453334)
************************

## ç»“æ„

### ä¼ é€’å‚æ•°
> [å‚è€ƒåšå®¢](http://www.cnblogs.com/FrankTan/archive/2010/03/01/1634516.html) `å‘½ä»¤è¡Œé€‰é¡¹ å‚æ•°å¤„ç†`

| å‚æ•° | è¯´æ˜ |
|:----:|:----|
| `$#` | ä¼ é€’åˆ°è„šæœ¬çš„å‚æ•°ä¸ªæ•°
| `$*` | ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ã€‚ä»¥"$1 $2 â€¦ $n"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚
| `$$` | è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå·
| `$!` | åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„IDå·
| `$@` | ä¸$*ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨æ—¶åŠ å¼•å· ä»¥"$1" "$2" â€¦ "$n" çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚
| `$-` | æ˜¾ç¤ºShellä½¿ç”¨çš„å½“å‰é€‰é¡¹ï¼Œä¸setå‘½ä»¤åŠŸèƒ½ç›¸åŒã€‚
| `$?` | æ˜¾ç¤ºæœ€åå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ã€‚0è¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–ä»»ä½•å€¼è¡¨æ˜æœ‰é”™è¯¯ã€‚

> è¯»å–è„šæœ¬å‚æ•° 
```sh
  # 1. ç®€å•çš„æ–¹å¼
  case $1 in 
    -h | h)
      echo "help"
    ;;
    *)
      echo "default"
    ;;
  esac

  # 2. è§„èŒƒåŒ–çš„å‚æ•°
  while getopts "hup:" opt; do
    case "$opt" in
      h)
        usage
        exit 0
        ;;
      u)
        UPCASE=true
        ;;
      d)
        DATE=$OPTARG
        ;;
    esac
  done
```

### åˆ¤æ–­
#### if
- [å‚è€ƒåšå®¢](http://www.cnblogs.com/276815076/archive/2011/10/30/2229286.html)

æ³¨æ„æ–¹æ‹¬å·æ ¼å¼æ—¶ï¼Œå†…éƒ¨è¦ç•™ä¸€ä¸ªç©ºæ ¼ï¼Œå¦åˆ™ä¼šæŠ¥ è¯­æ³•é”™è¯¯ 

_åˆ¤æ–­æ–‡ä»¶_
- æ–‡ä»¶å­˜åœ¨ `if [ -e path ]`
    - -r å¯è¯»
    - -f å­˜åœ¨ï¼Œè€Œä¸”æ˜¯æ™®é€šæ–‡ä»¶
    - -s å­˜åœ¨ä¸”æ–‡ä»¶å¤§å°å¤§äº0å­—èŠ‚
- é“¾æ¥å­˜åœ¨ `if [ -L path ]`
- ç›®å½•å­˜åœ¨ `if [ -d path ]`

- æ•´æ•°æ¯”è¾ƒ
    - `-eq` ç­‰äº,å¦‚:if [ "$a" -eq "$b" ]
    - `-ne` ä¸ç­‰äº,å¦‚:if [ "$a" -ne "$b" ]
    - `-gt` å¤§äº,å¦‚:if [ "$a" -gt "$b" ]
    - `-ge` å¤§äºç­‰äº,å¦‚:if [ "$a" -ge "$b" ]
    - `-lt` å°äº,å¦‚:if [ "$a" -lt "$b" ]
    - `-le` å°äºç­‰äº,å¦‚:if [ "$a" -le "$b" ]
    - `å¤§äº` (éœ€è¦åŒæ‹¬å·),å¦‚:(("$a" > "$b"))
    - `>= `å¤§äºç­‰äº(éœ€è¦åŒæ‹¬å·),å¦‚:(("$a" >= "$b"))

- å­—ç¬¦ä¸²æ¯”è¾ƒ
    - `if [ "$root"x = 'x' ]` åˆ¤æ–­æ˜¯å¦ä¸ºç©º
        - `if test -z "$repo_path";`
    - `if [ $(echo $str | grep -e '$str1') ]` åˆ¤æ–­åŒ…å«
    - `if [[ $a == z* ]]` æ¨¡å¼åŒ¹é…ï¼Œä½†æ˜¯ä¸æ˜¯ä¸¥æ ¼æ­£åˆ™è¡¨è¾¾å¼æ ¼å¼

- åˆ¤æ–­æ•°ç»„åŒ…å« `if [[ "${ary[@]}" =~ "$a" ]]`
    - å…¶ä¸­ ary=(1 2 3); a=2; 

#### case

```sh
  case $content in 
    -h|h)
      echo "help"
    ;;
    *)
      echo "å‰é¢å…¨éƒ¨ä¸åŒ¹é…æ‰ä¼šæ‰§è¡Œ"
    ;;
  esac
```
### å¾ªç¯
- [å‚è€ƒåšå®¢](http://www.cnblogs.com/fhefh/archive/2011/04/15/2017233.html)

> for
```sh
  for i in $(seq 1 5); do
    echo $i
  done

  for (( a=0; a<10; a++)) do
    echo $a;
  done
```

> while
```sh
    i=1
    while [ "$i" -le 10 ];do
        echo $i
        i=$(($i+1))
    done
```

> é€è¡Œéå†å‘½ä»¤çš„è¾“å‡º
```sh
  while read -r proc; do
      #do work
  done <<< "$(ps -ewo pid,cmd,etime | grep python | grep -v grep | grep -v sh)"
```

> Tips 
1. break continue: breakèƒ½è·³å‡ºå¤šå±‚å¾ªç¯ï¼Œåªéœ€å¸¦ä¸Šæ•°å­— `break num`ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæ— å‚çš„breaké»˜è®¤å¸¦äº†1å‚æ•°
1. done åé¢å¯ä»¥é‡å®šå‘ï¼Œå°†å¾ªç¯çš„è¾“å‡ºè½¬åˆ°æ–‡ä»¶è€Œä¸æ˜¯ç»ˆç«¯: `for do done > loop.log`

*****************

## å‡½æ•°
> Shellçš„å‡½æ•°åªèƒ½è¿”å›æ•´å‹æ•°æ®ç±»å‹

- å®šä¹‰å‡½æ•°
    - `function a {}`
    - `a(){}`
    - æ³¨æ„ï¼š
        - Shellæ˜¯è§£é‡Šæ‰§è¡Œï¼Œå¿…é¡»å…ˆå®šä¹‰ï¼Œç„¶åè°ƒç”¨ï¼Œè€Œä¸”å‡½æ•°æ²¡æœ‰é‡è½½ï¼Œåªè¦†ç›–
        - å‘½ä»¤è¡Œå†…å®šä¹‰å‡½æ•°: `function hi { echo hi;};` æ³¨æ„å·¦æ‹¬å·å’Œå‘½ä»¤çš„ç©ºæ ¼ï¼Œä»¥åŠå‘½ä»¤;ç»“å°¾

```sh
    simple(){
        echo "simple"
    }

    zero(){
        return 0
    }
    # å‡½æ•°é€€å‡ºçŠ¶æ€ç ï¼ˆ0-255ï¼‰
    echo "return "$?
    
    # ä½¿ç”¨è¾“å‡ºè¿”å›å€¼
    result=$(simple)
```
- å¼•ç”¨ shell æ–‡ä»¶ `source shellæ–‡ä»¶ç›¸å¯¹è·¯å¾„` sourceå¯ä»¥ç®€å†™ä¸º `.`

## å¤šçº¿ç¨‹
> [å‚è€ƒ: shellå¦‚ä½•å®ç°å¤šçº¿ç¨‹](https://www.cnblogs.com/signjing/p/7074778.html)  

************************

## å®šæ—¶æ‰§è¡Œ
### watch
> execute a program periodically, showing output fullscreen

- -d é«˜äº®å·®å¼‚æ•°æ®

watch ç­‰å¾…å‘½ä»¤å¯¹åº”è¿›ç¨‹æ‰§è¡Œå®Œæˆåæ‰è¿›å…¥è®¡æ—¶åˆ°ä¸‹ä¸€ä¸ªå‘¨æœŸæ‰§è¡Œï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥æ‰§è¡Œå¼‚æ­¥shell

> demo.sh 
```sh 
for i in $(seq 1 100); do
  doSomething &
done
```

watch demo.sh è¾¾åˆ°çš„æ•ˆæœä¸ºï¼šç­‰åˆ°shä¸­çš„100ä¸ªå­è¿›ç¨‹æ‰§è¡Œç»“æŸåï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œæ‰ä¼šç­‰2så†æ‰§è¡Œä¸€æ¬¡demo.sh 

### sleep

**********************
# é›†æˆ
## æ–‡ä»¶å¤„ç†
> è¯»å–å½“å‰ç›®å½•æ–‡ä»¶

```bash
    for file in ./*
    do
        if test -f "$file"
        then
            echo "$file æ˜¯æ–‡ä»¶"
        fi
        if test -d "$file"
        then
            echo "$file æ˜¯ç›®å½•"
        fi
    done
```

> è¯»å–æ–‡ä»¶è¡Œ
```bash
    # 1
    while IFS= read -r -u3 line; do
        echo "$line"
    done 3< "$2"

    # 2
    cat a.log | while read line; do
        echo "line: "$line;
    done
```

1. å½“å‰ç›®å½•åˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºåˆ›å»ºçš„æ–‡ä»¶å `mktmp data.XXXXXX`
  - `-t` åœ¨ /tmp/ç›®å½•ä¸‹åˆ›å»ºï¼Œå¹¶è¿”å›å…¨è·¯å¾„
  - `-d` åˆ›å»ºç›®å½•

1. è¾“å‡ºåˆ°ç»ˆç«¯å¹¶å†™å…¥æ–‡ä»¶ `echo "test" | tee a.log`
1. åŸºäºæ¨¡æ¿å¿«é€Ÿåˆ›å»ºå¤šä»½é…ç½®æ–‡ä»¶ 
    ```sh
        REPLICA=01 SHARD=01 envsubst < config.xml > clickhouse01/config.xml
        REPLICA=02 SHARD=01 envsubst < config.xml > clickhouse02/config.xml
    ```
    - config.xml ä¸­ä½¿ç”¨`${}`åšå ä½ç¬¦ ä¾‹å¦‚ï¼š `<interserver_http_host>clickhouse${REPLICA}</interserver_http_host>`

### é…ç½®æ–‡ä»¶

#### iniå’Œconf
```conf
  [block]
  name=myth
```
- å¦‚æœæ²¡æœ‰ `[block]` è¿™æ ·çš„å£°æ˜å°±å¯ä»¥å½“shç”¨, ç›´æ¥ source file å°±åŠ è½½äº†é…ç½®å†…å®¹

### shyaml
> [å‚è€ƒ](https://linuxtoy.org/archives/shyaml.html)

********************

## è„šæœ¬çš„å‚æ•°è‡ªåŠ¨è¡¥å…¨
> [å‚è€ƒ: å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŸç† ](http://www.cnblogs.com/wang_yb/p/5969451.html)

### Bash

### Zsh
> æ›´ä¸ºç›´è§‚, ç®€å•

å­¦ä¹ æ€ä¹ˆä½¿ç”¨çš„è¯, å¯ä»¥çœ‹ä¸Šé¢çš„åšå®¢(è™½ç„¶æœ‰ç‚¹ç®€é™‹), ä½†æ˜¯å¦‚æœæ˜¯ oh-my-zsh çš„ç”¨æˆ·, å¯ä»¥ç›´æ¥çœ‹åˆ«äººçš„æ’ä»¶, æ¨¡ä»¿å°±è¡Œäº†, ä¾‹å¦‚ redis-cli æ’ä»¶çš„è‡ªåŠ¨è¡¥å…¨, å°±å¾ˆç®€å•ç›´æ¥
1. `#compdef redis-cli rec` è¿™ç¬¬ä¸€è¡Œå¾ˆé‡è¦, å®šä¹‰äº†æ˜¯å¯¹å“ªä¸ªå‘½ä»¤æˆ–è„šæœ¬çš„è‡ªåŠ¨è¡¥å…¨

************************

# Tips
> [hyperfine](https://github.com/sharkdp/hyperfine)å‘½ä»¤å‹æµ‹å·¥å…·

- set -x å¼€å¯è°ƒè¯• æ¯æ¡å®é™…æ‰§è¡Œçš„å‘½ä»¤éƒ½ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°
  - set +x å…³é—­è°ƒè¯•

## å¸¸ç”¨ä»£ç ç‰‡æ®µ 

1. è·å–å‘½åæˆ–å‡½æ•°æ ‡å‡†è¾“å‡º: åå¼•å· **\`cmd\`**  æˆ–è€… **$(cmd)**
1. æ£€æŸ¥å½“å‰ç”¨æˆ·ä¸ºRootç”¨æˆ·
    ```sh
        if [ $(id -u) != "0" ]; then
            printf $red"Please use root to run this script\n"$end
            exit 1
        fi
    ```
1. kill è„šæœ¬è¿›ç¨‹
    ```sh
        id=`ps -ef | grep "WithRedis.py" | grep -v "grep" | grep -v "\-d" | awk '{print $2}'`
        if [ "${id}1" = "1" ];then
            printf $red"not exist background running script\n"$end
        else
            kill -9 $id
        fi
    ```
1. å¾—åˆ°è„šæœ¬ç»å¯¹è·¯å¾„; `å¦‚æœè„šæœ¬å†…æ‰§è¡Œ pwd åªä¼šå¾—åˆ°æ‰§è¡Œè„šæœ¬æ—¶ä¼šè¯çš„ç»å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯è„šæœ¬çš„è·¯å¾„`
    ```sh
        basepath=$(cd \`dirname $0\`; pwd) 
    ```
