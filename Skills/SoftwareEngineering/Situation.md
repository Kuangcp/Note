---
title: 场景&方案
date: 2023-09-22 16:56:45
tags: 
categories: 
    - Engineering
    - WIKI
---

💠

- 1. [方向需求](#方向需求)
    - 1.1. [书籍](#书籍)
    - 1.2. [Topic](#topic)
    - 1.3. [系统重构](#系统重构)
- 2. [业务需求](#业务需求)
    - 2.1. [账号安全认证体系](#账号安全认证体系)
    - 2.2. [消息推送](#消息推送)
    - 2.3. [延迟消息](#延迟消息)
    - 2.4. [千万级数据导入](#千万级数据导入)
    - 2.5. [千万级数据导出](#千万级数据导出)
    - 2.6. [商品秒杀](#商品秒杀)
- 3. [数据需求](#数据需求)
    - 3.1. [数据血缘方案](#数据血缘方案)
    - 3.2. [汉字-拼音 处理](#汉字-拼音-处理)
    - 3.3. [敏感词匹配](#敏感词匹配)
    - 3.4. [OCR](#ocr)
- 4. [面试场景需求](#面试场景需求)
    - 4.1. [系统设计类](#系统设计类)
    - 4.2. [性能优化类](#性能优化类)
    - 4.3. [架构演进类](#架构演进类)
    - 4.4. [故障处理类](#故障处理类)
    - 4.5. [技术选型类](#技术选型类)
    - 4.6. [团队协作类](#团队协作类)
- 4. [面试场景需求](#面试场景需求)
    - 4.1. [系统设计类](#系统设计类)
    - 4.2. [性能优化类](#性能优化类)
    - 4.3. [架构演进类](#架构演进类)
    - 4.4. [故障处理类](#故障处理类)
    - 4.5. [技术选型类](#技术选型类)
    - 4.6. [团队协作类](#团队协作类)

💠 2025-05-13 14:25:46
****************************************
# 方向需求
> 关于问题的解决方案

> [饿了么交易系统 5 年演化史 ](http://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&mid=2247489228&idx=1&sn=9baeb5d2cfef853c80068ce8e830ccb2&chksm=fdeb24acca9cadba8ab2055243a97a13b561ee4b3ab0ffba1ab2c8fa7caeae2de0f13b80213e&mpshare=1&scene=1&srcid=&sharer_sharetime=1587047061042&sharer_shareid=246c4b52c1cb45eaa580c985c95107f3#rd)

## 书籍
淘宝技术这十年
亿级流量网站架构核心技术

## Topic
1. 完整设计一个支持数十亿规模的用户系统
1. 如何设计一个支持千万设备推送的消息系统
1. 简单实现一个消息中间件保证消息不重复不丢失
1. 如何设计供应链正逆向系统
1. 如何设计财务对账系统

## 系统重构
> [知乎社区核心业务 Golang 化实践](https://zhuanlan.zhihu.com/p/48039838)`Python所开发的模块使用Go重写`

场景:

思考点:

************************

# 业务需求
> [Admol/SystemDesign: 系统设计面试：内幕指南](https://github.com/Admol/SystemDesign)  

[Global Burden of Disease](https://ghdx.healthdata.org)

## 账号安全认证体系
> [被脱裤也不怕 - 反馈总结](https://blog.coderzh.com/2016/01/13/password-security-additional/)

![](img/auth-and-store.drawio.svg)

## 消息推送
站内信： [站内信设计思路之己见（基于上百万用户）](http://www.cnblogs.com/x-xk/archive/2012/11/17/2770935.html)

## 延迟消息
> [ 手把手实现一条延时消息 ](https://www.cnblogs.com/crossoverJie/p/11605814.html)



## 千万级数据导入
场景: 将数据库外的千万或亿级Excel CSV txt等文件导入到数据库

思考点:
1. 导入时 用户并发,数据库资源控制
    - 操作的频率, 导入的效率
1. 应用层资源优化,JVM内存 CPU占用
    - 需要按实际导入端,考虑是经过JVM应用层处理,还是直接利用数据库的附属工具或机制
1. 落库的类型和特点: NoSQL 或 关系型数据库
    - 

方案:

> NoSQL
- MongoDB
- Elasticsearch

> 关系型数据库
1. MySQL
    - 
1. Clickhouse 
    - 
1. GreenPlum 
    - copy 方式, 不经过应用端去做 数据解析和写入

## 千万级数据导出
场景: 数据库内大表输出为 csv,Excel  

思考点: 
- 导出时 用户并发及数据库资源控制
    - 如何在应用层接入端去感知数据库的资源状态, 协同控制并发频率 (比如: 应用层接受到请求,参考数据库资源状态设置并发数和导出数据量的约束, 而不是设置抽象的限流策略)
- 字段多且大存储高
    - 如何平衡数据导出效率 和 应用JVM投入资源
- 使用独占长连接完整SQL查询数据库 和 共享连接查询分批SQL 的取舍 `简单理解为分页和不分页`
    - 独占连接: 完整SQL查询然后不关闭连接使用游标分批去数据库fetch数据, 最后汇总
    - 共享连接: SQL层加分页或者条件范围 查询小批结果集, 最后汇总

方案:
- Java应用层面可以使用JDBC长连接 游标方式查询数据分批读写

## 商品秒杀
[Seckill](https://github.com/hfbin/Seckill)


************************


# 数据需求
## 数据血缘方案
核心流程为 采集 解析 图计算 存储 展示

- 采集： 依据数据库的类型 采集到完备的DML DDL语句(create select, insert,update)， 例如MySQL可解析binlog Greenplum可解析审计日志 等等。
- 解析： ANTLR4将SQL解析为AST，遍历得到每层子查询，每句SQL的有向图
- 图计算： 将前文的若干有向图 合并为一个大图 得到复杂SQL 和 一批独立SQL 完整正确的图，从而得到完整的血缘关系(入度为0 源表，出度为0 目标表)
    - Gremlin Gephi 
- 存储： 图数据库存储以上解析出的全部的图，需考虑节点的唯一标识
- 展示： 图查询,需前端解决海量节点数时的性能问题
- 生命周期或快照： 从业务和存储上来看，此类数据会一直累积，最后图会成为垃圾堆，可监听删除类型的DDL，移除对应的节点和边。以及依据业务特点定期快照历史数据，重建图

> Greenplum/Hive 血缘解析落地方案： 采集SQL，ANTLR4解析为AST 调试规则文件，解析合并图，存入Atlas，查询Atlas

> [讲讲元数据](https://ganjiacheng.cn/article/2020/article_3_%E8%AE%B2%E8%AE%B2%E5%85%83%E6%95%B0%E6%8D%AE/)  
## 汉字-拼音 处理
汉字转换拼音，首字母模糊搜索等功能。

主要实现方案:

1. 开源库
    - pinyin4j: Java最常用的拼音库
    - TinyPinyin: 适合Android使用的轻量级拼音库
    - pinyin-plus: 支持多音字、拼音音调等功能
    - JPinyin: 支持中文转拼音、简繁转换等

2. 自定义实现
    - 基于Unicode编码范围判断汉字
    - 使用拼音字典映射表
    - 结合分词提高多音字准确率

3. 云服务
    - 百度翻译API
    - 有道翻译API
    - 阿里云自然语言处理服务

选型建议:
- 离线场景建议使用pinyin4j等开源库
- 对准确率要求高可使用云服务
- 需要定制化功能可自行实现

> [汉字转拼音项目pinyin-plus开源](http://www.kailing.pub/article/index/arcid/326.html)

## 敏感词匹配
主要实现方案:

1. 暴力匹配
    - 遍历文本和敏感词列表进行匹配
    - 性能较差,不适合大规模使用

2. Trie树(字典树)
    - 将敏感词构建成树形结构,共享前缀
    - 查找效率高,空间利用率好
    - 适合大规模敏感词库

3. DFA(确定有限状态自动机)
    - 基于状态转移的匹配算法
    - 构建敏感词库状态机,快速匹配
    - 内存占用相对较大

4. AC自动机
    - 结合了Trie树和KMP算法
    - 支持多模式串匹配
    - 适合大规模文本过滤
    - 构建复杂但匹配效率高

5. Double-Array Trie
    - Trie树的压缩存储方式
    - 内存占用小,查询性能好
    - 适合静态词库

选型建议:
- 小规模词库可用Trie树
- 大规模实时过滤推荐AC自动机
- 注重内存占用可选Double-Array Trie


> [KMP、Trie树 、AC自动机‌ ，三大算法实现 netty 敏感词 优雅 过滤 - 技术自由圈 - 博客园](https://www.cnblogs.com/crazymakercircle/p/18901384)  

Trie树, Double-Array Trie
AC自动机(Trie树+KMP)
DFA

> [hankcs/AhoCorasickDoubleArrayTrie: An extremely fast implementation of Aho Corasick algorithm based on Double Array Trie.](https://github.com/hankcs/AhoCorasickDoubleArrayTrie)  

> [houbb/sensitive-word: 👮‍♂️The sensitive word tool for java)](https://github.com/houbb/sensitive-word)  

## OCR
Optical Character Recognition

- 云厂商 例如阿里云，腾讯云等。
- [tesseract](https://github.com/tesseract-ocr/tesseract)
> [opendatalab/MinerU: A high-quality tool for convert PDF to Markdown and JSON.一站式开源高质量数据提取工具，将PDF转换成Markdown和JSON格式。](https://github.com/opendatalab/MinerU)  

> [AI大模型实现图片OCR识别 - 掘金](https://juejin.cn/post/7436165603590701091)  

************************

# 面试场景需求
> 从面试应聘角度补充的常见场景需求

## 系统设计类

### 短链接系统
场景: 设计一个短链接服务，将长URL转换为短链接

思考点:
- 短链接生成算法(自增ID、哈希、随机字符串)
- 数据库设计(短链接、原URL、创建时间、过期时间)
- 高并发读写优化(缓存、分库分表)
- 防刷机制和安全性考虑
- 统计功能(点击量、来源分析)

### 分布式ID生成
场景: 设计一个分布式环境下的唯一ID生成服务

思考点:
- 各种ID生成算法对比(雪花算法、UUID、数据库自增)
- 时钟回拨问题处理
- 性能优化(批量生成、本地缓存)
- 高可用设计(多机房部署、故障转移)

### 搜索引擎
场景: 设计一个支持千万级文档的搜索引擎

思考点:
- 倒排索引设计
- 分词和索引构建
- 查询优化(布尔查询、短语查询、模糊查询)
- 分布式架构(分片、副本)
- 实时性和一致性平衡

### 分布式缓存
场景: 设计一个分布式缓存系统

思考点:
- 一致性哈希算法
- 缓存穿透、击穿、雪崩问题
- 过期策略和淘汰算法
- 集群管理和故障恢复
- 监控和运维

## 性能优化类

### 数据库性能优化
场景: 系统响应慢，需要优化数据库性能

思考点:
- SQL优化(索引、查询计划、分页)
- 数据库架构优化(读写分离、分库分表)
- 连接池优化
- 慢查询监控和分析
- 缓存策略

### JVM调优
场景: 应用频繁GC，内存使用率高

思考点:
- GC算法选择和参数调优
- 内存泄漏排查
- 堆内存和元空间配置
- GC日志分析
- 性能监控工具使用

### 接口性能优化
场景: 接口响应时间过长，需要优化

思考点:
- 异步处理
- 缓存策略
- 数据库查询优化
- 并发处理
- 限流和降级

## 架构演进类

### 单体到微服务
场景: 单体应用需要拆分为微服务

思考点:
- 服务拆分原则(DDD、业务边界)
- 服务间通信(RPC、消息队列)
- 数据一致性(分布式事务、最终一致性)
- 服务治理(注册发现、配置中心、熔断降级)
- 部署和运维

### 数据库分库分表
场景: 单库数据量过大，需要分库分表

思考点:
- 分片策略(水平分片、垂直分片)
- 分布式事务处理
- 跨库查询优化
- 数据迁移方案
- 扩容和缩容

### 缓存架构演进
场景: 从单机缓存到分布式缓存

思考点:
- 缓存一致性策略
- 缓存穿透、击穿、雪崩解决方案
- 多级缓存设计
- 缓存预热和更新策略
- 监控和告警

## 故障处理类

### 线上故障排查
场景: 生产环境出现故障，需要快速定位和解决

思考点:
- 日志分析和监控
- 性能指标分析(CPU、内存、网络、磁盘)
- 数据库连接和锁问题
- 网络和中间件问题
- 回滚和应急方案

### 数据一致性修复
场景: 分布式系统中出现数据不一致

思考点:
- 数据校验和修复工具
- 补偿机制设计
- 数据同步策略
- 监控和告警
- 预防措施

### 系统降级和熔断
场景: 依赖服务不可用时的处理策略

思考点:
- 熔断器模式实现
- 降级策略设计
- 限流算法选择
- 监控和告警
- 恢复策略

## 技术选型类

### 消息队列选型
场景: 需要选择消息队列中间件

思考点:
- 性能对比(Kafka、RocketMQ、RabbitMQ)
- 可靠性要求
- 运维复杂度
- 生态和社区支持
- 成本考虑

### 数据库选型
场景: 新项目需要选择数据库

思考点:
- 业务特点(OLTP、OLAP)
- 数据量和并发量
- 一致性要求
- 扩展性需求
- 运维成本

### 缓存选型
场景: 需要选择合适的缓存方案

思考点:
- 性能要求
- 数据一致性要求
- 持久化需求
- 集群管理复杂度
- 运维成本

## 团队协作类

### 代码质量保证
场景: 团队代码质量参差不齐，需要建立质量保证体系

思考点:
- 代码规范制定
- 静态代码分析工具
- 代码审查流程
- 自动化测试
- 持续集成/持续部署

### 技术债务管理
场景: 系统存在大量技术债务，需要制定管理策略

思考点:
- 技术债务识别和评估
- 重构优先级排序
- 重构策略和计划
- 风险控制
- 团队协作

### 知识分享和传承
场景: 团队技术能力提升和知识传承

思考点:
- 技术分享机制
- 文档管理
- 新人培训体系
- 技术评审流程
- 最佳实践总结

************************

# 面试场景需求
> 从面试应聘角度补充的常见场景需求

## 系统设计类

### 短链接系统
场景: 设计一个短链接服务，将长URL转换为短链接

思考点:
- 短链接生成算法(自增ID、哈希、随机字符串)
- 数据库设计(短链接、原URL、创建时间、过期时间)
- 高并发读写优化(缓存、分库分表)
- 防刷机制和安全性考虑
- 统计功能(点击量、来源分析)

### 分布式ID生成
场景: 设计一个分布式环境下的唯一ID生成服务

思考点:
- 各种ID生成算法对比(雪花算法、UUID、数据库自增)
- 时钟回拨问题处理
- 性能优化(批量生成、本地缓存)
- 高可用设计(多机房部署、故障转移)

### 搜索引擎
场景: 设计一个支持千万级文档的搜索引擎

思考点:
- 倒排索引设计
- 分词和索引构建
- 查询优化(布尔查询、短语查询、模糊查询)
- 分布式架构(分片、副本)
- 实时性和一致性平衡

### 分布式缓存
场景: 设计一个分布式缓存系统

思考点:
- 一致性哈希算法
- 缓存穿透、击穿、雪崩问题
- 过期策略和淘汰算法
- 集群管理和故障恢复
- 监控和运维

## 性能优化类

### 数据库性能优化
场景: 系统响应慢，需要优化数据库性能

思考点:
- SQL优化(索引、查询计划、分页)
- 数据库架构优化(读写分离、分库分表)
- 连接池优化
- 慢查询监控和分析
- 缓存策略

### JVM调优
场景: 应用频繁GC，内存使用率高

思考点:
- GC算法选择和参数调优
- 内存泄漏排查
- 堆内存和元空间配置
- GC日志分析
- 性能监控工具使用

### 接口性能优化
场景: 接口响应时间过长，需要优化

思考点:
- 异步处理
- 缓存策略
- 数据库查询优化
- 并发处理
- 限流和降级

## 架构演进类

### 单体到微服务
场景: 单体应用需要拆分为微服务

思考点:
- 服务拆分原则(DDD、业务边界)
- 服务间通信(RPC、消息队列)
- 数据一致性(分布式事务、最终一致性)
- 服务治理(注册发现、配置中心、熔断降级)
- 部署和运维

### 数据库分库分表
场景: 单库数据量过大，需要分库分表

思考点:
- 分片策略(水平分片、垂直分片)
- 分布式事务处理
- 跨库查询优化
- 数据迁移方案
- 扩容和缩容

### 缓存架构演进
场景: 从单机缓存到分布式缓存

思考点:
- 缓存一致性策略
- 缓存穿透、击穿、雪崩解决方案
- 多级缓存设计
- 缓存预热和更新策略
- 监控和告警

## 故障处理类

### 线上故障排查
场景: 生产环境出现故障，需要快速定位和解决

思考点:
- 日志分析和监控
- 性能指标分析(CPU、内存、网络、磁盘)
- 数据库连接和锁问题
- 网络和中间件问题
- 回滚和应急方案

### 数据一致性修复
场景: 分布式系统中出现数据不一致

思考点:
- 数据校验和修复工具
- 补偿机制设计
- 数据同步策略
- 监控和告警
- 预防措施

### 系统降级和熔断
场景: 依赖服务不可用时的处理策略

思考点:
- 熔断器模式实现
- 降级策略设计
- 限流算法选择
- 监控和告警
- 恢复策略

## 技术选型类

### 消息队列选型
场景: 需要选择消息队列中间件

思考点:
- 性能对比(Kafka、RocketMQ、RabbitMQ)
- 可靠性要求
- 运维复杂度
- 生态和社区支持
- 成本考虑

### 数据库选型
场景: 新项目需要选择数据库

思考点:
- 业务特点(OLTP、OLAP)
- 数据量和并发量
- 一致性要求
- 扩展性需求
- 运维成本

### 缓存选型
场景: 需要选择合适的缓存方案

思考点:
- 性能要求
- 数据一致性要求
- 持久化需求
- 集群管理复杂度
- 运维成本

## 团队协作类

### 代码质量保证
场景: 团队代码质量参差不齐，需要建立质量保证体系

思考点:
- 代码规范制定
- 静态代码分析工具
- 代码审查流程
- 自动化测试
- 持续集成/持续部署

### 技术债务管理
场景: 系统存在大量技术债务，需要制定管理策略

思考点:
- 技术债务识别和评估
- 重构优先级排序
- 重构策略和计划
- 风险控制
- 团队协作

### 知识分享和传承
场景: 团队技术能力提升和知识传承

思考点:
- 技术分享机制
- 文档管理
- 新人培训体系
- 技术评审流程
- 最佳实践总结
