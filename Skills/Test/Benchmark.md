
## 关注指标项

QPS 
TPS
PV
RT
CPU占用率
CPU Load 逻辑核心数1.2以下?
内存占用率
出向和入向流量


## 测试方式
1. 寻找一个初步的并发数, 执行测试, 观察记录以上指标值
1. 调整并发数,观察记录指标值, 观察不同并发数导致的数据变化规律
1. 依据以上多份数据找到并发数增长情况下 哪些指标值出现明显瓶颈,对症分析和优化

> 注意:
>- 首次确认的并发数可以通过预估 以及 历史项目的经验值
>- 输入为 并发数 总请求量, 输出为观测指标值, 相同的输入情况需要多次测量降低误差
>- 测试时需要考虑每次测试的环境差异( 数据库缓存, 应用缓存, CPU负载波动, )


## 测试环境准备
硬件配置信息: CPU,内存,硬盘,网络 
软件配置情况: 集群节点数, 集群策略, 缓存策略,网络拓扑

> Clickhouse 性能瓶颈

[Zookeeper在Clickhouse中的应用](https://zhuanlan.zhihu.com/p/366421463)  
[ReplicatedMergeTree 引擎](https://developer.aliyun.com/article/762917)  

需要协调分布式 DDL 的执行(once语义)
    - 单个节点A收到用户的分布式DDL指令
    - 节点A校验 分布式DDL 请求合法性, 在ZK 任务队列中创建Znode 上传 DDL LogEntry,节点下创建 finish和 active节点
    - 集群内所有节点消费 LogEntry队列, 将节点自身注册到active上,将处理结果写入finish节点
    - 节点A 轮询ZK检查 finish是否全部节点都完成. 以及active节点是否有超时现象.

ReplicatedMergeTree表主备节点之间的状态同步
    - 重度依赖ZK



CK架构是 每个节点都是平等的, 没有master worker的这种角色差异. 也导致了数据的协调和管理工作落在了CK上,
用户发出的指令可以落在任意的节点上执行, 默认命令都是单机执行,需要加 on cluster才会触发集群内所有节点执行对应的指令. 


1. 数据工具体系项目 产品介入, 标准开发流程, 全局视图


