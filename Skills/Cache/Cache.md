---
title: Cache
date: 2019-05-13 11:15:40
tags: 
categories: 
---

ğŸ’ 

- 1. [ç¼“å­˜](#ç¼“å­˜)
    - 1.1. [ç¼“å­˜æ·˜æ±°ç®—æ³•](#ç¼“å­˜æ·˜æ±°ç®—æ³•)
- 2. [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
    - 2.1. [å®¢æˆ·ç«¯](#å®¢æˆ·ç«¯)
    - 2.2. [æœåŠ¡ç«¯](#æœåŠ¡ç«¯)
    - 2.3. [æ•°æ®åº“](#æ•°æ®åº“)
    - 2.4. [åˆ†å¸ƒå¼ç¼“å­˜](#åˆ†å¸ƒå¼ç¼“å­˜)
        - 2.4.1. [Redis cluster](#redis-cluster)
- 3. [åœºæ™¯](#åœºæ™¯)
    - 3.1. [ç¼“å­˜é›ªå´© Cache Avalanche](#ç¼“å­˜é›ªå´©-cache-avalanche)
    - 3.2. [ç¼“å­˜ç©¿é€ Cache Penetration](#ç¼“å­˜ç©¿é€-cache-penetration)
    - 3.3. [ç¼“å­˜å‡»ç©¿/å´©æºƒ Cache Breakdown](#ç¼“å­˜å‡»ç©¿å´©æºƒ-cache-breakdown)
    - 3.4. [ç¼“å­˜ä¸€è‡´æ€§](#ç¼“å­˜ä¸€è‡´æ€§)

ğŸ’  2024-05-04 18:13:33
****************************************
# ç¼“å­˜
> ç”¨æ—¶æ•ˆå’Œç©ºé—´æ¢æ—¶é—´

> ä»Webåº”ç”¨ç³»ç»Ÿçš„æµç¨‹ä¸Šå¯åˆ†ä¸º å®¢æˆ·ç«¯ æœåŠ¡ç«¯ æ•°æ®åº“

## ç¼“å­˜æ·˜æ±°ç®—æ³•
- FIFO `First In First Out` å…ˆè¿›å…ˆå‡º
    - ä¼˜ç‚¹ï¼šå®ç°ç®€å• 
    - ç¼ºç‚¹ï¼šæœªè€ƒè™‘æ•°æ®è®¿é—®é¢‘ç‡å’Œæ—¶é—´ï¼Œå’Œå®é™…åœºæ™¯ä¸è´´å’Œã€‚
- LRU `Least Recently Used` æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨
    - å®ç°æ–¹å¼ï¼šç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰æ•°æ®çš„é“¾è¡¨ï¼Œæ–°æ•°æ®æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œå¦‚æœç¼“å­˜æ»¡äº†ï¼Œå°±ä¼šä»é“¾è¡¨å°¾éƒ¨å¼€å§‹ç§»é™¤æ•°æ®ã€‚
    - ä¼˜ç‚¹ï¼šLRUè€ƒè™‘äº†æœ€è¿‘çš„æ•°æ®è®¿é—®æ¨¡å¼ï¼Œå¯¹äºå±€éƒ¨æ€§åŸç†çš„è¡¨ç°ä¼˜ç§€ï¼Œç®€å•å®ç”¨
    - ç¼ºç‚¹ï¼šä¸èƒ½ä½“ç°æ•°æ®çš„è®¿é—®é¢‘ç‡ï¼Œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œå³ä½¿è®¿é—®é¢‘åº¦ä½ä¹Ÿä¸ä¼šè¢«æ·˜æ±°ã€‚
        - å¦‚æœä¸€ä¸ªæ•°æ®åœ¨ä¸€åˆ†é’Ÿçš„å‰59ç§’è¢«é¢‘ç¹è®¿é—®ï¼Œè€Œåœ¨æœ€åä¸€ç§’æ— ä»»ä½•è®¿é—®ï¼Œä½†æ˜¯æœ‰ä¸€æ‰¹å†·é—¨æ•°æ®åœ¨æœ€åä¸€ç§’è¿›å…¥ç¼“å­˜ï¼Œé‚£ä¹ˆçƒ­ç‚¹æ•°æ®å¯èƒ½ä¼šè¢«æ·˜æ±°æ‰ã€‚
- LFU `Least Frequently Used` æœ€è¿‘æœ€å°‘é¢‘ç‡ä½¿ç”¨
    - å®ç°æ–¹å¼ï¼šå¯¹æ¯ä¸ªåœ¨ç¼“å­˜ä¸­çš„æ•°æ®è¿›è¡Œè®¡æ•°ï¼Œè®°å½•å…¶è¢«è®¿é—®çš„æ¬¡æ•°
    - ä¼˜ç‚¹ï¼šLFUèƒ½å¤Ÿè¾ƒå¥½åœ°å¤„ç†é•¿æœŸè®¿é—®ç¨³å®šã€é¢‘ç‡è¾ƒé«˜çš„æƒ…å†µï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ç¡®ä¿é¢‘ç¹è®¿é—®çš„æ•°æ®ä¸å®¹æ˜“è¢«æ·˜æ±°ã€‚
    - ç¼ºç‚¹ï¼šå¯¹äºä¸€äº›æš‚æ—¶é«˜é¢‘è®¿é—®ä½†ä¹‹åä¸å†è®¿é—®çš„æ•°æ®ï¼ŒLFUæ— æ³•æœ‰æ•ˆå¤„ç†ã€‚å› ä¸ºè¿™äº›æ•°æ®çš„è®¿é—®æ¬¡æ•°å·²ç»éå¸¸é«˜ï¼Œä¸å®¹æ˜“è¢«æ·˜æ±°ï¼Œå¯èƒ½é€ æˆç¼“å­˜ç©ºé—´çš„æµªè´¹ã€‚
        - å¹¶ä¸”LFUéœ€è¦ç»´æŠ¤æ‰€æœ‰å¯¹è±¡çš„è®¿é—®è®¡æ•°ï¼Œè¿™å¯èƒ½ä¼šæ¶ˆè€—æ¯”è¾ƒå¤šçš„å­˜å‚¨ç©ºé—´å’Œè®¡ç®—èµ„æºã€‚
- W-TinyLFU ` Window Tiny Least Frequently Used`
    - é€šè¿‡ç»Ÿè®¡é¢‘ç‡ä¿¡æ¯æ¥é€‰æ‹©æœ€ä½³çš„å€™é€‰é¡¹è¿›è¡Œæ›¿æ¢
    - ä¼˜ç‚¹ï¼š
        - å¹³è¡¡äº†æœ€è¿‘æ€§å’Œé¢‘ç‡ï¼šä¸ LRU ç›¸æ¯”ï¼Œä¸ä»…è€ƒè™‘äº†ä½¿ç”¨é¢‘ç‡ï¼Œè¿˜è®¡ç®—äº†ç¼“å­˜çš„çƒ­é—¨ç¨‹åº¦ã€‚ä¸ LFU ç›¸æ¯”ï¼Œä¸ä¼šè®©ä»¥å‰éå¸¸çƒ­é—¨ä½†ç°åœ¨å¾ˆå°‘ä½¿ç”¨çš„æ•°æ®é•¿æ—¶é—´å ç”¨ç¼“å­˜ã€‚
        - é¢å¤–å†…å­˜å ç”¨å°ï¼š TinyLFU ä½¿ç”¨ä¸€ä¸ªå›ºå®šå¤§å°çš„è®¡æ•°æ»¤æ³¢å™¨æ¥è·Ÿè¸ªè®¿é—®é¢‘ç‡ï¼Œè¿™ä½¿å¾—å…¶å†…å­˜å ç”¨è¿œä½äºä¼ ç»Ÿçš„ LFU ç­–ç•¥ã€‚
        - é€‚åº”æ€§å¼ºï¼šå¯ä»¥æ›´å¥½åœ°é€‚åº”å·¥ä½œè´Ÿè½½çš„å˜åŒ–ï¼Œå› ä¸ºå®ƒå¯¹é¢‘ç‡çš„è®¡æ•°æœ‰ä¸€ä¸ªæ—¶é—´çª—å£
        - é¿å…ç¼“å­˜æ±¡æŸ“ï¼šç”±äºå®ƒç»´æŠ¤äº†ä¸€ä¸ª admission windowï¼Œå®ƒå¯ä»¥é¿å…ä¸€æ¬¡æ€§çš„ã€å¤§è§„æ¨¡çš„è¯·æ±‚å¯èƒ½å¸¦æ¥çš„ç¼“å­˜æ±¡æŸ“ã€‚
    - ç¼ºç‚¹ï¼š
        - éœ€è¦ç»´æŠ¤é¢å¤–çš„é¢‘ç‡ä¿¡æ¯ï¼Œå¢åŠ äº†ä¸€äº›å¼€é”€ã€‚
        - ä¸å¦‚ LRU ç®—æ³•å®ç°ç®€å•ã€‚å¯¹äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œéœ€è¦è°ƒæ•´å‚æ•°ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚


************************

# åº”ç”¨åœºæ™¯
## å®¢æˆ·ç«¯
> æµè§ˆå™¨
- é™æ€èµ„æºç¼“å­˜ï¼ŒCookieï¼Œå„ç§ *Storageï¼Œ IndexDB

> PCç«¯åŸç”Ÿ
- é…ç½®æ–‡ä»¶ï¼ŒSQLiteï¼ŒLevelDB

## æœåŠ¡ç«¯

- åº”ç”¨å†…å­˜: Javaçš„ GuavaCache Caffeine 

- [Redis](/Database/Redis.md)
- [Memcache](/Database/Memcache.md)

************************

## æ•°æ®åº“
ä¼šè¯ç¼“å­˜

MySQL Buffer Pool 

************************

## åˆ†å¸ƒå¼ç¼“å­˜
> ä½¿ç”¨åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ„å»ºå‡ºä¸€ä¸ªé›†ç¾¤ï¼Œå°†è¯»å†™å‹åŠ›æ‘Šåˆ†åˆ°é›†ç¾¤å†…èŠ‚ç‚¹ä¸Šã€‚

### Redis cluster 


************************

# åœºæ™¯

## ç¼“å­˜é›ªå´© Cache Avalanche
ç¼“å­˜å±‚å¤§é‡ç¼“å­˜è¿‡æœŸï¼Œæˆ–è€…æ•´ä¸ªç¼“å­˜å±‚å´©æºƒï¼Œ å¯¼è‡´å¤§é‡æµé‡ç›´æ¥è®¿é—®ä¸Šæ¸¸èµ„æºå±‚

## ç¼“å­˜ç©¿é€ Cache Penetration
ç¼“å­˜å±‚å’Œä¸Šæ¸¸èµ„æºå±‚éƒ½æ²¡æœ‰æŸ¥è¯¢çš„æ•°æ®

## ç¼“å­˜å‡»ç©¿/å´©æºƒ Cache Breakdown
ç¼“å­˜å±‚éƒ¨åˆ†æ•°æ®è¿‡æœŸäº†ï¼Œå¹¶ä¸”çªå¢å¤§é‡æµé‡ç›´æ¥è®¿é—®ä¸Šæ¸¸èµ„æºå±‚ï¼Œå»æŸ¥è¯¢è¿™éƒ¨åˆ†è¿‡æœŸçš„æ•°æ®

## ç¼“å­˜ä¸€è‡´æ€§
> [ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† ](http://kaito-kidd.com/2021/09/08/how-to-keep-cache-and-consistency-of-db/)
