---
title: Javaåº”ç”¨çš„éƒ¨ç½²
date: 2018-11-21 10:56:52
tags: 
    - éƒ¨ç½²
categories: 
    - Java
---

ğŸ’ 

- 1. [éƒ¨ç½²è¿è¡Œ](#éƒ¨ç½²è¿è¡Œ)
    - 1.1. [æ‰“åŒ…å¯æ‰§è¡Œjar](#æ‰“åŒ…å¯æ‰§è¡Œjar)
    - 1.2. [æ‰“åŒ…war](#æ‰“åŒ…war)
    - 1.3. [æ‰“åŒ…Dockeré•œåƒ](#æ‰“åŒ…dockeré•œåƒ)
- 2. [é…ç½®æ–‡ä»¶](#é…ç½®æ–‡ä»¶)
- 3. [Tips](#tips)
    - 3.1. [Javaåœ¨Linuxä¸Šçš„æ—¶åŒºé—®é¢˜](#javaåœ¨linuxä¸Šçš„æ—¶åŒºé—®é¢˜)
    - 3.2. [å®¹å™¨ä¸­Jvmä¿¡å·åŠå‚æ•°æ¥æ”¶é—®é¢˜](#å®¹å™¨ä¸­jvmä¿¡å·åŠå‚æ•°æ¥æ”¶é—®é¢˜)

ğŸ’  2023-12-12 00:10:45
****************************************
# éƒ¨ç½²è¿è¡Œ
> ä¼ ç»Ÿçš„å¯æ‰§è¡Œjar, war ä»¥åŠDockeré•œåƒ

> [å‚è€ƒ: JAR æ–‡ä»¶æ­å¯†](https://www.ibm.com/developerworks/cn/java/j-jar/index.html)
> [å‚è€ƒ: maven-assembly-plugin å…¥é—¨æŒ‡å—](https://www.jianshu.com/p/14bcb17b99e0)

> [Maven æ‰“åŒ…éƒ¨ç½²](/Java/Tool/Maven.md#æ‰“åŒ…éƒ¨ç½²)  |  [Gradle æ‰“åŒ…éƒ¨ç½²](/Java/Tool/Gradle.md#æ‰“åŒ…éƒ¨ç½²)  

## æ‰“åŒ…å¯æ‰§è¡Œjar
> [å…³äºMANIFEST.MFæ–‡ä»¶](https://blog.csdn.net/baileyfu/article/details/1808023)`è¿™ä¸ªæ–‡ä»¶å¾ˆé‡è¦, å¦‚æœè‡ªå·±æ‰‹åŠ¨é…ç½®å°±éœ€è¦ç¼–å†™è¯¥æ–‡ä»¶`
_MANIFEST.MFç¤ºä¾‹_
```yml
    Manifest-Version: 1.0
    Archiver-Version: Plexus Archiver
    Built-By: kcp
    Created-By: Apache Maven 3.5.3
    Build-Jdk: 1.8.0_152
    Main-Class: com.youaishujuhui.minigame.Main
```
- ç¼–è¯‘æ–‡ä»¶       `javac -d *.java `
- æ‰“åŒ…å­—èŠ‚ç æˆjar `jar -cvf hello.jar com/test/*.*` 
- æ‰“åŒ…æˆå¯æ‰§è¡Œjar `jar -cvfm hello.jar mainfest *.*` 
    - å…¶ä¸­ `mainfest` æ–‡æœ¬æ–‡ä»¶ï¼š `Main-Class: com.test.Main` 
    - å†’å·åä¸€å®šè¦æœ‰ç©ºæ ¼ï¼Œæ–‡ä»¶æœ€åä¸€è¡Œä¸€å®šç•™ç©ºè¡Œ

*************************

## æ‰“åŒ…war
> æœ€ç»ˆå°†ç”Ÿæˆçš„war æ”¾åˆ° tomcat çš„ webapps ç›®å½•ä¸‹æˆ–è€… Jettyçš„ webapps ç›®å½•ä¸‹

## æ‰“åŒ…Dockeré•œåƒ
> ä»¥ä¸€ä¸ªåŸºç¡€é•œåƒ,ç„¶åå°†waræ”¾è¿›å»æ„å»ºæˆä¸€ä¸ªé•œåƒ, ç„¶åæ¨é€åˆ°æœåŠ¡å™¨ä¸Šæ„å»ºå®¹å™¨è¿›è¡Œè¿è¡Œ

1. ç®€è¦æ¦‚æ‹¬: from jdkåŸºç¡€é•œåƒ, å°†jar å¤åˆ¶è¿›å», è®¾ç½®å¥½ CMD

> [jib](https://github.com/GoogleContainerTools/jib)
> - ç»“åˆ Maven Gradle èƒ½æ›´æ–¹ä¾¿çš„æ„å»º Dockeré•œåƒ

************************

# é…ç½®æ–‡ä»¶
> å¤šç›®æ ‡åº”ç”¨ç¯å¢ƒçš„å‘å¸ƒ, å¯ä»¥ä½¿ç”¨Maven å¤š Profile; Spring çš„å¤šprofiles; ç¯å¢ƒå˜é‡; ...

**********************

> åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®

- é€šå¸¸ï¼Œåº”ç”¨çš„ é…ç½® åœ¨ä¸åŒ éƒ¨ç½² (é¢„å‘å¸ƒã€ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒç­‰ç­‰)é—´ä¼šæœ‰å¾ˆå¤§å·®å¼‚ã€‚è¿™å…¶ä¸­åŒ…æ‹¬ï¼š
    - æ•°æ®åº“ï¼ŒMemcachedï¼Œä»¥åŠå…¶ä»– åç«¯æœåŠ¡ çš„é…ç½®
    - ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯ä¹¦ï¼Œå¦‚ Amazon S3ã€Twitter ç­‰
    - æ¯ä»½éƒ¨ç½²ç‰¹æœ‰çš„é…ç½®ï¼Œå¦‚åŸŸåç­‰

æœ‰äº›åº”ç”¨åœ¨ä»£ç ä¸­ä½¿ç”¨å¸¸é‡ä¿å­˜é…ç½®ï¼Œè¿™ä¸ 12-Factor æ‰€è¦æ±‚çš„ä»£ç å’Œé…ç½®ä¸¥æ ¼åˆ†ç¦»æ˜¾ç„¶å¤§ç›¸å¾„åº­ã€‚é…ç½®æ–‡ä»¶åœ¨å„éƒ¨ç½²é—´å­˜åœ¨å¤§å¹…å·®å¼‚ï¼Œä»£ç å´å®Œå…¨ä¸€è‡´ã€‚

åˆ¤æ–­ä¸€ä¸ªåº”ç”¨æ˜¯å¦æ­£ç¡®åœ°å°†é…ç½®æ’é™¤åœ¨ä»£ç ä¹‹å¤–ï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯çœ‹è¯¥åº”ç”¨çš„åŸºå‡†ä»£ç æ˜¯å¦å¯ä»¥ç«‹åˆ»å¼€æºï¼Œè€Œä¸ç”¨æ‹…å¿ƒä¼šæš´éœ²ä»»ä½•æ•æ„Ÿçš„ä¿¡æ¯ã€‚

éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™é‡Œå®šä¹‰çš„â€œé…ç½®â€å¹¶ä¸åŒ…æ‹¬åº”ç”¨çš„å†…éƒ¨é…ç½®ï¼Œæ¯”å¦‚ Rails çš„ config/routes.rbï¼Œæˆ–æ˜¯ä½¿ç”¨ Spring æ—¶ ä»£ç æ¨¡å—é—´çš„ä¾èµ–æ³¨å…¥å…³ç³» ã€‚è¿™ç±»é…ç½®åœ¨ä¸åŒéƒ¨ç½²é—´ä¸å­˜åœ¨å·®å¼‚ï¼Œæ‰€ä»¥åº”è¯¥å†™å…¥ä»£ç ã€‚

å¦å¤–ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œä½†ä¸æŠŠå®ƒä»¬çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå°±åƒ Rails çš„ config/database.yml ã€‚è¿™ç›¸å¯¹äºåœ¨ä»£ç ä¸­ä½¿ç”¨å¸¸é‡å·²ç»æ˜¯é•¿è¶³è¿›æ­¥ï¼Œä½†ä»ç„¶æœ‰ç¼ºç‚¹ï¼šæ€»æ˜¯ä¼šä¸å°å¿ƒå°†é…ç½®æ–‡ä»¶ç­¾å…¥äº†ä»£ç åº“ï¼›é…ç½®æ–‡ä»¶çš„å¯èƒ½ä¼šåˆ†æ•£åœ¨ä¸åŒçš„ç›®å½•ï¼Œå¹¶æœ‰ç€ä¸åŒçš„æ ¼å¼ï¼Œè¿™è®©æ‰¾å‡ºä¸€ä¸ªåœ°æ–¹æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®å˜çš„ä¸å¤ªç°å®ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œè¿™äº›æ ¼å¼é€šå¸¸æ˜¯è¯­è¨€æˆ–æ¡†æ¶ç‰¹å®šçš„ã€‚

12-Factoræ¨èå°†åº”ç”¨çš„é…ç½®å­˜å‚¨äº ç¯å¢ƒå˜é‡ ä¸­ï¼ˆ env vars, env ï¼‰ã€‚ç¯å¢ƒå˜é‡å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨ä¸åŒçš„éƒ¨ç½²é—´åšä¿®æ”¹ï¼Œå´ä¸åŠ¨ä¸€è¡Œä»£ç ï¼›ä¸é…ç½®æ–‡ä»¶ä¸åŒï¼Œä¸å°å¿ƒæŠŠå®ƒä»¬ç­¾å…¥ä»£ç åº“çš„æ¦‚ç‡å¾®ä¹å…¶å¾®ï¼›ä¸ä¸€äº›ä¼ ç»Ÿçš„è§£å†³é…ç½®é—®é¢˜çš„æœºåˆ¶ï¼ˆæ¯”å¦‚ Java çš„å±æ€§é…ç½®æ–‡ä»¶ï¼‰ç›¸æ¯”ï¼Œç¯å¢ƒå˜é‡ä¸è¯­è¨€å’Œç³»ç»Ÿæ— å…³ã€‚

é…ç½®ç®¡ç†çš„å¦ä¸€ä¸ªæ–¹é¢æ˜¯åˆ†ç»„ã€‚æœ‰æ—¶åº”ç”¨ä¼šå°†é…ç½®æŒ‰ç…§ç‰¹å®šéƒ¨ç½²è¿›è¡Œåˆ†ç»„ï¼ˆæˆ–å«åšâ€œç¯å¢ƒâ€ï¼‰ï¼Œä¾‹å¦‚Railsä¸­çš„ development,test, å’Œ production ç¯å¢ƒã€‚è¿™ç§æ–¹æ³•æ— æ³•è½»æ˜“æ‰©å±•ï¼šæ›´å¤šéƒ¨ç½²æ„å‘³ç€æ›´å¤šæ–°çš„ç¯å¢ƒï¼Œä¾‹å¦‚ staging æˆ– qa ã€‚ éšç€é¡¹ç›®çš„ä¸æ–­æ·±å…¥ï¼Œå¼€å‘äººå‘˜å¯èƒ½è¿˜ä¼šæ·»åŠ ä»–ä»¬è‡ªå·±çš„ç¯å¢ƒï¼Œæ¯”å¦‚ joes-staging ï¼Œè¿™å°†å¯¼è‡´å„ç§é…ç½®ç»„åˆçš„æ¿€å¢ï¼Œä»è€Œç»™ç®¡ç†éƒ¨ç½²å¢åŠ äº†å¾ˆå¤šä¸ç¡®å®šå› ç´ ã€‚

12-Factor åº”ç”¨ä¸­ï¼Œç¯å¢ƒå˜é‡çš„ç²’åº¦è¦è¶³å¤Ÿå°ï¼Œä¸”ç›¸å¯¹ç‹¬ç«‹ã€‚å®ƒä»¬æ°¸è¿œä¹Ÿä¸ä¼šç»„åˆæˆä¸€ä¸ªæ‰€è°“çš„â€œç¯å¢ƒâ€ï¼Œè€Œæ˜¯ç‹¬ç«‹å­˜åœ¨äºæ¯ä¸ªéƒ¨ç½²ä¹‹ä¸­ã€‚å½“åº”ç”¨ç¨‹åºä¸æ–­æ‰©å±•ï¼Œéœ€è¦æ›´å¤šç§ç±»çš„éƒ¨ç½²æ—¶ï¼Œè¿™ç§é…ç½®ç®¡ç†æ–¹å¼èƒ½å¤Ÿåšåˆ°å¹³æ»‘è¿‡æ¸¡ã€‚ 

> [å‚è€ƒ: åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®](https://12factor.net/zh_cn/config)

# Tips

## Javaåœ¨Linuxä¸Šçš„æ—¶åŒºé—®é¢˜
- è¡¨è±¡
    - Dockerå®¹å™¨ä¸­è¿è¡Œçš„Linuxä¸Šæ—¶åŒºæ˜¯æ­£ç¡®çš„, ä½†æ˜¯Javaåº”ç”¨çš„æ—¶åŒºä¸å¯¹
- åŸå›  
    - JVMè·å–æ—¶åŒºé…ç½®çš„é¡ºåº
    1. æŸ¥çœ‹ ç¯å¢ƒå˜é‡ TZ 
        - `export TZ=Asia/Shanghai`
    1. /etc/sysconfig/clock ä¸­æŸ¥æ‰¾ ZONE çš„å€¼
        ```conf
        ZONE="Asia/Shanghai"
        UTC=false
        ARC=false
        ```
    1. /etc/localtime æˆ–è€… /usr/share/zoneinfo 
        - `ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime`
    - ä¹Ÿå¯ä»¥åŠ JVMå‚æ•° `-Duser.timezone=GMT+8`
    - æˆ–è€…ç¡¬ç¼–ç è®¾ç½®æ—¶åŒº

> å¿«é€Ÿæµ‹è¯•Javaè·å–åˆ°çš„æ—¶åŒº
```java
    import java.util.Date;
    import java.time.ZoneOffset;

    public class TimeTest {
        public static void main(String[] args){
            System.out.println(new Date());
            System.out.println(ZoneOffset.systemDefault());
        }
    }
```

## å®¹å™¨ä¸­Jvmä¿¡å·åŠå‚æ•°æ¥æ”¶é—®é¢˜
éœ€è¦é¿å…Javaè¿›ç¨‹ä¸ºå®¹å™¨ä¸­çš„1å·è¿›ç¨‹ï¼Œå› ä¸ºä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼ŒåŒ…æ‹¬ä½†ä¸é™ï¼š
- æ— æ³•æ­£å¸¸æ¥æ”¶Linuxä¿¡å·é‡
- Arthasæ— æ³•æ³¨å…¥
- æ— æ³•åˆç†ç®¡ç†æ´¾ç”Ÿå‡ºçš„è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ
- JDKä¸­çš„å·¥å…·æœ‰äº›ä¹Ÿä¼šæ— æ³•æ­£å¸¸ä½¿ç”¨ä¾‹å¦‚ jstack
