---
title: Javaä¸­çš„Debug
date: 2019-07-21 18:08:40
tags: 
categories: 
    - Java
---

ğŸ’ 

- 1. [Debug](#debug)
    - 1.1. [æŠ€å·§](#æŠ€å·§)
    - 1.2. [æ–¹æ¡ˆ](#æ–¹æ¡ˆ)
        - 1.2.1. [åº”ç”¨æ–¹æ³•CPUè€—æ—¶æˆ–çº¿ç¨‹å¼‚å¸¸](#åº”ç”¨æ–¹æ³•cpuè€—æ—¶æˆ–çº¿ç¨‹å¼‚å¸¸)
    - 1.3. [è¿œç¨‹è°ƒè¯•](#è¿œç¨‹è°ƒè¯•)

ğŸ’  2024-06-01 23:56:42
****************************************
# Debug

> [å‚è€ƒ: æ·±å…¥ Java è°ƒè¯•ä½“ç³»](https://www.ibm.com/developerworks/cn/views/java/libraryview.jsp?search_by=%E6%B7%B1%E5%85%A5%20Java%20%E8%B0%83%E8%AF%95%E4%BD%93%E7%B3%BB)  

1. [jdb](https://docs.oracle.com/javase/8/docs/technotes/tools/windows/jdb.html)

> IDEA çš„ debug å®ç°æ–¹å¼ï¼š JVMåº”ç”¨çš„å¯åŠ¨å‘½ä»¤è¿½åŠ  -javaagent: . `å¯æŸ¥çœ‹JVMçš„å®Œæ•´å¯åŠ¨å‘½ä»¤æ‰¾åˆ°`

## æŠ€å·§
1. éœ€è¦å°è¯•ä¸åœæœºå»ä¿®æ”¹ä»£ç å»å¯»æ‰¾é—®é¢˜è¸ªè¿¹
    - å¯é€šè¿‡ArthasåŠ¨æ€æ›¿æ¢class
1. ä¸šåŠ¡ä»£ç å¤æ‚ï¼Œå¯»æ‰¾èµ„æºæ³„æ¼ç‚¹éš¾ä»¥æ‰¾åˆ°ä¸šåŠ¡ä¸Šçš„è§¦å‘ç‚¹
    - å¯åœ¨åˆ›å»ºèµ„æºçš„æœ€åº•å±‚å…¥å£å®ä¾‹åŒ–ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯ä¸æŠ›å‡ºï¼Œä»…æ‰“å°æ—¥å¿—ï¼Œè§‚å¯Ÿæ¯æ¬¡èµ„æºè¢«åˆ›å»ºæ—¶çš„è°ƒç”¨æ ˆï¼Œè¾…åŠ©åˆ†æå‡ºæ˜¯å“ªä¸ªä¸šåŠ¡å…¥å£å¯¼è‡´


## æ–¹æ¡ˆ
### åº”ç”¨æ–¹æ³•CPUè€—æ—¶æˆ–çº¿ç¨‹å¼‚å¸¸
è¡¨ç°ï¼š  åº”ç”¨å¯åŠ¨æ…¢ï¼Œä¸šåŠ¡æ–¹æ³•è¿è¡Œæ…¢ç­‰ç­‰   

æ€è·¯ï¼š 

1. jstack åˆ†ææ–¹æ³• åœ¨ä¸šåŠ¡è¿›å…¥å‰ï¼Œæ‰§è¡Œä¸­ï¼Œæ‰§è¡Œå®Œæ¯•å ç­‰è‹¥å¹²ä¸ªèŠ‚ç‚¹ä¸Šçš„çº¿ç¨‹å·®åˆ«ï¼Œæ‰¾å‡ºå¯èƒ½å¼‚å¸¸çš„çº¿ç¨‹å’Œæ–¹æ³•æ ˆ
1. profile æŸ¥çœ‹CPUç«ç„°å›¾ï¼Œæ‰¾å‡ºè€—æ—¶é«˜çš„æ ˆ
1. arthas çš„ monitor æŒ‡ä»¤è¿›è¡Œåˆ†ææ–¹æ³•æ ˆè€—æ—¶ç›‘æ§ï¼Œæ‰¾å‡ºå¼‚å¸¸æ–¹æ³•

> é¡¹ç›®å¯åŠ¨æ…¢

1. åœºæ™¯ï¼š Linuxç³»ç»Ÿ hostname æ²¡æœ‰é…ç½®åˆ° /etc/hosts æ–‡ä»¶ä¸­ï¼Œ å¯åŠ¨è¿‡ç¨‹ä¸­é¢‘ç¹jstackèƒ½çœ‹å‡ºæŸçº¿ç¨‹è¢« getLocalHost æ–¹æ³•æ‰€é˜»å¡
    - æ–¹æ¡ˆï¼š hostnameé…ç½®åˆ° /etc/hosts

## è¿œç¨‹è°ƒè¯•
- æœåŠ¡ç«¯å¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£ 8000
    - JDK9åŠä»¥ä¸Š `-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000`
    - JDK5-8 `-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8000`
    - If you want to debug from start of application use `suspend=y` , this will keep remote application suspended until you connect from eclipse.
- IDEä¸­æ–°å¢Remoteè¿è¡Œé…ç½®å¡«å…¥IPç«¯å£ï¼Œé€‰æ‹©å¯åŠ¨ç±»æ‰€åœ¨æ¨¡å—å³å¯è¿œç¨‹Debug 
    - æ³¨æ„å°½é‡ä¸è¦Debugæ‰€æœ‰çº¿ç¨‹ä»è€Œå¯¼è‡´K8Så¥åº·æ£€æŸ¥æ— å“åº”ä¸‹çš„podé‡å¯
