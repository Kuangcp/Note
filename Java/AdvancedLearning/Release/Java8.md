---
title: Java8
date: 2018-12-13 16:05:51
tags: 
categories: 
    - Java
---

ğŸ’ 

- 1. [Java8](#java8)
    - 1.1. [å®æˆ˜åº“é¡¹ç›®](#å®æˆ˜åº“é¡¹ç›®)
- 2. [æ¥å£çš„å˜åŒ–](#æ¥å£çš„å˜åŒ–)
    - 2.1. [defaultæ–¹æ³•](#defaultæ–¹æ³•)
    - 2.2. [staticæ–¹æ³•](#staticæ–¹æ³•)
- 3. [å‡½æ•°å¼](#å‡½æ•°å¼)
    - 3.1. [å‡½æ•°å¼æ¥å£](#å‡½æ•°å¼æ¥å£)
        - 3.1.1. [æ„é€ å‡½æ•°çš„å¼•ç”¨](#æ„é€ å‡½æ•°çš„å¼•ç”¨)
    - 3.2. [å‡½æ•°å¼æ¥å£æ¡ˆä¾‹](#å‡½æ•°å¼æ¥å£æ¡ˆä¾‹)
- 4. [Lambda](#lambda)
    - 4.1. [è¡Œä¸ºå‚æ•°åŒ–](#è¡Œä¸ºå‚æ•°åŒ–)
    - 4.2. [LambdaåŸºç¡€](#lambdaåŸºç¡€)
        - 4.2.1. [Lambda å®ç°åŸç†](#lambda-å®ç°åŸç†)
        - 4.2.2. [Lambda å±€é™æ€§](#lambda-å±€é™æ€§)
        - 4.2.3. [Lambda BUG](#lambda-bug)
    - 4.3. [åŸå§‹ç±»å‹ç‰¹åŒ–](#åŸå§‹ç±»å‹ç‰¹åŒ–)
    - 4.4. [ç±»å‹æ£€æŸ¥ã€ç±»å‹æ¨æ–­ä»¥åŠé™åˆ¶](#ç±»å‹æ£€æŸ¥ã€ç±»å‹æ¨æ–­ä»¥åŠé™åˆ¶)
        - 4.4.1. [ç±»å‹æ£€æŸ¥](#ç±»å‹æ£€æŸ¥)
        - 4.4.2. [åŒæ ·çš„Lambda ä¸åŒçš„å‡½æ•°å¼æ¥å£](#åŒæ ·çš„lambda-ä¸åŒçš„å‡½æ•°å¼æ¥å£)
        - 4.4.3. [ç±»å‹æ¨æ–­](#ç±»å‹æ¨æ–­)
        - 4.4.4. [ä½¿ç”¨å±€éƒ¨å˜é‡](#ä½¿ç”¨å±€éƒ¨å˜é‡)
    - 4.5. [å¤åˆ Lambda è¡¨è¾¾å¼](#å¤åˆ-lambda-è¡¨è¾¾å¼)
        - 4.5.1. [æ¯”è¾ƒå™¨å¤åˆ](#æ¯”è¾ƒå™¨å¤åˆ)
        - 4.5.2. [è°“è¯å¤åˆ](#è°“è¯å¤åˆ)
        - 4.5.3. [å‡½æ•°å¤åˆ](#å‡½æ•°å¤åˆ)
    - 4.6. [åˆ©ç”¨Lambdaå¼€å‘DSLæ¡†æ¶](#åˆ©ç”¨lambdaå¼€å‘dslæ¡†æ¶)
- 5. [Stream](#stream)
    - 5.1. [Streamä¸é›†åˆ](#streamä¸é›†åˆ)
        - 5.1.1. [åªèƒ½éå†ä¸€æ¬¡](#åªèƒ½éå†ä¸€æ¬¡)
        - 5.1.2. [å¤–éƒ¨è¿­ä»£å’Œå†…éƒ¨è¿­ä»£](#å¤–éƒ¨è¿­ä»£å’Œå†…éƒ¨è¿­ä»£)
    - 5.2. [æ„å»ºæµ](#æ„å»ºæµ)
        - 5.2.1. [æœ‰é™æµ](#æœ‰é™æµ)
        - 5.2.2. [æ— é™æµ](#æ— é™æµ)
    - 5.3. [æ•°å€¼æµ](#æ•°å€¼æµ)
        - 5.3.1. [åŸå§‹ç±»å‹ç‰¹åŒ–](#åŸå§‹ç±»å‹ç‰¹åŒ–)
        - 5.3.2. [æ•°å€¼èŒƒå›´](#æ•°å€¼èŒƒå›´)
    - 5.4. [Streamæ“ä½œ](#streamæ“ä½œ)
        - 5.4.1. [ä¸­é—´æ“ä½œ](#ä¸­é—´æ“ä½œ)
        - 5.4.2. [ç»ˆç«¯æ“ä½œ](#ç»ˆç«¯æ“ä½œ)
    - 5.5. [Streamçš„ä½¿ç”¨](#streamçš„ä½¿ç”¨)
        - 5.5.1. [ç­›é€‰](#ç­›é€‰)
        - 5.5.2. [æ˜ å°„](#æ˜ å°„)
        - 5.5.3. [æŸ¥æ‰¾å’ŒåŒ¹é…](#æŸ¥æ‰¾å’ŒåŒ¹é…)
        - 5.5.4. [å½’çº¦](#å½’çº¦)
            - 5.5.4.1. [æ±‚å’Œ](#æ±‚å’Œ)
            - 5.5.4.2. [æå€¼](#æå€¼)
            - 5.5.4.3. [å½’çº¦çš„ä¼˜åŠ¿ä¸å¹¶è¡ŒåŒ–](#å½’çº¦çš„ä¼˜åŠ¿ä¸å¹¶è¡ŒåŒ–)
    - 5.6. [æ”¶é›†å™¨çš„ä½¿ç”¨](#æ”¶é›†å™¨çš„ä½¿ç”¨)
        - 5.6.1. [é¢„å®šä¹‰æ”¶é›†å™¨](#é¢„å®šä¹‰æ”¶é›†å™¨)
            - 5.6.1.1. [æ±‡æ€» collector](#æ±‡æ€»-collector)
            - 5.6.1.2. [è§„çº¦ reduce](#è§„çº¦-reduce)
            - 5.6.1.3. [åˆ†ç»„](#åˆ†ç»„)
                - 5.6.1.3.1. [å¤šçº§åˆ†ç»„](#å¤šçº§åˆ†ç»„)
                - 5.6.1.3.2. [æŒ‰å­ç»„æ”¶é›†æ•°æ®](#æŒ‰å­ç»„æ”¶é›†æ•°æ®)
            - 5.6.1.4. [åˆ†åŒº](#åˆ†åŒº)
        - 5.6.2. [è‡ªå®šä¹‰ Collector](#è‡ªå®šä¹‰-collector)
- 6. [Optional](#optional)
    - 6.1. [Optionalç±»å’ŒStreamæ¥å£çš„ç›¸ä¼¼ä¹‹å¤„](#optionalç±»å’Œstreamæ¥å£çš„ç›¸ä¼¼ä¹‹å¤„)
    - 6.2. [å®è·µ:è¯»å–PropertiesæŸå±æ€§](#å®è·µè¯»å–propertiesæŸå±æ€§)
- 7. [æ—¶é—´å¤„ç†](#æ—¶é—´å¤„ç†)
    - 7.1. [ZoneId](#zoneid)
    - 7.2. [Clock](#clock)
    - 7.3. [Duration](#duration)
    - 7.4. [Period](#period)
    - 7.5. [Instant](#instant)
    - 7.6. [LocalDateTime](#localdatetime)
        - 7.6.1. [LocalDate](#localdate)
        - 7.6.2. [LocalTime](#localtime)
    - 7.7. [ZoneOffset](#zoneoffset)
    - 7.8. [ZonedDateTime](#zoneddatetime)
    - 7.9. [Clock](#clock)

ğŸ’  2024-09-03 14:05:18
****************************************
# Java8
> [Doc](https://docs.oracle.com/javase/8/) | [API](https://docs.oracle.com/javase/8/docs/api/)  

[docä¸‹è½½](https://www.oracle.com/technetwork/java/javase/documentation/jdk8-doc-downloads-2133158.html)

> [Java8 JDK Readme](http://www.oracle.com/technetwork/java/javase/jdk-8-readme-2095712.html) | [Jre8 Readme](http://www.oracle.com/technetwork/java/javase/jre-8-readme-2095710.html)`æœ‰è¯´æ˜å“ªäº›æ˜¯JREè¿è¡Œä¸å¿…è¦çš„æ–‡ä»¶`  

> [Java8 tools](https://docs.oracle.com/javase/8/docs/technotes/tools/)`ä»‹ç»ç›®å½• bin/* ä¸‹çš„å·¥å…·` | [jdk structure](https://docs.oracle.com/javase/8/docs/technotes/guides/desc_jdk_structure.html)  
- [Oracle:Java8æ•…éšœæ’é™¤æŒ‡å—](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/)

> [å‚è€ƒ: Java 8 ç‰¹æ€§ â€“ ç»ˆææ‰‹å†Œ](http://ifeve.com/java-8-features-tutorial/)

**`å‚è€ƒä¹¦ç±`**
1. Java8 in action 
1. å†™ç»™å¤§å¿™äººçœ‹çš„Java8

## å®æˆ˜åº“é¡¹ç›®
- [vavr](https://github.com/vavr-io/vavr) `æ”¹è¿›Java8å‡½æ•°å¼`
- [resilience4j](https://github.com/resilience4j/resilience4j) `Hystrixç»§ä»»è€…`

*****************************
# æ¥å£çš„å˜åŒ–

## defaultæ–¹æ³•
> æ¥å£ä¸­ä¹Ÿèƒ½å†™å…·æœ‰æ–¹æ³•ä½“çš„æ–¹æ³•äº†

1. è°ƒç”¨æ–¹å¼: `æ¥å£.super.æ–¹æ³•`

## staticæ–¹æ³•
ç±»ä¼¼äºScala Ruby trait/mixin è¿™ç§é»˜è®¤æ¥å£å®ç°

1. è°ƒç”¨æ–¹å¼: static æ–¹æ³• `æ¥å£.æ–¹æ³•`

*************************

# å‡½æ•°å¼
> [å‚è€ƒ  Java8å‡½æ•°æ¥å£å®ç°å›è°ƒåŠGroovyé—­åŒ…çš„ä»£ç ç¤ºä¾‹](http://www.cnblogs.com/lovesqcc/p/6083759.html)
> [Functionæ¥å£ â€“ Java8ä¸­java.util.functionåŒ…ä¸‹çš„å‡½æ•°å¼æ¥å£](http://ifeve.com/jjava-util-function-java8/)

An informative annotation type used to indicate that an interface type declaration is intended to be a functional interface as defined by the Java Language Specification.

å¦‚æœä½ ç”¨ `@FunctionalInterface` å®šä¹‰äº†ä¸€ä¸ªæ¥å£, æ¥å£ä¸­åªèƒ½æœ‰ä¸€ä¸ªæ–¹æ³•å£°æ˜, å¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™  
è€Œä¸”æ— è®ºæ¥å£å£°æ˜ä¸­æ˜¯å¦ä½¿ç”¨è¯¥æ³¨è§£ï¼Œç¼–è¯‘å™¨éƒ½ä¼šå°†æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•å£°æ˜çš„ä»»ä½•æ¥å£è§†ä¸º `FunctionalInterface`

> å¸¸ç”¨å‡½æ•°æ¥å£: (è¯¦ç»†å¯å‚è€ƒ java.util.function; åŒ…ä¸‹çš„ç±»)

| å‡½æ•°å¼æ¥å£ | å‡½æ•°æè¿°ç¬¦ | åŸå§‹ç±»å‹ç‰¹åŒ– |
|:----|:----|:----|
| `Predicate<T>` | T->boolean | IntPredicate<br/>LongPredicate<br/> DoublePredicate|
| `Consumer<T>` | T->void | IntConsumer<br/>LongConsumer<br/> DoubleConsumer |
| Function<T,R> | T->R | `IntFunction<R>` <br/> IntToDoubleFunction <br/> IntToLongFunction <br/> `LongFunction<R>`<br/> LongToDoubleFunction <br/> LongToIntFunction <br/> `DoubleFunction<R>` <br/>`ToIntFunction<T>`<br/>`ToDoubleFunction<T>`<br/>`ToLongFunction<T>`|
| `Supplier<T>` | ()->T | BooleanSupplier<br/>IntSupplier<br/> LongSupplier<br/> DoubleSupplier|
| `UnaryOperator<T>` | T->T |IntUnaryOperator<br/>LongUnaryOperator<br/>DoubleUnaryOperator|
| `BinaryOperator<T>` | (T,T)-> T | IntBinaryOperator<br/>LongBinaryOperator<br/>DoubleBinaryOperator|
| BiPredicate<L,R> | (L,R)->boolean | |
| BiConsumer<T,U> | (T,U)->void | `ObjIntConsumer<T>`<br/>`ObjLongConsumer<T>`<br/>`ObjDoubleConsumer<T>`|
| BiFunction<T,U,R> | (T,U)->R | ToIntBiFunction<T,U><br/>ToLongBiFunction<T,U><br/>ToDoubleBiFunction<T,U>|

- `(T,U) -> R` çš„è¡¨è¾¾æ–¹å¼å±•ç¤ºäº†åº”å½“å¦‚ä½•æ€è€ƒä¸€ä¸ªå‡½æ•°æè¿°ç¬¦ã€‚  
    - è¡¨çš„å·¦ä¾§ä»£è¡¨äº†å‚æ•°ç±»å‹ã€‚è¿™é‡Œå®ƒä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œå…·æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºæ³›å‹Tå’ŒUï¼Œè¿”å›ç±»å‹ä¸ºRã€‚

- ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Function ä»¥åŠé—­åŒ…å‘¢ï¼Ÿ
    - åœ¨è¯­æ³•ä¸Šæ¯”å®šä¹‰å›è°ƒæ¥å£ã€åˆ›å»ºåŒ¿åç±»æ›´åŠ ç®€æ´ï¼›
    - å°è¯•ä½¿ç”¨æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œç†è§£å¤šæ ·åŒ–çš„ç¼–ç¨‹æ€æƒ³ï¼Œæå‡ç¼–ç¨‹è¡¨è¾¾èƒ½åŠ›ã€‚

## å‡½æ•°å¼æ¥å£
> é€šè¿‡ :: æ“ä½œç¬¦ ç®€åŒ–ä»£ç 

| Lambda | æ–¹æ³•å¼•ç”¨ |
|:----|:----|
| (Apple a) -> a.getWeight() | Apple::getWeight
| () -> Thread.currentThread().dumpStack() | Thread.currentThread()::dumpStack
| (str, i) -> str.substring(i) | String::substring
| (String s) -> System.out.println(s) | System.out::println

1. æŒ‡å‘é™æ€æ–¹æ³•çš„æ–¹æ³•å¼•ç”¨ï¼ˆä¾‹å¦‚Integerçš„parseIntæ–¹æ³•ï¼Œå†™ä½œInteger::parseIntï¼‰
1. æŒ‡å‘ä»»æ„ç±»å‹å®ä¾‹æ–¹æ³•çš„æ–¹æ³•å¼•ç”¨ ï¼ˆ ä¾‹ å¦‚ String çš„ length æ–¹ æ³• ï¼Œ å†™ä½œString::lengthï¼‰ã€‚
1. æŒ‡å‘ç°æœ‰å¯¹è±¡çš„å®ä¾‹æ–¹æ³•çš„æ–¹æ³•å¼•ç”¨
    - å‡è®¾ä½ æœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡expensiveTransaction ç”¨äºå­˜æ”¾Transactionç±»å‹çš„å¯¹è±¡ï¼Œå®ƒæ”¯æŒå®ä¾‹æ–¹æ³•getValueï¼Œ
    - é‚£ä¹ˆä½ å°±å¯ä»¥å†™expensiveTransaction::getValue

### æ„é€ å‡½æ•°çš„å¼•ç”¨
1. ç©ºæ„é€ å‡½æ•° ç­‰ä»·äº `() -> T` 
    - ä¾‹å¦‚ `Supplier<Apple> c1 = Apple::new;`
    - ä¹‹å `Apple a1 = c1.get();` è°ƒç”¨æ¥å£çš„getæ–¹æ³•å®ä¾‹åŒ–Appleå¯¹è±¡

ä¸å°†æ„é€ å‡½æ•°å®ä¾‹åŒ–å´èƒ½å¤Ÿå¼•ç”¨å®ƒï¼Œè¿™ä¸ªåŠŸèƒ½æœ‰ä¸€äº›æœ‰è¶£çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨Mapæ¥å°†æ„é€ å‡½æ•°æ˜ å°„åˆ°å­—ç¬¦ä¸²å€¼ã€‚
ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªgiveMeFruitæ–¹æ³•ï¼Œç»™å®ƒä¸€ä¸ªStringå’Œä¸€ä¸ªIntegerï¼Œå®ƒå°±å¯ä»¥åˆ›å»ºå‡ºä¸åŒé‡é‡çš„å„ç§æ°´æœï¼š
```java
    static Map<String, Function<Integer, Fruit>> map = new HashMap<>();
    static {
        map.put("apple", Apple::new);
        map.put("orange", Orange::new);
    // etc...
    }
    public static Fruit giveMeFruit(String fruit, Integer weight){
        return map.get(fruit.toLowerCase()).apply(weight);
    }
```

> åˆ©ç”¨JDKæä¾›çš„å‡½æ•°å¼æ¥å£ å¯ä»¥å®ç°å°†ä¸€ä¸ª,ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°è½¬å˜ä¸ºæ„é€ å‡½æ•°å¼•ç”¨, é‚£ä¹ˆå¯ä»¥è‡ªå®šä¹‰å®ç°ä¸‰ä¸ªå‚æ•°çš„æ¥å£
```java
    public interface TriFunction<T, U, V, R>{
        R apply(T t, U u, V v);
    }
    TriFunction<Integer, Integer, Integer, Color> colorFactory = Color::new;
```

## å‡½æ•°å¼æ¥å£æ¡ˆä¾‹

| ä½¿ç”¨æ¡ˆä¾‹ | Lambdaä¾‹å­ | å¯¹åº”çš„å‡½æ•°å¼æ¥å£ |
|:----|:----|:----|
| å¸ƒå°”è¡¨è¾¾å¼ | (List<String> list) -> list.isEmpty() | `Predicate<List<String>>`|
| åˆ›å»ºå¯¹è±¡ |() -> new Apple(10) |`Supplier<Apple>`
| æ¶ˆè´¹ä¸€ä¸ªå¯¹è±¡ | (Apple a) ->System.out.println(a.getWeight())|`Consumer<Apple>`|
| ä»ä¸€ä¸ªå¯¹è±¡ä¸­ é€‰æ‹©/æå– | (String s) -> s.length() | Function<String, Integer> æˆ– `ToIntFunction<String>`
| åˆå¹¶ä¸¤ä¸ªå€¼ | (int a, int b) -> a * b |  IntBinaryOperator|
| æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ | (Apple a1, Apple a2) -> a1.getWeight().compareTo(a2.getWeight()) | Comparator< Apple > æˆ– BiFunction<Apple, Apple, Integer> æˆ– ToIntBiFunction<Apple, Apple>

- è¯·æ³¨æ„ï¼Œä»»ä½•å‡½æ•°å¼æ¥å£éƒ½ä¸å…è®¸æŠ›å‡ºå—æ£€å¼‚å¸¸ï¼ˆchecked exceptionï¼‰ã€‚å¦‚æœä½ éœ€è¦Lambda è¡¨è¾¾å¼æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š
    - å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„å‡½æ•°å¼æ¥å£ï¼Œå¹¶å£°æ˜å—æ£€å¼‚å¸¸ï¼Œ
    - æˆ–è€…æŠŠLambda åŒ…åœ¨ä¸€ä¸ªtry/catchå—ä¸­ã€‚
- æ¯”å¦‚å‡½æ•°å¼æ¥å£BufferedReaderProcessorï¼Œå®ƒæ˜¾å¼å£°æ˜äº†ä¸€ä¸ªIOExceptionï¼š
    ```java
        @FunctionalInterface
        public interface BufferedReaderProcessor {
            String process(BufferedReader b) throws IOException;
        }
        BufferedReaderProcessor p = (BufferedReader br) -> br.readLine();
    ```
- ä½†æ˜¯ä½ å¯èƒ½æ˜¯åœ¨ä½¿ç”¨ä¸€ä¸ªæ¥å—å‡½æ•°å¼æ¥å£çš„APIï¼Œæ¯”å¦‚Function<T, R>ï¼Œæ²¡æœ‰åŠæ³•è‡ªå·±åˆ›å»ºä¸€ä¸ªã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ ä½ å¯ä»¥æ˜¾å¼æ•æ‰å—æ£€å¼‚å¸¸ï¼š
    ```java
        Function<BufferedReader, String> f = (BufferedReader b) -> {
            try {
                return b.readLine();
            } catch(IOException e) {
                throw new RuntimeException(e);
            }
        };
    ```

*******************************

# Lambda
> Î» è¡¨è¾¾å¼

1. Lambdaè¡¨è¾¾å¼å¯ä»¥ç†è§£ä¸ºä¸€ç§åŒ¿åå‡½æ•°ï¼šå®ƒæ²¡æœ‰åç§°ï¼Œä½†æœ‰å‚æ•°åˆ—è¡¨ã€å‡½æ•°ä¸»ä½“ã€è¿”å›ç±»å‹ï¼Œå¯èƒ½è¿˜æœ‰ä¸€ä¸ªå¯ä»¥æŠ›å‡ºçš„å¼‚å¸¸çš„åˆ—è¡¨ã€‚
1. Lambdaè¡¨è¾¾å¼è®©ä½ å¯ä»¥ç®€æ´åœ°ä¼ é€’ä»£ç ã€‚
1. å‡½æ•°å¼æ¥å£å°±æ˜¯ä»…ä»…å£°æ˜äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚
1. åªæœ‰åœ¨æ¥å—å‡½æ•°å¼æ¥å£çš„åœ°æ–¹æ‰å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ã€‚
1. Lambdaè¡¨è¾¾å¼å…è®¸ä½ ç›´æ¥å†…è”ï¼Œä¸ºå‡½æ•°å¼æ¥å£çš„æŠ½è±¡æ–¹æ³•æä¾›å®ç°ï¼Œå¹¶ä¸”å°†æ•´ä¸ªè¡¨è¾¾å¼ä½œä¸ºå‡½æ•°å¼æ¥å£çš„ä¸€ä¸ªå®ä¾‹ã€‚
1. Java 8è‡ªå¸¦ä¸€äº›å¸¸ç”¨çš„å‡½æ•°å¼æ¥å£ï¼Œæ”¾åœ¨java.util.functionåŒ…é‡Œï¼ŒåŒ…æ‹¬`Predicate<T>ã€ Function<T,R>ã€ Supplier<T>ã€Consumer<T> å’ŒBinaryOperator<T>`
1. ä¸ºäº†é¿å…è£…ç®±æ“ä½œï¼Œå¯¹`Predicate<T>`å’Œ`Function<T, R>`ç­‰é€šç”¨å‡½æ•°å¼æ¥å£çš„åŸå§‹ç±»å‹ç‰¹åŒ–ï¼š IntPredicateã€ IntToLongFunctionç­‰ã€‚
1. ç¯ç»•æ‰§è¡Œæ¨¡å¼ï¼ˆå³åœ¨æ–¹æ³•æ‰€å¿…éœ€çš„ä»£ç ä¸­é—´ï¼Œä½ éœ€è¦æ‰§è¡Œç‚¹å„¿ä»€ä¹ˆæ“ä½œï¼Œæ¯”å¦‚èµ„æºåˆ†é…å’Œæ¸…ç†ï¼‰å¯ä»¥é…åˆLambdaæé«˜çµæ´»æ€§å’Œå¯é‡ç”¨æ€§ã€‚
1. Lambdaè¡¨è¾¾å¼æ‰€éœ€è¦ä»£è¡¨çš„ç±»å‹ç§°ä¸ºç›®æ ‡ç±»å‹ã€‚
1. æ–¹æ³•å¼•ç”¨è®©ä½ é‡å¤ä½¿ç”¨ç°æœ‰çš„æ–¹æ³•å®ç°å¹¶ç›´æ¥ä¼ é€’å®ƒä»¬ã€‚
1. Comparatorã€ Predicateå’ŒFunctionç­‰å‡½æ•°å¼æ¥å£éƒ½æœ‰å‡ ä¸ªå¯ä»¥ç”¨æ¥ç»“åˆLambdaè¡¨è¾¾å¼çš„é»˜è®¤æ–¹æ³•ã€‚

> [å‚è€ƒ: ä½ çœŸçš„äº†è§£lambdaå—ï¼Ÿä¸€æ–‡è®©ä½ æ˜ç™½lambdaç”¨æ³•ä¸æºç åˆ†æ ](https://mp.weixin.qq.com/s?__biz=MzAxODcyNjEzNQ==&mid=2247485682&idx=1&sn=f3fb281b49a029b607f9377853a644bf&chksm=9bd0a56aaca72c7c8beebbea8f9471446cb444bd8e1e7d21016e906d1227e8f87770e2f8f31e&mpshare=1&scene=1&srcid=0810geQnLXB2oMjfoAOEJ39L#rd)
> [å‚è€ƒ: çº§è” lambda è¡¨è¾¾å¼çš„å‡½æ•°é‡ç”¨ä¸ä»£ç ç®€çŸ­é—®é¢˜](http://www.techug.com/post/java-lambda.html)
> [å‚è€ƒ: Java8ï¼šLambdaè¡¨è¾¾å¼å¢å¼ºç‰ˆComparatorå’Œæ’åº](http://www.importnew.com/15259.html)

## è¡Œä¸ºå‚æ•°åŒ–
>1. è¡Œä¸ºå‚æ•°åŒ–ï¼Œå°±æ˜¯ä¸€ä¸ªæ–¹æ³•æ¥å—å¤šä¸ªä¸åŒçš„è¡Œä¸ºä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨å†…éƒ¨ä½¿ç”¨å®ƒä»¬ï¼Œ å®Œæˆä¸åŒè¡Œä¸ºçš„èƒ½åŠ›ã€‚
>1. è¡Œä¸ºå‚æ•°åŒ–å¯è®©ä»£ç æ›´å¥½åœ°é€‚åº”ä¸æ–­å˜åŒ–çš„è¦æ±‚ï¼Œå‡è½»æœªæ¥çš„å·¥ä½œé‡ã€‚
>1. ä¼ é€’ä»£ç ï¼Œå°±æ˜¯å°†æ–°è¡Œä¸ºä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ã€‚ä½†åœ¨Java 8ä¹‹å‰è¿™å®ç°èµ·æ¥å¾ˆå•°å—¦ã€‚ä¸ºæ¥
>1. å£°æ˜è®¸å¤šåªç”¨ä¸€æ¬¡çš„å®ä½“ç±»è€Œé€ æˆçš„å•°å—¦ä»£ç ï¼Œåœ¨Java 8ä¹‹å‰å¯ä»¥ç”¨åŒ¿åç±»æ¥å‡å°‘ã€‚
>1. Java APIåŒ…å«å¾ˆå¤šå¯ä»¥ç”¨ä¸åŒè¡Œä¸ºè¿›è¡Œå‚æ•°åŒ–çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬æ’åºã€çº¿ç¨‹å’ŒGUIå¤„ç†ã€‚

> è¿™ç§æ¨¡å¼å¯ä»¥æŠŠä¸€ä¸ªè¡Œä¸ºï¼ˆä¸€æ®µä»£ç ï¼‰å°è£…èµ·æ¥ï¼Œå¹¶é€šè¿‡ä¼ é€’å’Œä½¿ç”¨åˆ›å»ºçš„è¡Œä¸º, å°†æ–¹æ³•çš„è¡Œä¸ºå‚æ•°åŒ–ã€‚å‰é¢æåˆ°è¿‡ï¼Œè¿™ç§åšæ³•ç±»ä¼¼äºç­–ç•¥è®¾è®¡æ¨¡å¼  
> Java APIä¸­çš„å¾ˆå¤šæ–¹æ³•éƒ½å¯ä»¥ç”¨ä¸åŒçš„è¡Œä¸ºæ¥å‚æ•°åŒ–ã€‚è¿™äº›æ–¹æ³•å¾€å¾€ä¸åŒ¿åç±»ä¸€èµ·ä½¿ç”¨

## LambdaåŸºç¡€
- å¯ä»¥æŠŠLambdaè¡¨è¾¾å¼ç†è§£ä¸ºç®€æ´åœ°è¡¨ç¤ºå¯ä¼ é€’çš„åŒ¿åå‡½æ•°çš„ä¸€ç§æ–¹å¼ï¼šå®ƒæ²¡æœ‰åç§°ï¼Œä½†å®ƒæœ‰å‚æ•°åˆ—è¡¨ã€å‡½æ•°ä¸»ä½“ã€è¿”å›ç±»å‹ï¼Œå¯èƒ½è¿˜æœ‰ä¸€ä¸ªå¯ä»¥æŠ›å‡ºçš„å¼‚å¸¸åˆ—è¡¨ã€‚
    - `åŒ¿å`  æˆ‘ä»¬è¯´åŒ¿åï¼Œæ˜¯å› ä¸ºå®ƒä¸åƒæ™®é€šçš„æ–¹æ³•é‚£æ ·æœ‰ä¸€ä¸ªæ˜ç¡®çš„åç§°ï¼šå†™å¾—å°‘è€Œæƒ³å¾—å¤šï¼
    - `å‡½æ•°`  æˆ‘ä»¬è¯´å®ƒæ˜¯å‡½æ•°ï¼Œæ˜¯å› ä¸ºLambdaå‡½æ•°ä¸åƒæ–¹æ³•é‚£æ ·å±äºæŸä¸ªç‰¹å®šçš„ç±»ã€‚ä½†å’Œæ–¹æ³•ç­¾åçš„ç»„æˆæ˜¯ä¸€è‡´çš„
    - `ä¼ é€’`  Lambdaè¡¨è¾¾å¼å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•æˆ–å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚
    - `ç®€æ´`  æ— éœ€åƒåŒ¿åç±»é‚£æ ·å†™å¾ˆå¤šæ¨¡æ¿ä»£ç ã€‚

- LambdaåŸºç¡€è¯­æ³•: `(parameters) -> expression` æˆ–è€… `(parameters) -> { statements; }`

ä¾‹å¦‚ `() -> void` æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¸ºç©º è¿”å›å€¼ä¸ºvoidçš„å‡½æ•°, Runnable çš„ run æ–¹æ³•
```java
    public Callable<String> fetch() {
        // è¿”å›çš„æ–¹æ³•çš„æ–¹æ³•ç­¾åæ˜¯ () -> String
        return () -> "Tricky example ;-)";
    }

    // æ–¹æ³•ç­¾åä¸º () -> void
    execute(() -> {});
    public void execute(Runnable r){
        r.run();
    }
```

**`å®è·µ`**
- èµ„æºå¤„ç†ï¼ˆä¾‹å¦‚å¤„ç†æ–‡ä»¶æˆ–æ•°æ®åº“ï¼‰æ—¶ä¸€ä¸ªå¸¸è§çš„æ¨¡å¼å°±æ˜¯æ‰“å¼€ä¸€ä¸ªèµ„æºï¼Œåšä¸€äº›å¤„ç†ï¼Œç„¶åå…³é—­èµ„æºã€‚è¿™ä¸ªè®¾ç½®å’Œæ¸…ç†é˜¶æ®µæ€»æ˜¯å¾ˆç±»ä¼¼
    - å¹¶ä¸”ä¼šå›´ç»•ç€æ‰§è¡Œå¤„ç†çš„é‚£äº›é‡è¦ä»£ç ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç¯ç»•æ‰§è¡Œï¼ˆexecute aroundï¼‰ æ¨¡å¼
```java
    // ç®€å•çš„ä»æ–‡ä»¶è¯»å–ä¸€è¡Œ
    public static String processFile() throws IOException {
        try (BufferedReader br = new BufferedReader(new FileReader("data.txt"))) {
            return br.readLine();
        }
    }

    // å¦‚æœå°†è¡Œä¸ºå‚æ•°åŒ–, å°±èƒ½é€šç”¨çš„å®Œæˆéœ€æ±‚
    @FunctionalInterface
    public interface BufferedReaderProcessor {
        String process(BufferedReader b) throws IOException;
    }
    public static String processFile(BufferedReaderProcessor p) throws IOException {}
    // å¤„ç†ä¸€è¡Œ
    String twoLines =processFile((BufferedReader br) -> br.readLine());
    // å¤„ç†ä¸¤è¡Œ
    String result = processFile((BufferedReader br) -> br.readLine() + br.readLine());
```

### Lambda å®ç°åŸç†

1. åˆæ­¥åˆ†æ ç¼–è¯‘åç”ŸæˆåŒ¿åå†…éƒ¨ç±»æ›¿æ¢lambdaè¡¨è¾¾å¼

> [å‚è€ƒ: Java Lambdaè¡¨è¾¾å¼ å®ç°åŸç†åˆ†æ](https://blog.csdn.net/jiankunking/article/details/79825928)

> ä¸ºä»€ä¹ˆLambdaèŒƒå›´å†…çš„ä»£ç å¼•ç”¨å¤–éƒ¨å˜é‡æ—¶å¾—æ˜¯finalä¿®é¥°çš„ã€‚
å› ä¸ºåŒ¿åå†…éƒ¨ç±»çš„å¼•ç”¨ä¸å…è®¸æ­¤æ“ä½œ
```
    int b = 0;
    new Runnable(){
        @Override
        public void run() {
            System.out.println(i++);//ç±»å±æ€§ï¼Œæ­£å¸¸
            System.out.println(b++);//ç¼–è¯‘é”™è¯¯
        }
    };
```


### Lambda å±€é™æ€§
1. å½“æ–¹æ³•ä¸Šå…·æœ‰`ç±»èŒƒå›´`çš„æ³›å‹å‚æ•°æ—¶æ— æ³•ä½¿ç”¨ Lambda å†™æ³•
    ```java
    public interface Test<T> {
        T execute(T param);
    }
    ```

### Lambda BUG
> [æ³›å‹å†…extendså¤šä¸ªç±» lambda è¡¨è¾¾å¼æ–¹æ³•å¼•ç”¨æ—¶ä¼šæŠ¥é”™](https://bugs.java.com/bugdatabase/view_bug.do?bug_id=8142476)

************************

## åŸå§‹ç±»å‹ç‰¹åŒ– 
> Primitive Specializations

> Javaæ•°æ®ç±»å‹è¦ä¹ˆæ˜¯å¼•ç”¨ç±»å‹ï¼ˆæ¯”å¦‚Byteã€ Integerã€ Objectã€ Listï¼‰ï¼Œè¦ä¹ˆæ˜¯åŸå§‹ç±»å‹ï¼ˆæ¯”å¦‚intã€ doubleã€ byteã€ charï¼‰ã€‚  
ä½†æ˜¯æ³›å‹ï¼ˆæ¯”å¦‚`List<T>`ä¸­çš„Tï¼‰åªèƒ½ç»‘å®šåˆ°å¼•ç”¨ç±»å‹ã€‚è¿™æ˜¯ç”±æ³›å‹å†…éƒ¨çš„å®ç°æ–¹å¼é€ æˆçš„ [æ³›å‹ è¯¦ç»†](/Java/AdvancedLearning/JavaGenerics.md)ã€‚ 

å› æ­¤ï¼Œåœ¨Javaé‡Œæœ‰ä¸€ä¸ªå°†åŸå§‹ç±»å‹è½¬æ¢ä¸ºå¯¹åº”çš„å¼•ç”¨ç±»å‹çš„æœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶å«ä½œè£…ç®± boxing ï¼Œåä¹‹ä¸ºæ‹†ç®± unboxing ã€‚  
Javaè¿˜æœ‰ä¸€ä¸ªè‡ªåŠ¨è£…ç®±æœºåˆ¶æ¥å¸®åŠ©ç¨‹åºå‘˜æ‰§è¡Œè¿™ä¸€ä»»åŠ¡ï¼šè£…ç®±å’Œæ‹†ç®±æ“ä½œæ˜¯è‡ªåŠ¨å®Œæˆçš„ã€‚ä½†è¿™åœ¨æ€§èƒ½æ–¹é¢æ˜¯è¦ä»˜å‡ºä»£ä»·çš„ã€‚  

è£…ç®±åçš„å€¼æœ¬è´¨ä¸Šå°±æ˜¯æŠŠåŸå§‹ç±»å‹åŒ…è£¹èµ·æ¥ï¼Œå¹¶ä¿å­˜åœ¨å †é‡Œã€‚å› æ­¤ï¼Œè£…ç®±åçš„å€¼éœ€è¦æ›´å¤šçš„å†…å­˜ï¼Œå¹¶éœ€è¦é¢å¤–çš„å†…å­˜æœç´¢æ¥è·å–è¢«åŒ…è£¹çš„åŸå§‹å€¼ã€‚  
Java 8ä¸ºæˆ‘ä»¬å‰é¢æ‰€è¯´çš„å‡½æ•°å¼æ¥å£å¸¦æ¥äº†ä¸€ä¸ªä¸“é—¨çš„ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯åŸå§‹ç±»å‹æ—¶é¿å…è‡ªåŠ¨è£…ç®±çš„æ“ä½œã€‚  

æ¯”å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨IntPredicateå°±é¿å…äº†å¯¹å€¼1000è¿›è¡Œè£…ç®±æ“ä½œï¼Œä½†è¦æ˜¯ç”¨Predicate<Integer>å°±ä¼šæŠŠå‚æ•°1000è£…ç®±åˆ°ä¸€ä¸ªIntegerå¯¹è±¡ä¸­ -- Java8 in action  

ä¸€èˆ¬æ¥è¯´ï¼Œé’ˆå¯¹ä¸“é—¨çš„è¾“å…¥å‚æ•°ç±»å‹çš„å‡½æ•°å¼æ¥å£çš„åç§°éƒ½è¦åŠ ä¸Šå¯¹åº”çš„åŸå§‹ç±»å‹å‰ç¼€ï¼Œæ¯”å¦‚ DoublePredicateã€LongBinaryOperatorç­‰ã€‚  
Functionæ¥å£è¿˜æœ‰é’ˆå¯¹è¾“å‡ºå‚æ•°ç±»å‹çš„å˜ç§ï¼š ToIntFunction<T>ã€ IntToDoubleFunctionç­‰ã€‚

************************

## ç±»å‹æ£€æŸ¥ã€ç±»å‹æ¨æ–­ä»¥åŠé™åˆ¶

å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æåˆ°Lambdaè¡¨è¾¾å¼æ—¶ï¼Œè¯´å®ƒå¯ä»¥ä¸ºå‡½æ•°å¼æ¥å£ç”Ÿæˆä¸€ä¸ªå®ä¾‹ã€‚ç„¶è€Œï¼Œ Lambda è¡¨è¾¾å¼æœ¬èº«å¹¶ä¸åŒ…å«å®ƒåœ¨å®ç°å“ªä¸ªå‡½æ•°å¼æ¥å£çš„ä¿¡æ¯ã€‚

### ç±»å‹æ£€æŸ¥
> Lambdaçš„ç±»å‹æ˜¯ä»ä½¿ç”¨Lambdaçš„ä¸Šä¸‹æ–‡æ¨æ–­å‡ºæ¥çš„ã€‚ä¸Šä¸‹æ–‡ï¼ˆæ¯”å¦‚ï¼Œæ¥å—å®ƒä¼ é€’çš„æ–¹æ³•çš„å‚æ•°ï¼Œæˆ–æ¥å—å®ƒçš„å€¼çš„å±€éƒ¨å˜é‡ï¼‰ä¸­Lambdaè¡¨è¾¾å¼éœ€è¦çš„ç±»å‹ç§°ä¸ºç›®æ ‡ç±»å‹ã€‚
> è¯·æ³¨æ„ï¼Œå¦‚æœLambdaè¡¨è¾¾å¼æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆæŠ½è±¡æ–¹æ³•æ‰€å£°æ˜çš„throwsè¯­å¥ä¹Ÿå¿…é¡»ä¸ä¹‹åŒ¹é…ã€‚

### åŒæ ·çš„Lambda ä¸åŒçš„å‡½æ•°å¼æ¥å£
> æœ‰äº†ç›®æ ‡ç±»å‹çš„æ¦‚å¿µï¼ŒåŒä¸€ä¸ªLambdaè¡¨è¾¾å¼å°±å¯ä»¥ä¸ä¸åŒçš„å‡½æ•°å¼æ¥å£è”ç³»èµ·æ¥ï¼Œåªè¦å®ƒä»¬çš„æŠ½è±¡æ–¹æ³•ç­¾åèƒ½å¤Ÿå…¼å®¹ã€‚

æ¯”å¦‚ï¼Œå‰é¢æåˆ°çš„Callableå’ŒPrivilegedActionï¼Œè¿™ä¸¤ä¸ªæ¥å£ éƒ½ä»£è¡¨ç€ä»€ä¹ˆä¹Ÿä¸æ¥å—ä¸”è¿”å›ä¸€ä¸ªæ³›å‹Tçš„å‡½æ•°ã€‚ å› æ­¤ï¼Œä¸‹é¢ä¸¤ä¸ªèµ‹å€¼æ˜¯æœ‰æ•ˆçš„ï¼š
```java
    Callable<Integer> c = () -> 42;
    PrivilegedAction<Integer> p = () -> 42;
```

**`ç‰¹æ®Šçš„voidå…¼å®¹è§„åˆ™`**
å¦‚æœä¸€ä¸ªLambdaçš„ä¸»ä½“æ˜¯ä¸€ä¸ªè¯­å¥è¡¨è¾¾å¼ï¼Œ å®ƒå°±å’Œä¸€ä¸ªè¿”å›voidçš„å‡½æ•°æè¿°ç¬¦å…¼å®¹ï¼ˆå½“ç„¶éœ€è¦å‚æ•°åˆ—è¡¨ä¹Ÿå…¼å®¹ï¼‰ã€‚
ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤è¡Œéƒ½æ˜¯åˆæ³•çš„ï¼Œå°½ç®¡Listçš„addæ–¹æ³•è¿”å›äº†ä¸€ä¸ª booleanï¼Œè€Œä¸æ˜¯Consumerä¸Šä¸‹æ–‡ï¼ˆT -> voidï¼‰ æ‰€è¦æ±‚çš„voidï¼š
```java
    // Predicateè¿”å›äº†ä¸€ä¸ªboolean
    Predicate<String> p = s -> list.add(s);
    // Consumerè¿”å›äº†ä¸€ä¸ªvoid
    Consumer<String> b = s -> list.add(s);
```

1. `Object o = () -> {System.out.println("Tricky example"); };` ä¸èƒ½é€šè¿‡ç¼–è¯‘
    - Lambdaè¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡æ˜¯Objectï¼ˆç›®æ ‡ç±»å‹ï¼‰ã€‚ä½†Objectä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚
    - ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠç›®æ ‡ç±»å‹æ”¹æˆRunnableï¼Œå®ƒçš„å‡½æ•°æè¿°ç¬¦æ˜¯() -> void

æ—¢å¯ä»¥åˆ©ç”¨ç›®æ ‡ç±»å‹æ¥æ£€æŸ¥ä¸€ä¸ªLambdaæ˜¯å¦å¯ä»¥ç”¨äºæŸä¸ªç‰¹å®šçš„ä¸Šä¸‹æ–‡. ä¹Ÿå¯ä»¥ç”¨æ¥åšä¸€äº›ç•¥æœ‰ä¸åŒçš„äº‹ï¼šæ¨æ–­Lambdaå‚æ•°çš„ç±»å‹ã€‚

### ç±»å‹æ¨æ–­
> ä½ è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä½ çš„ä»£ç ã€‚ Javaç¼–è¯‘å™¨ä¼šä»ä¸Šä¸‹æ–‡ï¼ˆç›®æ ‡ç±»å‹ï¼‰æ¨æ–­å‡ºç”¨ä»€ä¹ˆå‡½æ•°å¼æ¥å£æ¥é…åˆLambdaè¡¨è¾¾å¼ï¼Œ
> è¿™æ„å‘³ç€å®ƒä¹Ÿå¯ä»¥æ¨æ–­å‡ºé€‚åˆLambdaçš„ç­¾åï¼Œå› ä¸ºå‡½æ•°æè¿°ç¬¦å¯ä»¥é€šè¿‡ç›®æ ‡ç±»å‹æ¥å¾—åˆ°ã€‚  
> è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œç¼–è¯‘å™¨å¯ä»¥äº†è§£Lambdaè¡¨è¾¾å¼çš„å‚æ•°ç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨Lambdaè¯­æ³•ä¸­çœå»æ ‡æ³¨å‚æ•°ç±»å‹ã€‚

```java
    // æ— ç±»å‹æ¨æ–­
    Comparator<Apple> c = (Apple a1, Apple a2) -> a1.getWeight().compareTo(a2.getWeight());
    // æœ‰ç±»å‹æ¨æ–­
    Comparator<Apple> c = (a1, a2) -> a1.getWeight().compareTo(a2.getWeight());
```

### ä½¿ç”¨å±€éƒ¨å˜é‡
æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æ‰€ä»‹ç»çš„æ‰€æœ‰Lambdaè¡¨è¾¾å¼éƒ½åªç”¨åˆ°äº†å…¶ä¸»ä½“é‡Œé¢çš„å‚æ•°ã€‚ä½†Lambdaè¡¨è¾¾å¼ä¹Ÿå…è®¸ä½¿ç”¨è‡ªç”±å˜é‡ï¼ˆä¸æ˜¯å‚æ•°ï¼Œè€Œæ˜¯åœ¨å¤–å±‚ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡ï¼‰ï¼Œ
å°±åƒåŒ¿åç±»ä¸€æ ·ã€‚ å®ƒä»¬è¢«ç§°ä½œæ•è·Lambdaã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„Lambdaæ•è·äº†portNumberå˜é‡ï¼š
```java
    int portNumber = 1337;
    Runnable r = () -> System.out.println(portNumber);
```
å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æœ‰ä¸€ç‚¹ç‚¹å°éº»çƒ¦ï¼šå…³äºèƒ½å¯¹è¿™äº›å˜é‡åšä»€ä¹ˆæœ‰ä¸€äº›é™åˆ¶ã€‚ Lambdaå¯ä»¥æ²¡æœ‰é™åˆ¶åœ°æ•è·ï¼ˆä¹Ÿå°±æ˜¯åœ¨å…¶ä¸»ä½“ä¸­å¼•ç”¨ï¼‰å®ä¾‹å˜é‡å’Œé™æ€å˜é‡ã€‚
ä½†å±€éƒ¨å˜é‡å¿…é¡»æ˜¾å¼å£°æ˜ä¸ºfinalï¼Œæˆ–äº‹å®ä¸Šæ˜¯finalã€‚
æ¢å¥è¯è¯´ï¼Œ Lambdaè¡¨è¾¾å¼åªèƒ½æ•è·æŒ‡æ´¾ç»™å®ƒä»¬çš„å±€éƒ¨å˜é‡ä¸€æ¬¡ã€‚ï¼ˆæ³¨ï¼šæ•è·å®ä¾‹å˜é‡å¯ä»¥è¢«çœ‹ä½œæ•è·æœ€ç»ˆå±€éƒ¨å˜é‡thisã€‚ï¼‰

ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ— æ³•ç¼–è¯‘ï¼Œå› ä¸ºportNumber å˜é‡è¢«èµ‹å€¼ä¸¤æ¬¡ï¼š
```java
    int portNumber = 1337;
    Runnable r = () -> System.out.println(portNumber);
    portNumber = 31337;
```
**`å¯¹å±€éƒ¨å˜é‡çš„é™åˆ¶`**
- ä½ å¯èƒ½ä¼šé—®è‡ªå·±ï¼Œä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡æœ‰è¿™äº›é™åˆ¶ã€‚
    1. ç¬¬ä¸€ï¼Œå®ä¾‹å˜é‡å’Œå±€éƒ¨å˜é‡èƒŒåçš„å®ç°æœ‰ä¸€ä¸ªå…³é”®ä¸åŒã€‚å®ä¾‹å˜é‡éƒ½å­˜å‚¨åœ¨å †ä¸­ï¼Œè€Œå±€éƒ¨å˜é‡åˆ™ä¿å­˜åœ¨æ ˆä¸Šã€‚
        - å¦‚æœLambdaå¯ä»¥ç›´æ¥è®¿é—®å±€éƒ¨å˜é‡ï¼Œè€Œä¸”Lambdaæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨çš„ï¼Œåˆ™ä½¿ç”¨Lambdaçš„çº¿ç¨‹ï¼Œå¯èƒ½ä¼šåœ¨åˆ†é…è¯¥å˜é‡çš„çº¿ç¨‹å°†è¿™ä¸ªå˜é‡æ”¶å›ä¹‹åï¼Œå»è®¿é—®è¯¥å˜é‡ã€‚
        - å› æ­¤ï¼Œ Javaåœ¨è®¿é—®è‡ªç”±å±€éƒ¨å˜é‡æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¿é—®å®ƒçš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯è®¿é—®åŸå§‹å˜é‡ã€‚å¦‚æœå±€éƒ¨å˜é‡ä»…ä»…èµ‹å€¼ä¸€æ¬¡é‚£å°±æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«äº†â€”â€”å› æ­¤å°±æœ‰äº†è¿™ä¸ªé™åˆ¶ã€‚
    1. ç¬¬äºŒï¼Œè¿™ä¸€é™åˆ¶ä¸é¼“åŠ±ä½ ä½¿ç”¨æ”¹å˜å¤–éƒ¨å˜é‡çš„å…¸å‹å‘½ä»¤å¼ç¼–ç¨‹æ¨¡å¼ï¼ˆè¿™ç§æ¨¡å¼ä¼šé˜»ç¢å¾ˆå®¹æ˜“åšåˆ°çš„å¹¶è¡Œå¤„ç†ï¼‰ã€‚

**`é—­åŒ…`**

ä½ å¯èƒ½å·²ç»å¬è¯´è¿‡é—­åŒ…ï¼ˆclosureï¼Œä¸è¦å’ŒClojureç¼–ç¨‹è¯­è¨€æ··æ·†ï¼‰è¿™ä¸ªè¯ï¼Œä½ å¯èƒ½ä¼šæƒ³Lambdaæ˜¯å¦æ»¡è¶³é—­åŒ…çš„å®šä¹‰ã€‚
ç”¨ç§‘å­¦çš„è¯´æ³•æ¥è¯´ï¼Œé—­åŒ…å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„å®ä¾‹ï¼Œä¸”å®ƒå¯ä»¥æ— é™åˆ¶åœ°è®¿é—®é‚£ä¸ªå‡½æ•°çš„éæœ¬åœ°å˜é‡ã€‚ä¾‹å¦‚ï¼Œé—­åŒ…å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚
å®ƒä¹Ÿå¯ä»¥è®¿é—®å’Œä¿®æ”¹å…¶ä½œç”¨åŸŸä¹‹å¤–çš„å˜é‡ã€‚ç°åœ¨ï¼Œ Java 8çš„Lambdaå’ŒåŒ¿åç±»å¯ä»¥åšç±»ä¼¼äºé—­åŒ…çš„äº‹æƒ…ï¼š
å®ƒä»¬å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®å…¶ä½œç”¨åŸŸä¹‹å¤–çš„å˜é‡ã€‚ä½†æœ‰ä¸€ä¸ªé™åˆ¶ï¼šå®ƒä»¬ä¸èƒ½ä¿®æ”¹å®šä¹‰Lambdaçš„æ–¹æ³•çš„å±€éƒ¨å˜é‡çš„å†…å®¹ã€‚
è¿™äº›å˜é‡å¿…é¡»æ˜¯éšå¼æœ€ç»ˆçš„ã€‚å¯ä»¥è®¤ä¸ºLambdaæ˜¯å¯¹å€¼å°é—­ï¼Œè€Œä¸æ˜¯å¯¹å˜é‡å°é—­ã€‚å¦‚å‰æ‰€è¿°ï¼Œè¿™ç§é™åˆ¶å­˜åœ¨çš„åŸå› åœ¨äºå±€éƒ¨å˜é‡ä¿å­˜åœ¨æ ˆä¸Šï¼Œ
å¹¶ä¸”éšå¼è¡¨ç¤ºå®ƒä»¬ä»…é™äºå…¶æ‰€åœ¨çº¿ç¨‹ã€‚å¦‚æœå…è®¸æ•è·å¯æ”¹å˜çš„å±€éƒ¨å˜é‡ï¼Œå°±ä¼šå¼•å‘é€ æˆçº¿ç¨‹ä¸å®‰å…¨çš„æ–°çš„å¯èƒ½æ€§ï¼Œ
è€Œè¿™æ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„ï¼ˆå®ä¾‹å˜é‡å¯ä»¥ï¼Œå› ä¸ºå®ƒä»¬ä¿å­˜åœ¨å †ä¸­ï¼Œè€Œå †æ˜¯åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«çš„ï¼‰ ã€‚

## å¤åˆ Lambda è¡¨è¾¾å¼
åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥æŠŠå¤šä¸ªç®€å•çš„Lambdaå¤åˆæˆå¤æ‚çš„è¡¨è¾¾å¼ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥è®©ä¸¤ä¸ªè°“è¯ä¹‹é—´åšä¸€ä¸ªoræ“ä½œï¼Œç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„è°“è¯ã€‚
è€Œä¸”ï¼Œä½ è¿˜å¯ä»¥è®©ä¸€ä¸ªå‡½æ•°çš„ç»“æœæˆä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚
çªé—¨åœ¨äºï¼Œæˆ‘ä»¬å³å°†ä»‹ç»çš„æ–¹æ³•éƒ½æ˜¯**é»˜è®¤æ–¹æ³•**ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¸æ˜¯æŠ½è±¡æ–¹æ³•ã€‚

### æ¯”è¾ƒå™¨å¤åˆ
> [Java Comparator çè—ç‰ˆ ](https://mp.weixin.qq.com/s?__biz=MzAxODcyNjEzNQ==&mid=2247487247&idx=1&sn=55dc46cdde683b79864997a183c258df&chksm=9bd0a297aca72b8106cb40bedade4a69d539dbdbb579bed6238a54cf30bb270b8b4a8e45ec04&mpshare=1&scene=1&srcid=#rd)

1. å•ä¸€å±æ€§æ¯”è¾ƒ `Comparator<Apple> c = Comparator.comparing(Apple::getWeight);` (å®ç”¨çš„**Comparator.comparing**æ–¹æ³•)
    - é¡ºåº(å°åˆ°å¤§) é€†åºåˆ™å†è°ƒç”¨ä¸‹ reversed()
1. æŒ‰é‡é‡æ’åº, é‡é‡ä¸€è‡´åˆ™å†æŒ‰å›½å®¶æ’åº `inventory.sort(comparing(Apple::getWeight).thenComparing(Apple::getCountry));`
1. nullsFirstæ˜¯ComparatoråŠŸèƒ½æ¥å£çš„é™æ€æ–¹æ³•ã€‚Comparator.nullsFirstæ–¹æ³•è¿”å›ä¸€ä¸ªç©ºå€¼å‹å¥½çš„æ¯”è¾ƒå™¨ï¼Œè¯¥æ¯”è¾ƒå™¨å°†nullè§†ä¸ºå°äºénullã€‚
    1. nullLast ä¸ä¹‹ç›¸å

### è°“è¯å¤åˆ
> è°“è¯æ¥å£åŒ…æ‹¬ä¸‰ä¸ªæ–¹æ³•ï¼š negateã€ andå’Œorï¼Œè®©ä½ å¯ä»¥é‡ç”¨å·²æœ‰çš„Predicateæ¥åˆ›å»ºæ›´å¤æ‚çš„è°“è¯ã€‚  
> è¯·æ³¨æ„ï¼Œ andå’Œoræ–¹æ³•æ˜¯æŒ‰ç…§åœ¨è¡¨è¾¾å¼é“¾ä¸­çš„ä½ç½®ï¼Œä»å·¦å‘å³ç¡®å®šä¼˜å…ˆçº§çš„ã€‚å› æ­¤ï¼Œ a.or(b).and(c)å¯ä»¥çœ‹ä½œ(a || b) && cã€‚

1. ä¸çº¢ `Predicate<Apple> notRedApple = redApple.negate();`
1. çº¢ä¸”é‡`Predicate<Apple> redAndHeavyApple = redApple.and(a -> a.getWeight() > 150);`
1. çº¢ä¸”é‡æˆ–è€…æ˜¯ç»¿çš„ `Predicate<Apple> redAndHeavyAppleOrGreen = redApple.and(a -> a.getWeight() > 150).or(a -> "green".equals(a.getColor()));`

### å‡½æ•°å¤åˆ
å¯ä»¥æŠŠFunctionæ¥å£æ‰€ä»£è¡¨çš„Lambdaè¡¨è¾¾å¼å¤åˆèµ·æ¥ã€‚ Functionæ¥å£ä¸ºæ­¤é…äº†andThenå’Œcomposeä¸¤ä¸ªé»˜è®¤æ–¹æ³•ï¼Œå®ƒä»¬éƒ½ä¼šè¿”å›Functionçš„ä¸€ä¸ªå®ä¾‹ã€‚

```java
    Function<Integer, Integer> f = x -> x + 1;
    Function<Integer, Integer> g = x -> x * 2;
    Function<Integer, Integer> h = f.andThen(g); // g(f(x))
    int result = h.apply(1);

    Function<Integer, Integer> f = x -> x + 1;
    Function<Integer, Integer> g = x -> x * 2;
    Function<Integer, Integer> h = f.compose(g); // f(g(x))
    int result = h.apply(1);
```

> ä½¿ç”¨åœºæ™¯ ç”¨Stringè¡¨ç¤ºçš„ä¸€å°ä¿¡åšæ–‡æœ¬è½¬æ¢ï¼šç°åœ¨ä½ å¯ä»¥é€šè¿‡å¤åˆè¿™äº›å·¥å…·æ–¹æ³•æ¥åˆ›å»ºå„ç§è½¬å‹æµæ°´çº¿äº†  
> æ¯”å¦‚åˆ›å»ºä¸€ä¸ªæµæ°´çº¿ï¼šå…ˆåŠ ä¸ŠæŠ¬å¤´ï¼Œç„¶åè¿›è¡Œæ‹¼å†™æ£€æŸ¥ï¼Œæœ€ååŠ ä¸Šä¸€ä¸ªè½æ¬¾ï¼Œ
```java
    Function<String, String> addHeader = Letter::addHeader;
    Function<String, String> transformationPipeline = addHeader
        .andThen(Letter::checkSpelling)
        .andThen(Letter::addFooter);
```

**`å’Œæ•°å­¦å¯¹æ¯”`**
ä¾‹å¦‚ æ ¹æ®ç»™å®šçš„æŸä¸ªå‡½æ•° ä»¥åŠä¸Šä¸‹é™, æ±‚ç§¯åˆ†: å®šä¹‰å‡½æ•° integrate `integrate(f, 3, 7)`

```java
    public double integrate(DoubleFunction<Double> f, double a, double b) {
        return (f.apply(a) + f.apply(b)) * (b-a) / 2.0;
    }
```
## åˆ©ç”¨Lambdaå¼€å‘DSLæ¡†æ¶

**********************************

# Stream
> [å‚è€ƒ: Java 8 ä¸­çš„ Streams API è¯¦è§£](https://www.ibm.com/developerworks/cn/java/j-lo-java8streamapi/)

- Java 8ä¸­çš„Stream APIå¯ä»¥è®©ä½ å†™å‡ºè¿™æ ·çš„ä»£ç 
    1. å£°æ˜æ€§, æ›´ç®€æ´, æ›´æ˜“è¯»
    1. å¯å¤åˆ, æ›´çµæ´»
    1. å¯å¹¶è¡Œ, æ€§èƒ½æ›´å¥½

- Stream ç®€çŸ­çš„å®šä¹‰å°±æ˜¯ â€œä»æ”¯æŒæ•°æ®å¤„ç†æ“ä½œçš„æºï¼Œç”Ÿæˆçš„å…ƒç´ åºåˆ—â€
    - **å…ƒç´ åºåˆ—** 
        - å°±åƒé›†åˆä¸€æ ·ï¼Œæµä¹Ÿæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥è®¿é—®ç‰¹å®šå…ƒç´ ç±»å‹çš„ä¸€ç»„æœ‰åºå€¼ã€‚
        - å› ä¸ºé›†åˆæ˜¯æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä»¥ç‰¹å®šçš„æ—¶é—´/ç©ºé—´å¤æ‚åº¦å­˜å‚¨å’Œç´ ï¼ˆå¦‚ArrayListä¸LinkedListï¼‰ã€‚
        - ä½†æµçš„ç›®çš„åœ¨äºè¡¨è¾¾è®¡ç®—ï¼Œæ¯”å¦‚ä½ å‰é¢è§åˆ°çš„filterã€sorted å’Œmapã€‚é›†åˆè®²çš„æ˜¯æ•°æ®ï¼Œæµè®²çš„æ˜¯è®¡ç®—ã€‚
    - **æº** 
        - æµä¼šä½¿ç”¨ä¸€ä¸ªæä¾›æ•°æ®çš„æºï¼Œå¦‚é›†åˆã€æ•°ç»„æˆ–è¾“å…¥/è¾“å‡ºèµ„æºã€‚è¯·æ³¨æ„ï¼Œä»æœ‰åºé›†åˆç”Ÿæˆæµæ—¶ä¼šä¿ç•™åŸæœ‰çš„é¡ºåºã€‚ç”±åˆ—è¡¨ç”Ÿæˆçš„æµï¼Œå…¶å…ƒç´ é¡ºåºä¸åˆ—è¡¨ä¸€è‡´ã€‚
    - **æ•°æ®å¤„ç†æ“ä½œ**
        -  æµçš„æ•°æ®å¤„ç†åŠŸèƒ½æ”¯æŒç±»ä¼¼äºæ•°æ®åº“çš„æ“ä½œï¼Œä»¥åŠå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„å¸¸ç”¨æ“ä½œï¼Œå¦‚filterã€mapã€reduceã€findã€matchã€sortç­‰ã€‚æµæ“ä½œå¯ä»¥é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå¯å¹¶è¡Œæ‰§è¡Œ
    - **å†…éƒ¨è¿­ä»£**
        - ä¸ä½¿ç”¨è¿­ä»£å™¨æ˜¾å¼è¿­ä»£çš„é›†åˆä¸åŒï¼Œæµçš„è¿­ä»£æ“ä½œæ˜¯åœ¨èƒŒåè¿›è¡Œçš„ã€‚

> æ³¨æ„ï¼š
- é€šå¸¸ç®€å•çš„è¿­ä»£ä½¿ç”¨å¤–éƒ¨è¿­ä»£æ€§èƒ½ä¼šæ›´å¥½ï¼Œå¤æ‚æ“ä½œä½¿ç”¨Streamèƒ½è®©JDKä¸ºä½ åœ¨è¿­ä»£æ—¶åšä¼˜åŒ–
- ä½¿ç”¨ parallel() å¼€å¯å¹¶è¡Œæµæ—¶è¦æ³¨æ„æ­¤æ—¶å¹¶è¡Œæ˜¯ä¾èµ–JVMå†…å…¨å±€å…±ç”¨çš„Forkjoinçº¿ç¨‹æ± å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç†è®ºä¸Šä¼šå‘ç”Ÿï¼š
    - ä½¿ç”¨äº†å¹¶è¡Œæµçš„ä¸šåŠ¡ä»£ç Aè€—æ—¶å¾ˆä¹…ä¼šå¡ä½ä½¿ç”¨äº†å¹¶è¡Œæµä¸šåŠ¡ä»£ç Bï¼Œè¿™ç§é—®é¢˜å‘ç”Ÿäº†å°±æ¯”è¾ƒéš¾æ’æŸ¥äº†ï¼Œæ‰€ä»¥å¹¶è¡Œæµé€šå¸¸ä½¿ç”¨è¾ƒå°‘ï¼Œæœ‰å¼‚æ­¥åœºæ™¯å‡æŒ‰ä¸šåŠ¡ç‹¬ç«‹çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†ä¼šæ›´å¥½

> [JDFrame](https://github.com/burukeYou/JDFrame)`å°è£…å‡ºç±»ä¼¼Spark Frame çš„API`

************************

## Streamä¸é›†åˆ

ç²—ç•¥åœ°è¯´ï¼Œé›†åˆä¸æµä¹‹é—´çš„å·®å¼‚å°±åœ¨äºä»€ä¹ˆæ—¶å€™è¿›è¡Œè®¡ç®—ã€‚é›†åˆæ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„æ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«æ•°æ®ç»“æ„ä¸­ç›®å‰æ‰€æœ‰çš„å€¼â€”â€”é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¾—å…ˆç®—å‡ºæ¥æ‰èƒ½æ·»åŠ åˆ°é›†åˆä¸­ã€‚  
ï¼ˆä½ å¯ä»¥å¾€é›†åˆé‡ŒåŠ ä¸œè¥¿æˆ–è€…åˆ ä¸œè¥¿ï¼Œä½†æ˜¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ï¼Œé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æ”¾åœ¨å†…å­˜é‡Œçš„ï¼Œå…ƒç´ éƒ½å¾—å…ˆç®—å‡ºæ¥æ‰èƒ½æˆä¸ºé›†åˆçš„ä¸€éƒ¨åˆ†ï¼‰  
ç›¸æ¯”ä¹‹ä¸‹ï¼Œæµåˆ™æ˜¯åœ¨æ¦‚å¿µä¸Šå›ºå®šçš„æ•°æ®ç»“æ„ï¼ˆä½ ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼‰ï¼Œå…¶å…ƒç´ åˆ™æ˜¯æŒ‰éœ€è®¡ç®—çš„ã€‚

ä¾‹å¦‚æ„å»ºä¸€ä¸ªè´¨æ•°æµ, å¯¹æ‰€æœ‰çš„è´¨æ•°å¤„ç†, å¦‚æœä½¿ç”¨é›†åˆå°±è¦æŠŠæ‰€æœ‰çš„è´¨æ•°æ„å»ºå‡ºæ¥, ç„¶ååšä¸‹ä¸€æ­¥æ“ä½œ, ä½†æ˜¯æµåªä¼šæŒ‰éœ€ç”Ÿæˆã€‚  
è¿™æ˜¯ä¸€ç§ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…çš„å…³ç³». ä»å¦ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œæµå°±åƒæ˜¯ä¸€ä¸ªå»¶è¿Ÿåˆ›å»ºçš„é›†åˆï¼šåªæœ‰åœ¨æ¶ˆè´¹è€…è¦æ±‚çš„æ—¶å€™æ‰ä¼šè®¡ç®—å€¼

### åªèƒ½éå†ä¸€æ¬¡
> å’Œè¿­ä»£å™¨ç±»ä¼¼ï¼Œæµåªèƒ½éå†ä¸€æ¬¡, éå†å®Œä¹‹åï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªæµå·²ç»è¢«æ¶ˆè´¹æ‰äº†  
> ä»å“²å­¦çš„è§’åº¦çœ‹, é›†åˆæ˜¯ç©ºé—´ä¸­åˆ†å¸ƒçš„ä¸€ç»„å€¼, è€Œæµæ˜¯æ—¶é—´ä¸­åˆ†å¸ƒçš„ä¸€ç»„å€¼

### å¤–éƒ¨è¿­ä»£å’Œå†…éƒ¨è¿­ä»£
- ä½¿ç”¨Collectionæ¥å£éœ€è¦ç”¨æˆ·å»åšè¿­ä»£ï¼ˆæ¯”å¦‚ç”¨for-eachï¼‰ï¼Œè¿™ç§°ä¸ºå¤–éƒ¨è¿­ä»£ã€‚  
- ç›¸åï¼ŒStreamsåº“ä½¿ç”¨å†…éƒ¨è¿­ä»£â€”â€”å®ƒå¸®ä½ æŠŠè¿­ä»£åšäº†ï¼Œè¿˜æŠŠå¾—åˆ°çš„æµå€¼å­˜åœ¨äº†æŸä¸ªåœ°æ–¹ï¼Œä½ åªè¦ç»™å‡ºä¸€ä¸ªå‡½æ•°å£°æ˜è¿­ä»£ä¸­æ‰§è¡Œçš„æ“ä½œå³å¯ã€‚

- å¤–éƒ¨è¿­ä»£
    - æ˜¾å¼çš„è¿­ä»£é›†åˆ, å‘½ä»¤å¼çš„æ‰§è¡Œæ“ä½œ
- å†…éƒ¨è¿­ä»£
    - å°†è¿­ä»£çš„ç»†èŠ‚éšè—èµ·æ¥, æ–¹ä¾¿ä¼˜åŒ–

************************

## æ„å»ºæµ
> ä»å€¼åºåˆ—ã€æ•°ç»„ã€æ–‡ä»¶æ¥åˆ›å»ºæµï¼Œç”šè‡³ç”±å‡½æ•°åˆ›å»ºæ— é™æµ

### æœ‰é™æµ
> ç”±å€¼åˆ›å»ºæµ
```java
Stream<String> stream = Stream.of("Java 8 ", "Lambdas ", "In ", "Action"); 
```

> ç”±æ•°ç»„åˆ›å»ºæµ
```java
    int[] numbers = {2, 3, 5, 7, 11, 13}; 
    int sum = Arrays.stream(numbers).sum(); 
```

> ç”±æ–‡ä»¶ç”Ÿæˆæµ

Javaä¸­ç”¨äºå¤„ç†æ–‡ä»¶ç­‰I/Oæ“ä½œçš„NIO  APIï¼ˆéé˜»å¡I/Oï¼‰å·²æ›´æ–°ï¼Œä»¥ä¾¿åˆ©ç”¨Stream  APIã€‚java.nio.file.Filesä¸­çš„å¾ˆå¤šé™æ€æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªæµã€‚

```java
    long uniqueWords = 0; 
    try(Stream<String> lines = Files.lines(Paths.get("data.txt"), Charset.defaultCharset())){ 
        uniqueWords = lines.flatMap(line -> Arrays.stream(line.split(" "))).distinct() .count(); 
    }catch(IOException e){} 
```

### æ— é™æµ
> Stream APIæä¾›äº†ä¸¤ä¸ªé™æ€æ–¹æ³•æ¥ **ä»å‡½æ•°ç”Ÿæˆæµ**ï¼š`Stream.iterate` å’Œ `Stream.generate`ã€‚è¿™ä¸¤ä¸ªæ“ä½œå¯ä»¥åˆ›å»ºæ‰€è°“çš„ **æ— é™æµ**  
> åŒæ ·ï¼Œä½ ä¸èƒ½å¯¹æ— é™æµåšæ’åºæˆ–å½’çº¦ï¼Œå› ä¸ºæ‰€æœ‰å…ƒç´ éƒ½éœ€è¦å¤„ç†ï¼Œè€Œè¿™æ°¸è¿œä¹Ÿå®Œä¸æˆï¼

**`è¿­ä»£`**
```java
    Stream.iterate(0, n -> n + 2).limit(10).forEach(System.out::println); 

    // è·å–æ–æ³¢é‚£å¥‘åºåˆ— å…ƒç»„
    Stream.iterate(new int[]{0, 1}, t -> new int[]{t[1], t[0]+t[1]}) 
      .limit(20) 
      .forEach(t -> System.out.println("(" + t[0] + "," + t[1] +")")); 
```

**`ç”Ÿæˆ`**
```java
    Stream.generate(Math::random).limit(5).forEach(System.out::println); 
    // å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨å¹¶è¡Œä»£ç ä¸­ä½¿ç”¨æœ‰çŠ¶æ€çš„ä¾›åº”æºæ˜¯ä¸å®‰å…¨çš„ã€‚å› æ­¤ä¸‹é¢çš„ä»£ç ä»…ä»…æ˜¯ä¸ºäº†å†…å®¹å®Œæ•´ï¼Œåº”å°½é‡é¿å…ä½¿ç”¨ï¼
    IntSupplier fib = new IntSupplier(){ 
        private int previous = 0; 
        private int current = 1; 
        public int getAsInt(){ 
            int oldPrevious = this.previous; 
            int nextValue = this.previous + this.current; 
            this.previous = this.current; 
            this.current = nextValue; 
            return oldPrevious; 
        } 
    }; 
    IntStream.generate(fib).limit(10).forEach(System.out::println); 
```

> åˆ¤æ–­æ— é™æµï¼š `stream.spliterator().estimateSize()`

## æ•°å€¼æµ

### åŸå§‹ç±»å‹ç‰¹åŒ–
Java8 å¼•å…¥äº†ä¸‰ä¸ªåŸå§‹ç±»å‹ç‰¹åŒ–æµæ¥å£æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š `IntStreamã€DoubleStream å’Œ LongStream`ï¼Œåˆ†åˆ«å°†æµä¸­çš„å…ƒç´ ç‰¹åŒ–ä¸ºintã€longå’Œdoubleï¼Œä»è€Œé¿å…äº†æš—å«çš„è£…ç®±æˆæœ¬ã€‚

**æ˜ å°„åˆ°æ•°å€¼æµ**
```java
    // ä¾‹å¦‚æ±‚å’Œ, é‡Œé¢æœ‰ä¸€ä¸ªéšå«çš„æ‹†ç®±æ“ä½œ å†æ±‚å’Œ
    numbers.parallelStream().reduce(0, Integer::sum);

    // è¯·æ³¨æ„ï¼Œå¦‚æœæµæ˜¯ç©ºçš„ï¼Œsumé»˜è®¤è¿”å› 0
    numbers.parallelStream().mapToInt(Integer::intValue).sum() 
```

**æ˜ å°„åˆ°å¯¹è±¡æµ**
ä½¿ç”¨ boxed() æ–¹æ³•å³å¯

**é»˜è®¤å€¼OptionalInt**
```java
    OptionalInt maxCalories = menu.stream().mapToInt(Dish::getCalories).max(); 
```
### æ•°å€¼èŒƒå›´
IntStreamå’ŒLongStream çš„ range() æˆ–è€… rangeClose() æ–¹æ³•èƒ½äº§ç”Ÿä¸€ä¸ªæ•°å€¼æµ
> ä¾‹å¦‚ IntStream.rangeClose(1,100).filter(num->num%2==0).count() ç»Ÿè®¡100ä»¥å†…çš„å¶æ•°

> **è·å–å‹¾è‚¡æ•°æµ**
```java
    Stream<int[]> pythagoreanTriples = IntStream.rangeClosed(1, 100).boxed() .flatMap(a -> 
        IntStream.rangeClosed(a, 100) 
                .filter(b -> Math.sqrt(a*a + b*b) % 1 == 0) 
                .mapToObj(b -> new int[]{a, b, (int)Math.sqrt(a * a + b * b)}) 
            ); 
    
    pythagoreanTriples.limit(5) .forEach(t -> System.out.println(t[0] + ", " + t[1] + ", " + t[2])); 
```

************************

## Streamæ“ä½œ
å› ä¸ºfilterã€sortedã€map å’Œcollect ç­‰æ“ä½œæ˜¯ä¸å…·ä½“çº¿ç¨‹æ¨¡å‹æ— å…³çš„é«˜å±‚æ¬¡æ„ä»¶, æ‰€ä»¥å®ƒä»¬çš„å†…éƒ¨å®ç°å¯ä»¥æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå¯èƒ½é€æ˜åœ°å……åˆ†åˆ©ç”¨ä½ çš„å¤šæ ¸æ¶æ„

### ä¸­é—´æ“ä½œ
è¯¸å¦‚ filter æˆ– sorted  map flatMap limit distinct ç­‰ä¸­é—´æ“ä½œä¼šè¿”å›å¦ä¸€ä¸ªæµã€‚è¿™è®©å¤šä¸ªæ“ä½œå¯ä»¥è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªæŸ¥è¯¢ã€‚ 
é‡è¦çš„æ˜¯ï¼Œé™¤éæµæ°´çº¿ä¸Šè§¦å‘ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå¦åˆ™ä¸­é—´æ“ä½œä¸ä¼šæ‰§è¡Œä»»ä½•å¤„ç†å› ä¸ºä¸­é—´æ“ä½œä¸€èˆ¬éƒ½å¯ä»¥åˆå¹¶èµ·æ¥ï¼Œåœ¨ç»ˆç«¯æ“ä½œæ—¶ä¸€æ¬¡æ€§å…¨éƒ¨å¤„ç† (å¾ªç¯åˆå¹¶)

1. filter æ»¡è¶³è¯¥æ¡ä»¶çš„å…ƒç´ ä¿ç•™ä¸‹æ¥
1. map å°†ä¸€ä¸ªæµä¸­çš„æ¯ä¸ªå…ƒç´ é€šè¿‡ ä¸€ç§æ˜ å°„ å¾—åˆ°æ–°çš„å…ƒç´ ç»„æˆçš„æµ
1. flatMap ä½¿ç”¨æµæ—¶ï¼Œ flatMapæ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦ä¸€ä¸ªæµã€‚è¿™ä¸ªæ–¹æ³•ä¼šåº”ç”¨åˆ°æµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªæ–°çš„æµçš„æµã€‚

| æ“ä½œ | ç±»å‹ | è¿”å›ç±»å‹ | å‚æ•° | å‡½æ•°æè¿°ç¬¦ |
|:----|:----|:----|:----|:----|
| filter                |æ— çŠ¶æ€    |`Stream<T>` | `Predicate<T>` | T -> boolean |
| peek                  |æ— çŠ¶æ€    |`Stream<T>` | `Consumer<T>`  | T -> void |
| unordered             |æ— çŠ¶æ€    |`Stream<T>` |                | T -> boolean |
| map/mapToXxx          |æ— çŠ¶æ€    |`Stream<R>` |`Function<T, R>`| T -> R|
| flatMap/flatMapToXxx  |æ— çŠ¶æ€    |`Stream<R>` |`Function<T, Stream<R>>`| T -> `Stream<R>`|
| sorted                |æœ‰çŠ¶æ€ æ— ç•Œ|`Stream<T>`| `Comparator<T>` |(T,T) -> int|
| skip                  |æœ‰çŠ¶æ€ æœ‰ç•Œ|`Stream<T>`|long||
| limit                 |æœ‰çŠ¶æ€ æœ‰ç•Œ|`Stream<T>`|long||
| distinct              |æœ‰çŠ¶æ€ æ— ç•Œ|`Stream<T>`|||

### ç»ˆç«¯æ“ä½œ
> éçŸ­è·¯æ“ä½œ

| æ“ä½œ | ç±»å‹ | è¿”å›ç±»å‹ | å‚æ•° | å‡½æ•°æè¿°ç¬¦ | ç›®çš„ | 
|:----|:----|:----|:----|:----|:---|
| forEach/forEachOrdered |æ— çŠ¶æ€     |void|``Consumer<T>``| T -> void| æ¶ˆè´¹æµä¸­çš„å…ƒç´  |
|collect                 |æ— çŠ¶æ€     |R|`Collector<T, A, R>`||
|reduce                  |æœ‰çŠ¶æ€ æœ‰ç•Œ |`Optional<T>`|`BinaryOprator<T>`|(T, T) -> T| æŠŠæµå½’çº¦æˆä¸€ä¸ªé›†åˆï¼Œæ¯”å¦‚Listã€Mapç”šè‡³æ˜¯Integer|
|count                   |æ— çŠ¶æ€     |long||| è¿”å›æµä¸­å…ƒç´ çš„ä¸ªæ•°|
| toArray ||
| min/max/count ||

> çŸ­è·¯æ“ä½œ

| æ“ä½œ | è¿”å›ç±»å‹ | å‚æ•° | å‡½æ•°æè¿°ç¬¦ | ç›®çš„ |
|:----|:----|:----|:----|:----|
| allMatch/anyMatch/noneMatch |boolean|``Predicate<T>``| T -> boolean | |
| findFirst/findAny |`Optional<T>`|||

**********

## Streamçš„ä½¿ç”¨
- æµçš„ä½¿ç”¨ä¸€èˆ¬åŒ…æ‹¬ä¸‰ä»¶äº‹ï¼š
    - ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚é›†åˆï¼‰æ¥æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼›
    - ä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå½¢æˆä¸€æ¡æµçš„æµæ°´çº¿ï¼›
    - ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œæ‰§è¡Œæµæ°´çº¿ï¼Œå¹¶èƒ½ç”Ÿæˆç»“æœã€‚
    > æµçš„æµæ°´çº¿èƒŒåçš„ç†å¿µç±»ä¼¼äºæ„å»ºå™¨æ¨¡å¼ åœ¨æ„å»ºå™¨æ¨¡å¼ä¸­æœ‰ä¸€ä¸ªè°ƒç”¨é“¾ç”¨æ¥è®¾ç½®ä¸€å¥—é…ç½®ï¼ˆå¯¹æµæ¥è¯´è¿™å°±æ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼‰ï¼Œæ¥ç€æ˜¯è°ƒç”¨ buildæ–¹æ³• ï¼ˆå¯¹æµæ¥è¯´å°±æ˜¯ç»ˆç«¯æ“ä½œï¼‰

### ç­›é€‰
1. åˆ©ç”¨ filter ä½¿ç”¨è°“è¯ Predicate ç­›é€‰
1. å»é‡ distinct()
1. æˆªæ–­ limit(n) åªèƒ½æŒ‰æµçš„é•¿åº¦å•å‘æˆªæ–­
1. è·³è¿‡å…ƒç´  skip(n)

### æ˜ å°„
- æµæ”¯æŒmapæ–¹æ³•ï¼Œå®ƒä¼šæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ 
    - ï¼ˆä½¿ç”¨æ˜ å°„ä¸€è¯ï¼Œæ˜¯å› ä¸ºå®ƒå’Œè½¬æ¢ç±»ä¼¼ï¼Œä½†å…¶ä¸­çš„ç»†å¾®å·®åˆ«åœ¨äºå®ƒæ˜¯â€œåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬â€è€Œä¸æ˜¯å»â€œä¿®æ”¹â€ï¼‰

```java
List<Integer> dishNameLengths = menu.stream() 
        .map(Dish::getName) .map(String::length) .collect(toList()); 
```
**`flatMap`**
```java
List<String> uniqueCharacters = words.stream() 
        .map(w -> w.split(""))  // Stream<Arrays>
        .flatMap(Arrays::stream) // æ‰å¹³åŒ–æµ (åˆå¹¶)
        .distinct() 
        .collect(Collectors.toList()); 
```

**ä½¿ç”¨æµçš„æ–¹å¼åµŒå¥—è¿­ä»£**
```java
// ç»™å®šä¸¤ä¸ªæ•°å­—åˆ—è¡¨ï¼Œå¦‚ä½•è¿”å›æ‰€æœ‰çš„æ•°å¯¹å‘¢ï¼Ÿä¾‹å¦‚ï¼Œç»™å®šåˆ—è¡¨[1, 2, 3]å’Œåˆ—è¡¨[3, 4]ï¼Œåº”è¯¥è¿”å›[(1, 3), (1, 4), (2, 3), (2, 4), (3, 3), (3, 4)]
List<Integer> numbers1 = Arrays.asList(1, 2, 3); 
List<Integer> numbers2 = Arrays.asList(3, 4); 
List<int[]> pairs = numbers1.stream() 
    .flatMap(i -> 
        numbers2.stream() .map(j -> new int[]{i, j})
    ).collect(toList()); 
```

### æŸ¥æ‰¾å’ŒåŒ¹é…
> allMatchã€anyMatchã€noneMatchã€findFirst findAny

- éƒ½æ˜¯æ¥å—ä¸€ä¸ª è°“è¯ å‡½æ•°, éƒ½ç”¨åˆ°äº†æˆ‘ä»¬æ‰€è°“çš„çŸ­è·¯,ä¸éœ€è¦å¤„ç†æ‰€æœ‰çš„æµï¼Œè¿™å°±æ˜¯å¤§å®¶ç†Ÿæ‚‰çš„Javaä¸­&&å’Œ||è¿ç®—ç¬¦çŸ­è·¯åœ¨æµä¸­çš„ç‰ˆæœ¬
    - allMatchã€anyMatchã€noneMatch æ˜¯ åŒ¹é… è¿”å›å€¼æ˜¯boolean
    - findFirst findAny æ˜¯æŸ¥æ‰¾ è¿”å› ``Optional<T>`` findFirst é’ˆå¯¹æœ‰åºçš„æµ
        - å¦‚æœä½ ä¸å…³å¿ƒè¿”å›çš„å…ƒç´ æ˜¯å“ªä¸ªï¼Œè¯·ä½¿ç”¨ findAny ï¼Œå› ä¸ºå®ƒåœ¨ä½¿ç”¨å¹¶è¡Œæµæ—¶é™åˆ¶è¾ƒå°‘ã€‚

### å½’çº¦
- å¦‚ä½•æŠŠä¸€ä¸ªæµä¸­çš„å…ƒç´ ç»„åˆèµ·æ¥ï¼Œä½¿ç”¨ reduce æ“ä½œæ¥è¡¨è¾¾æ›´å¤æ‚çš„æŸ¥è¯¢ æ­¤ç±»æŸ¥è¯¢éœ€è¦å°†æµä¸­æ‰€æœ‰å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼
- è¿™æ ·çš„æŸ¥è¯¢å¯ä»¥è¢«å½’ç±»ä¸ºå½’çº¦æ“ä½œï¼ˆå°†æµå½’çº¦æˆä¸€ä¸ªå€¼ï¼‰ã€‚ç”¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„æœ¯è¯­æ¥è¯´ï¼Œè¿™ç§°ä¸ºæŠ˜å ï¼ˆfoldï¼‰

> map å’Œ reduce çš„è¿æ¥é€šå¸¸ç§°ä¸º map-reduce æ¨¡å¼ï¼Œå›  Google ç”¨å®ƒæ¥è¿›è¡Œç½‘ç»œæœç´¢è€Œå‡ºåï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å¹¶è¡ŒåŒ–ã€‚

#### æ±‚å’Œ

```java
    int sum = 0; 
    for (int x : numbers){
        sum += x;
    }

    // reduce å‚æ•°: åˆå§‹å€¼ å‡½æ•°
    int sum = numbers.stream().reduce(0, (a, b) -> a + b);

    int sum = numbers.stream().reduce(0, Integer::sum);

    // æ— åˆå§‹å€¼ è¿”å› Optional å¯¹è±¡
    Optional<Integer> sum = numbers.stream().reduce((a, b) -> (a + b));
```

#### æå€¼

```java
    // æœ€å¤§å€¼
    Optional<Integer> max = numbers.stream().reduce(Integer::max);

    // æœ€å°å€¼
    Optional<Integer> min = numbers.stream().reduce(Integer::min);
    Optional<Integer> min = numbers.stream().reduce((x, y) -> x < y ? x : y);
```

> `return Stream.of(1ï¼Œ2ï¼Œ5ï¼Œ6).summaryStatistics();` åŒ…å«ï¼š æœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œå¹³å‡å€¼ï¼Œæ€»æ•°

#### å½’çº¦çš„ä¼˜åŠ¿ä¸å¹¶è¡ŒåŒ–
ç›¸æ¯”äºå‰é¢å†™çš„é€æ­¥è¿­ä»£æ±‚å’Œï¼Œä½¿ç”¨ reduce çš„å¥½å¤„åœ¨äºï¼Œè¿™é‡Œçš„è¿­ä»£è¢«å†…éƒ¨è¿­ä»£æŠ½è±¡æ‰äº†ï¼Œè¿™è®©å†…éƒ¨å®ç°å¾—ä»¥é€‰æ‹©å¹¶è¡Œæ‰§è¡Œreduce æ“ä½œã€‚  
è€Œè¿­ä»£å¼æ±‚å’Œä¾‹å­è¦æ›´æ–°å…±äº«å˜é‡ sum ï¼Œè¿™ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“å¹¶è¡ŒåŒ–çš„ã€‚å¦‚æœä½ åŠ å…¥äº†åŒæ­¥ï¼Œå¾ˆå¯èƒ½ä¼šå‘ç°çº¿ç¨‹ç«äº‰æŠµæ¶ˆäº†å¹¶è¡Œæœ¬åº”å¸¦æ¥çš„æ€§èƒ½æå‡ï¼  
è¿™ç§è®¡ç®—çš„å¹¶è¡ŒåŒ–éœ€è¦å¦ä¸€ç§åŠæ³•ï¼šå°†è¾“å…¥åˆ†å—ï¼Œåˆ†å—æ±‚å’Œï¼Œæœ€åå†åˆå¹¶èµ·æ¥ã€‚

`int sum = numbers.parallelStream().reduce(0, Integer::sum); `

ä½†è¦å¹¶è¡Œæ‰§è¡Œè¿™æ®µä»£ç ä¹Ÿè¦ä»˜ä¸€å®šä»£ä»·ï¼Œä¼ é€’ç»™ reduce çš„Lambdaä¸èƒ½æ›´æ”¹çŠ¶æ€ï¼ˆå¦‚å®ä¾‹å˜é‡ï¼‰ï¼Œè€Œä¸”æ“ä½œå¿…é¡»æ»¡è¶³ç»“åˆå¾‹æ‰å¯ä»¥æŒ‰ä»»æ„é¡ºåºæ‰§è¡Œã€‚

************************

## æ”¶é›†å™¨çš„ä½¿ç”¨
> å‡½æ•°å¼ç¼–ç¨‹ç›¸å¯¹äºæŒ‡ä»¤å¼ç¼–ç¨‹çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿ï¼šä½ åªéœ€æŒ‡å‡ºå¸Œæœ›çš„ç»“æœâ€”â€”â€œåšä»€ä¹ˆâ€ï¼Œè€Œä¸ç”¨æ“å¿ƒæ‰§è¡Œçš„æ­¥éª¤â€”â€”â€œå¦‚ä½•åšâ€


### é¢„å®šä¹‰æ”¶é›†å™¨
Collectorsæ‰€æä¾›çš„å·¥å‚æ–¹æ³• å®ƒä»¬ä¸»è¦æä¾›äº†ä¸‰å¤§åŠŸèƒ½ï¼šå°†æµå…ƒç´ å½’çº¦å’Œæ±‡æ€»ä¸ºä¸€ä¸ªå€¼ å…ƒç´ åˆ†ç»„ å…ƒç´ åˆ†åŒº

- toList toMap toSet ç­‰æ–¹æ³•

> æ³¨æ„ï¼š toMap æ–¹æ³•çš„ä½¿ç”¨ï¼Œ å½“ key é‡å¤æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ 
> `toMap(k->k, v->v, (a,b)->b);` ä½¿ç”¨è¯¥æ–¹å¼èƒ½é¿å…ï¼Œ è®¾ç½®äº†é‡åˆ°é‡å¤çš„ç­–ç•¥ï¼Œ åè€…è¦†ç›–å‰è€…

#### æ±‡æ€» collector
> Collectorsç±»ä¸“é—¨ä¸ºæ±‡æ€»æä¾›äº†ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼šCollectors.summingInt å®ƒå¯æ¥å—ä¸€ä¸ªæŠŠå¯¹è±¡æ˜ å°„ä¸ºæ±‚å’Œæ‰€éœ€intçš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ”¶é›†å™¨ï¼›è¯¥æ”¶é›†å™¨åœ¨ä¼ é€’ç»™æ™®é€šçš„collectæ–¹æ³•åå³æ‰§è¡Œæˆ‘ä»¬éœ€è¦çš„æ±‡æ€»æ“ä½œ  
> æ±‚å¹³å‡æ•° Collectors.averagingInt

> `summarizing` æ“ä½œä½ å¯ä»¥å¾—å‡ºå…ƒç´ çš„ä¸ªæ•°ï¼Œå¹¶å¾—åˆ°æ€»å’Œã€å¹³å‡å€¼ã€æœ€å¤§å€¼å’Œæœ€å°å€¼
```java
    IntSummaryStatistics menuStatistics = menu.stream().collect(summarizingInt(Dish::getCalories)); 
    // toString(): IntSummaryStatistics{count=9, sum=4300, min=120, average=477.777778, max=800} 
```

**`è¿æ¥å­—ç¬¦ä¸²`**
joiningå·¥å‚æ–¹æ³•è¿”å›çš„æ”¶é›†å™¨ä¼šæŠŠå¯¹æµä¸­æ¯ä¸€ä¸ªå¯¹è±¡åº”ç”¨toStringæ–¹æ³•å¾—åˆ°çš„æ‰€æœ‰å­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
`String shortMenu = menu.stream().collect(joining()); `

Stream.collect å®ç°
```java
    public final <R, A> R collect(Collector<? super P_OUT, A, R> collector) {
        A container;
        if (isParallel()
                && (collector.characteristics().contains(Collector.Characteristics.CONCURRENT))
                && (!isOrdered() || collector.characteristics().contains(Collector.Characteristics.UNORDERED))) {
            container = collector.supplier().get();
            BiConsumer<A, ? super P_OUT> accumulator = collector.accumulator();
            forEach(u -> accumulator.accept(container, u));
        }
        else {
            container = evaluate(ReduceOps.makeRef(collector));
        }
        return collector.characteristics().contains(Collector.Characteristics.IDENTITY_FINISH)
               ? (R) container
               : collector.finisher().apply(container);
    }
```

#### è§„çº¦ reduce
äº‹å®ä¸Šï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºçš„æ‰€æœ‰æ”¶é›†å™¨ï¼Œéƒ½æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨reducingå·¥å‚æ–¹æ³•å®šä¹‰çš„å½’çº¦è¿‡ç¨‹çš„ç‰¹æ®Šæƒ…å†µè€Œå·²ã€‚Collectors.reducingå·¥å‚æ–¹æ³•æ˜¯æ‰€æœ‰è¿™äº›ç‰¹æ®Šæƒ…å†µçš„ä¸€èˆ¬åŒ–ã€‚

- ä¾‹å¦‚ è®¡ç®—æ€»çƒ­é‡ `int totalCalories = menu.stream().collect(reducing(0, Dish::getCalories, (i, j) -> i + j));`
    - ç¬¬ä¸€ä¸ªå‚æ•°: è§„çº¦æ“ä½œçš„èµ·å§‹å€¼ ä¹Ÿæ˜¯å½“æµä¸ºç©ºæ—¶çš„è¿”å›å€¼
    - ç¬¬äºŒä¸ªå‚æ•°: è½¬æ¢å‡½æ•°
    - ç¬¬ä¸‰ä¸ªå‚æ•°: BinaryOperator  å°†ä¸¤ä¸ªé¡¹ç›®ç´¯ç§¯æˆä¸€ä¸ªåŒç±»å‹çš„å€¼

ä½ å¯ä»¥æŠŠå•å‚æ•°reducingå·¥å‚æ–¹æ³•åˆ›å»ºçš„æ”¶é›†å™¨çœ‹ä½œä¸‰å‚æ•°æ–¹æ³•çš„ç‰¹æ®Šæƒ…å†µï¼Œå®ƒæŠŠæµä¸­çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ä½œä¸ºèµ·ç‚¹ï¼ŒæŠŠæ’ç­‰å‡½æ•°ï¼ˆå³ä¸€ä¸ªå‡½æ•°ä»…ä»…æ˜¯è¿”å›å…¶è¾“å…¥å‚æ•°ï¼‰ä½œä¸ºä¸€ä¸ªè½¬æ¢å‡½æ•°ã€‚
è¿™ä¹Ÿæ„å‘³ç€ï¼Œè¦æ˜¯æŠŠå•å‚æ•°reducingæ”¶é›†å™¨ä¼ é€’ç»™ç©ºæµçš„collectæ–¹æ³•ï¼Œæ”¶é›†å™¨å°±æ²¡æœ‰èµ·ç‚¹;å®ƒå°†å› æ­¤è€Œè¿”å›ä¸€ä¸ªOptional<Dish>å¯¹è±¡ã€‚

> 1. æ”¶é›†æ¡†æ¶çš„çµæ´»æ€§ï¼šä»¥ä¸åŒçš„æ–¹æ³•æ‰§è¡ŒåŒæ ·çš„æ“ä½œ

1. ä½¿ç”¨Integerçš„sumæ–¹æ³•ç®€åŒ–ä»¥ä¸Šçš„æ±‚å’Œ `int totalCalories = menu.stream().collect(reducing(0, Dish::getCalories,Integer::sum));`
1. å°†å¯¹è±¡æ˜ å°„ä¸º int ç„¶åè§„çº¦æ±‚å’Œ `int totalCalories = menu.stream().map(Dish::getCalories).reduce(Integer::sum).get(); `
1. æˆ–è€…è½¬ä¸º IntStream `int totalCalories = menu.stream().mapToInt(Dish::getCalories).sum(); `

> 2. æ ¹æ®æƒ…å†µé€‰æ‹©æœ€ä½³è§£å†³æ–¹æ¡ˆ  

å‡½æ•°å¼ç¼–ç¨‹ï¼ˆç‰¹åˆ«æ˜¯Java 8çš„Collectionsæ¡†æ¶ä¸­åŠ å…¥çš„åŸºäºå‡½æ•°å¼é£æ ¼åŸç†è®¾è®¡çš„æ–°APIï¼‰é€šå¸¸æä¾›äº†å¤šç§æ–¹æ³•æ¥æ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œã€‚
è¿™ä¸ªä¾‹å­è¿˜è¯´æ˜ï¼Œæ”¶é›†å™¨åœ¨æŸç§ç¨‹åº¦ä¸Šæ¯”Streamæ¥å£ä¸Šç›´æ¥æä¾›çš„æ–¹æ³•ç”¨èµ·æ¥æ›´å¤æ‚ï¼Œä½†å¥½å¤„åœ¨äºå®ƒä»¬èƒ½æä¾›æ›´é«˜æ°´å¹³çš„æŠ½è±¡å’Œæ¦‚æ‹¬ï¼Œä¹Ÿæ›´å®¹æ˜“é‡ç”¨å’Œè‡ªå®šä¹‰ã€‚

> joining æ›¿æ¢ å­—ç¬¦ä¸²ç›´æ¥æ‹¼æ¥

```java
    // è¯¥æ–¹æ¡ˆ æ•ˆç‡ä¸é«˜, æ‰€æœ‰å­—ç¬¦ä¸²è¢«åå¤è¿æ¥, æ¯æ¬¡è¿­ä»£éƒ½éœ€åˆ›å»ºæ–°Stringå¯¹è±¡
    strings.stream().sorted().reduce("", (a,b) -> a+b);
    // joining å†…éƒ¨ä¼šä½¿ç”¨ StringBuilder
    strings.stream().sorted().collect(Collectors.joining());
```

> åœºæ™¯: ä¸€ä¸ªå¯¹è±¡(å«æ—¶é—´å’Œæ•´æ•°ä¸¤ä¸ªå±æ€§)é›†åˆ, å®Œæˆçš„æ“ä½œæ˜¯è·å–åˆ°æœ€å¤§æ—¶é—´ä»¥åŠæ•°å€¼å¹³å‡å€¼...ç­‰ç­‰å¤šä¸ªå€¼
- [ ] è®¾è®¡å’Œå®ç°

#### åˆ†ç»„
ä¸€ä¸ªå¸¸è§çš„æ•°æ®åº“æ“ä½œæ˜¯æ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§å¯¹é›†åˆä¸­çš„é¡¹ç›®è¿›è¡Œåˆ†ç»„ã€‚

- ä½¿ç”¨ groupingBy `Map<Dish.Type, List<Dish>> dishesByType = menu.stream().collect(groupingBy(Dish::getType));`
    - groupingBy æ–¹æ³•çš„å…¥å‚ä¸ºä¸€ä¸ª Function ä¸€èˆ¬ç§°ä¸ºåˆ†ç±»å‡½æ•°

```java
    // å®ç°å¤æ‚çš„åˆ†ç±»å‡½æ•°
    public enum CaloricLevel { DIET, NORMAL, FAT } 
    Map<CaloricLevel, List<Dish>> dishesByCaloricLevel = menu.stream().collect( 
            groupingBy(dish -> { 
                if (dish.getCalories() <= 400){
                    return CaloricLevel.DIET; 
                } 
                else if (dish.getCalories() <= 700){ 
                    return CaloricLevel.NORMAL; 
                }else{
                    return CaloricLevel.FAT; 
                }
            })); 
```

##### å¤šçº§åˆ†ç»„
> è¦å®ç°å¤šçº§åˆ†ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç”±åŒå‚æ•°ç‰ˆæœ¬çš„ Collectors.groupingBy å·¥å‚æ–¹æ³•åˆ›å»ºçš„æ”¶é›†å™¨ï¼Œå®ƒé™¤äº†æ™®é€šçš„åˆ†ç±»å‡½æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¥å—collectorç±»å‹çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚

```java
    Map<Dish.Type, Map<CaloricLevel, List<Dish>>> dishesByTypeCaloricLevel = 
    menu.stream().collect( 
        groupingBy(Dish::getType,  
            groupingBy(dish -> {  
                if (dish.getCalories() <= 400){
                    return CaloricLevel.DIET; 
                }else if (dish.getCalories() <= 700) {
                    return CaloricLevel.NORMAL;
                }else{ 
                    return CaloricLevel.FAT; 
                }
            } ) 
        ) 
    ); 
```

##### æŒ‰å­ç»„æ”¶é›†æ•°æ®
> å¯ä»¥æŠŠç¬¬äºŒä¸ªgroupingByæ”¶é›†å™¨ä¼ é€’ç»™å¤–å±‚æ”¶é›†å™¨æ¥å®ç°å¤šçº§åˆ†ç»„ã€‚ä½†è¿›ä¸€æ­¥è¯´ï¼Œä¼ é€’ç»™ç¬¬ä¸€ä¸ªgroupingByçš„ç¬¬äºŒä¸ªæ”¶é›†å™¨å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ 
>> ä¾‹å¦‚: `Map<Dish.Type, Long> typesCount = menu.stream().collect(groupingBy(Dish::getType, counting())); `

```java
    Map<Dish.Type, Optional<Dish>> mostCaloricByType = menu.stream()
            .collect(groupingBy(
                Dish::getType,
                maxBy(
                    comparingInt(Dish::getCalories)
                )
            )); 
```
- è¿™ä¸ªåˆ†ç»„çš„ç»“æœæ˜¾ç„¶æ˜¯ä¸€ä¸ªmapï¼Œä»¥Dishçš„ç±»å‹ä½œä¸ºé”®ï¼Œä»¥åŒ…è£…äº†è¯¥ç±»å‹ä¸­çƒ­é‡æœ€é«˜çš„Dishçš„`Optional<Dish>`ä½œä¸ºå€¼
    - ä½†æ˜¯è¿™é‡Œçš„ Optional å­˜åœ¨çš„æ„ä¹‰ä¸å¤§, å› ä¸ºå…ˆæœ‰çš„ç±»å‹ è¿›è¡Œåˆ†ç»„, æ‰ä¼šè¿›è¡Œ maxBy æ‰€ä»¥å€¼æ˜¯ä¸€å®šå­˜åœ¨çš„

> 1. æŠŠæ”¶é›†å™¨çš„ç»“æœè½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹

å› ä¸ºå‰è¿°ä¾‹å­ä¸­çš„Optionalå­˜åœ¨æ„ä¹‰ä¸æ˜¯å¾ˆå¤§, æ‰€ä»¥ æŠŠæ”¶é›†å™¨è¿”å›çš„ç»“æœè½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨Collectors.collectingAndThenå·¥å‚æ–¹æ³•è¿”å›çš„æ”¶é›†å™¨

```java
    Map<Dish.Type, Dish> mostCaloricByType = menu.stream()
                .collect(groupingBy(
                    Dish::getType,
                    collectingAndThen(
                        maxBy(comparingInt(Dish::getCalories)),
                        Optional::get)
                    ));  
```
- è¿™ä¸ªå·¥å‚æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°â€”â€”è¦è½¬æ¢çš„æ”¶é›†å™¨ä»¥åŠè½¬æ¢å‡½æ•°ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªæ”¶é›†å™¨ã€‚
- è¿™ä¸ªæ”¶é›†å™¨ç›¸å½“äºæ—§æ”¶é›†å™¨çš„ä¸€ä¸ªåŒ…è£…ï¼Œcollectæ“ä½œçš„æœ€åä¸€æ­¥å°±æ˜¯å°†è¿”å›å€¼ç”¨è½¬æ¢å‡½æ•°åšä¸€ä¸ªæ˜ å°„ã€‚
- åœ¨è¿™é‡Œï¼Œè¢«åŒ…èµ·æ¥çš„æ”¶é›†å™¨å°±æ˜¯ç”¨maxByå»ºç«‹çš„é‚£ä¸ªï¼Œè€Œè½¬æ¢å‡½æ•°Optional::getåˆ™æŠŠè¿”å›çš„Optionalä¸­çš„å€¼æå–å‡ºæ¥ã€‚
- å‰é¢å·²ç»è¯´è¿‡ï¼Œè¿™ä¸ªæ“ä½œæ”¾åœ¨è¿™é‡Œæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºreducingæ”¶é›†å™¨æ°¸è¿œéƒ½ä¸ä¼šè¿”å›Optional.empty()ã€‚

> 2. ä¸ groupingBy è”åˆä½¿ç”¨çš„å…¶ä»–æ”¶é›†å™¨çš„ä¾‹å­

ä¸€èˆ¬æ¥è¯´ï¼Œé€šè¿‡groupingByå·¥å‚æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ”¶é›†å™¨å°†ä¼šå¯¹åˆ†åˆ°åŒä¸€ç»„ä¸­çš„æ‰€æœ‰æµå…ƒç´ æ‰§è¡Œè¿›ä¸€æ­¥å½’çº¦æ“ä½œã€‚
```java
    // å¯¹æ¯ä¸€ç»„Dishæ±‚å’Œ
    Map<Dish.Type, Integer> totalCaloriesByType = menu.stream().collect(groupingBy(Dish::getType, 
                summingInt(Dish::getCalories))); 
```
ç„¶è€Œå¸¸å¸¸å’ŒgroupingByè”åˆä½¿ç”¨çš„å¦ä¸€ä¸ªæ”¶é›†å™¨æ˜¯mappingæ–¹æ³•ç”Ÿæˆçš„ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå‡½æ•°å¯¹æµä¸­çš„å…ƒç´ åš**å˜æ¢**ï¼Œå¦ä¸€ä¸ªåˆ™å°†å˜æ¢çš„ç»“æœå¯¹è±¡**æ”¶é›†**èµ·æ¥ã€‚
å…¶ç›®çš„æ˜¯åœ¨ç´¯åŠ ä¹‹å‰å¯¹æ¯ä¸ªè¾“å…¥å…ƒç´ åº”ç”¨ä¸€ä¸ªæ˜ å°„å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥è®©æ¥å—ç‰¹å®šç±»å‹å…ƒç´ çš„æ”¶é›†å™¨é€‚åº”ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªæ”¶é›†å™¨çš„å®é™…ä¾‹å­ã€‚
æ¯”æ–¹è¯´ä½ æƒ³è¦çŸ¥é“ï¼Œå¯¹äºæ¯ç§ç±»å‹çš„Dishï¼Œèœå•ä¸­éƒ½æœ‰å“ªäº›CaloricLevelã€‚æˆ‘ä»¬å¯ä»¥æŠŠgroupingByå’Œmappingæ”¶é›†å™¨ç»“åˆèµ·æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```java
    Map<Dish.Type, Set<CaloricLevel>> caloricLevelsByType = menu.stream().collect( 
        groupingBy(Dish::getType, mapping(dish -> {
            if (dish.getCalories() <= 400) return CaloricLevel.DIET; 
            else if (dish.getCalories() <= 700) return CaloricLevel.NORMAL; 
            else return CaloricLevel.FAT; 
        }, toSet()))); 
```
è¿™é‡Œï¼Œå°±åƒæˆ‘ä»¬å‰é¢è§åˆ°è¿‡çš„ï¼Œä¼ é€’ç»™æ˜ å°„æ–¹æ³•çš„è½¬æ¢å‡½æ•°å°†Dishæ˜ å°„æˆäº†å®ƒçš„CaloricLevelï¼šç”Ÿæˆçš„CaloricLevelæµä¼ é€’ç»™ä¸€ä¸ªtoSetæ”¶é›†å™¨ï¼Œå®ƒå’ŒtoListç±»ä¼¼ï¼Œ
ä¸è¿‡æ˜¯æŠŠæµä¸­çš„å…ƒç´ ç´¯ç§¯åˆ°ä¸€ä¸ªSetè€Œä¸æ˜¯Listä¸­ï¼Œä»¥ä¾¿ä»…ä¿ç•™å„ä¸ç›¸åŒçš„å€¼ã€‚å¦‚å…ˆå‰çš„ç¤ºä¾‹æ‰€ç¤ºï¼Œè¿™ä¸ªæ˜ å°„æ”¶é›†å™¨å°†ä¼šæ”¶é›†åˆ†ç»„å‡½æ•°ç”Ÿæˆçš„å„ä¸ªå­æµä¸­çš„å…ƒç´ 
```java
    // å¯ä»¥ç»™å®ƒä¼ é€’ä¸€ä¸ªæ„é€ å‡½æ•°å¼•ç”¨æ¥è¦æ±‚ HashSet
    Map<Dish.Type, Set<CaloricLevel>> caloricLevelsByType = menu.stream().collect( 
        groupingBy(Dish::getType, mapping(dish -> { 
            if (dish.getCalories() <= 400) return CaloricLevel.DIET; 
            else if (dish.getCalories() <= 700) return CaloricLevel.NORMAL; 
            else return CaloricLevel.FAT; 
        }, toCollection(HashSet::new) )
        ));

    // å¯æŠ½è±¡å‡ºå·¥å…·æ–¹æ³•
    static <P, K, V> Map<K, Set<V>> groupToMapSet(Collection<P> params,
                                                  Function<P, K> keyFunc,
                                                  Function<P, V> valFunc) {
        if (CollectionUtils.isEmpty(params)) {
            return Collections.emptyMap();
        }
        return params.stream().collect(Collectors.groupingBy(keyFunc,
                Collectors.mapping(valFunc, Collectors.toCollection(HashSet::new))
        ));
    }
```

#### åˆ†åŒº

************************

### è‡ªå®šä¹‰ Collector
> [å‚è€ƒ: è‡ªå®šä¹‰æ”¶é›†å™¨æ·±åº¦å‰–æï¼š](http://www.cnblogs.com/webor2006/p/8353314.html)

java.util.stream.Collector

- creation of a new result container (supplier())
- incorporating a new data element into a result container (accumulator())
- combining two result containers into one (combiner())
- performing an optional final transform on the container (finisher())

```java
    // toListå®ç°
    public static <T> Collector<T, ?, List<T>> toList() {
        return new CollectorImpl<>(ArrayList::new, // supplier
                                   List::add, // accumulator
                                   (left, right) -> { left.addAll(right); return left; }, // combiner
                                   CH_ID);
    }
    // toMap å®ç°
    public static <T, K, U, M extends Map<K, U>> Collector<T, ?, M> toMap(Function<? super T, ? extends K> keyMapper,
                             Function<? super T, ? extends U> valueMapper,
                             BinaryOperator<U> mergeFunction,
                             Supplier<M> mapFactory) {
        BiConsumer<M, T> accumulator = (map, element) -> map.merge(keyMapper.apply(element), valueMapper.apply(element), mergeFunction);
        return new CollectorImpl<>(mapFactory, // supplier
                                    accumulator, // accumulator
                                    mapMerger(mergeFunction), // combiner
                                    CH_ID);
    }
    // toUnmodifiableSet JDK10
    public static <T> Collector<T, ?, Set<T>> toUnmodifiableSet() {
        return new CollectorImpl<>(HashSet::new, // supplier
                                    Set::add, // accumulator
                                   (left, right) -> {
                                       if (left.size() < right.size()) {
                                           right.addAll(left); return right;
                                       } else {
                                           left.addAll(right); return left;
                                       }
                                   },// combiner 
                                   // å…¶ä¸­è¿˜åŒ…å«ä¸€ä¸ªå°ä¼˜åŒ–ï¼Œåªå¾€å¤§é›†åˆä¸­è¿½åŠ å°é›†åˆï¼Œé™ä½æ’å…¥è¿ç®—æ¬¡æ•°ï¼ˆhash æ‰©å®¹çš„æˆæœ¬ï¼‰
                                   // è€ŒtoListä¸éœ€è¦æ˜¯å› ä¸ºç›´æ¥æ“ä½œçš„æ•°ç»„å†…å­˜å¤åˆ¶ å¤§å°é›†åˆæ²¡åŒºåˆ«
                                   set -> (Set<T>)Set.of(set.toArray()), // finisher
                                   CH_UNORDERED_NOID);
    }

    CollectorImpl(Supplier<A> supplier,
                BiConsumer<A, T> accumulator,
                BinaryOperator<A> combiner,
                Set<Characteristics> characteristics) {
        this(supplier, accumulator, combiner, castingIdentity(), characteristics);
    }
    // finish ç©ºå®ç° åªåšç±»å‹å¼ºè½¬
    private static <I, R> Function<I, R> castingIdentity() {
        return i -> (R) i;
    }
```

************************

# Optional
>1. nullå¼•ç”¨åœ¨å†å²ä¸Šè¢«å¼•å…¥åˆ°ç¨‹åºè®¾è®¡è¯­è¨€ä¸­ï¼Œç›®çš„æ˜¯ä¸ºäº†è¡¨ç¤ºå˜é‡å€¼çš„ç¼ºå¤±ã€‚
>1. Java 8ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç±»`java.util.Optional<T>`ï¼Œå¯¹å­˜åœ¨æˆ–ç¼ºå¤±çš„å˜é‡å€¼è¿›è¡Œå»ºæ¨¡ã€‚
>1. ä½ å¯ä»¥ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•Optional.emptyã€ Optional.ofä»¥åŠOptional.ofNullableåˆ›å»ºOptionalå¯¹è±¡ã€‚
>1. Optionalç±»æ”¯æŒå¤šç§æ–¹æ³•ï¼Œæ¯”å¦‚mapã€ flatMapã€ filterï¼Œå®ƒä»¬åœ¨æ¦‚å¿µä¸Šä¸Streamç±»ä¸­å¯¹åº”çš„æ–¹æ³•ååˆ†ç›¸ä¼¼ã€‚
>1. ä½¿ç”¨Optionalä¼šè¿«ä½¿ä½ æ›´ç§¯æåœ°è§£å¼•ç”¨Optionalå¯¹è±¡ï¼Œä»¥åº”å¯¹å˜é‡å€¼ç¼ºå¤±çš„é—®é¢˜ï¼Œæœ€ç»ˆï¼Œä½ èƒ½æ›´æœ‰æ•ˆåœ°é˜²æ­¢ä»£ç ä¸­å‡ºç°ä¸æœŸè€Œè‡³çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚
>1. ä½¿ç”¨Optionalèƒ½å¸®åŠ©ä½ è®¾è®¡æ›´å¥½çš„APIï¼Œç”¨æˆ·åªéœ€è¦é˜…è¯»æ–¹æ³•ç­¾åï¼Œå°±èƒ½äº†è§£è¯¥æ–¹æ³•æ˜¯å¦æ¥å—ä¸€ä¸ªOptionalç±»å‹çš„å€¼ã€‚

1. èƒ½å¤Ÿæ˜¾å¼çš„åœ¨æ–¹æ³•ç­¾åä¸Šå°±è¡¨æ˜è¿”å›å€¼å¯èƒ½ä¸º "ç©º" (ä¸‹æ–‡ä¸­çš„ç©ºéƒ½æŒ‡ Optional.empty())
    - å¢å¼ºäº†å»ºæ¨¡çš„è¡¨è¾¾èƒ½åŠ› åŸŸæ¨¡å‹ä¸­ä½¿ç”¨Optionalï¼Œå°†å…è®¸ç¼ºå¤±æˆ–è€…æš‚æ— å®šä¹‰çš„å˜é‡å€¼ç”¨ç‰¹æ®Šçš„å½¢å¼æ ‡è®°å‡ºæ¥
    - çº¦æŸè°ƒç”¨æ–¹éœ€åˆ¤æ–­æ‰èƒ½ä½¿ç”¨, ä½†æ˜¯è¿™ä¸ªå¹¶ä¸æ˜¯ä¸‡èƒ½çš„, ä¾‹å¦‚é›†åˆç±»å‹çš„è¿”å›çš„æ—¶å€™, å°±ä¸ç”¨ Optional åŒ…ä½ æ˜¾å¾—ç¹ç, ç›´æ¥è¿”å› new ç©ºé›†åˆå³å¯
1. å¦‚æœOptionalçº¦æŸäº†è¿”å›å€¼, å°±åœ¨è¯­ä¹‰ä¸Šè¡¨æ˜è¯¥æ–¹æ³•çš„è¿”å›å€¼å¯èƒ½ä¸ºç©º, å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯åˆå§‹åŒ–æ–¹æ³•ç­‰å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„æ–¹æ³•, ä¸èƒ½è¿”å›ç©º, é‚£å°±ä¸èƒ½ä½¿ç”¨Optional
    - è¿™æ ·è™½ç„¶ä»£ç å®‰å…¨äº†, ä½†æ˜¯å°†è¯¥æ–¹æ³•çš„è¯­ä¹‰æ··æ·†äº†.æ‰€ä»¥ ä¸ä»…ä¸èƒ½ç”¨ Optional, è¿˜éœ€åœ¨æ–¹æ³•ä¸­åŠ ä¸Š æ–­è¨€ ä»¥å°½æ—©æš´éœ²è¯¥æ–¹æ³•çš„å¼‚å¸¸
    - è™½ç„¶è¯¥æ–¹æ³•åœ¨è®¾è®¡ä¸Šæ˜¯ä¸èƒ½è¿”å›ç©º, ä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½è¿”å›ç©º, ä¸ºäº†å¥å£®æ€§, è¿˜æ˜¯éœ€è¦è°ƒç”¨æ–¹åšéç©ºæ£€æŸ¥

- å¸¸ç”¨æ–¹æ³•
    - `of(T value)` å°è£…å¯¹è±¡åˆ°Optionalå†…éƒ¨, è‹¥å¯¹è±¡ä¸ºnullä¼šç«‹å³æŠ›å‡º NPE
    - `ofNullable(T value)` åŒä¸Šä½†æ˜¯å…è®¸æ”¾å…¥null
    - `get()` è·å–å°è£…å†…çš„å¯¹è±¡å€¼, ä½†æ˜¯è‹¥Optionalä¸ºç©º æŠ›å‡º NoSuchElementException å¼‚å¸¸
    - `orElse(T other)` å½“Optionalä¸ºç©ºæ—¶æä¾›é»˜è®¤å€¼
    - `orElseGet(Supplier<? extends T> other)` å»¶è¿Ÿæä¾›é»˜è®¤å€¼, å½“ä¸ºç©ºæ‰§è¡Œä¼ å…¥çš„å‡½æ•°å¾—åˆ°é»˜è®¤å€¼
    - `orElseThrow(Supplier<? extends X> exceptionSupplier)` ä¸ get() ä¸€è‡´,ä½†æ˜¯å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸
    - `ifPresent(Consumer<? super T>)` å½“ä¸ä¸ºç©ºæ‰§è¡Œä¼ å…¥çš„å‡½æ•°

## Optionalç±»å’ŒStreamæ¥å£çš„ç›¸ä¼¼ä¹‹å¤„
1. *map*
    1. ä½¿ç”¨ map ä» Optional å¯¹è±¡ä¸­æå–å’Œè½¬æ¢å€¼: å¯ä»¥å°† Optional çœ‹æˆåªæœ‰ä¸€ä¸ªå…ƒç´ çš„é›†åˆ, åƒStreamä¸€æ ·çš„ä½¿ç”¨ map
    1. å¤„ç†ä¸¤ä¸ªOptionalå¯¹è±¡: `person.flatMap(p -> car.map(c -> findCheapestInsurance(p, c)));` åŸå§‹çš„å†™æ³•å°±æ˜¯è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡åŒæ—¶å­˜åœ¨(person å’Œ car )æ‰è°ƒç”¨find...æ–¹æ³•

1. *flatMap*
    1. æµå¼è·å– Optional çº¦æŸçš„å±æ€§ `Optional<String> name = a.flatMap(A::getB).flatMap(B::getC).map(C::getName)`
    - å…¶ä¸­ `Optional<C> c;` æ˜¯Bçš„æˆå‘˜å±æ€§ `Optional<B> b;` æ˜¯Açš„æˆå‘˜å±æ€§
    - å¦‚æœç›´æ¥ä½¿ç”¨ map å°±ä¼šå‘ç”Ÿ `Optional<Optional<T>>` åµŒå¥—, æ‰€ä»¥éœ€è¦ä½¿ç”¨ flatMap 

1. *filter* 
    1. persion å­˜åœ¨ä¸”æ»¡è¶³æ¡ä»¶å°±è¿”å›è‡ªèº«å¦åˆ™è¿”å›ç©º `person.filter(o -> "name".equals(o.getName()))`

************************

1. **æ³¨æ„**: *Optional æ— æ³•åºåˆ—åŒ–*, ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä½œä¸º PO çš„å­—æ®µ, ä½†æ˜¯å¯ä»¥åœ¨getä¸Šä¸‹åŠŸå¤«: `public Optional<String> getName(){return this.name}`

1. å¼‚å¸¸ä¸Optionalçš„å¯¹æ¯”
    - å½“ä¸€ä¸ªæ–¹æ³•ç”±äºæŸäº›åŸå› æ— æ³•è¿”å›æœŸæœ›å€¼, å¸¸è§çš„åšæ³•æ˜¯æŠ›å‡ºå¼‚å¸¸, æˆ–è€…è¿”å›null(ä¸å»ºè®®). ä½†æ˜¯è¿™æ—¶å€™å¤šäº†ä¸€ä¸ªé€‰æ‹©, è¿”å›Optional
    - ä¾‹å¦‚ Integer.parseInt() æ–¹æ³• è‹¥å‚æ•°å­—ç¬¦ä¸²ä¸åˆæ³•å°±ä¼šæŠ›å‡ºå¼‚å¸¸, è¿™æ—¶å€™å°±å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªå·¥å…·æ–¹æ³•, catchä½å¼‚å¸¸ è¿”å› ç©º (å¦‚ä¸‹ stringToInt æ–¹æ³•)

1. åº”è¯¥é¿å…ä½¿ç”¨ä½¿ç”¨åŸºç¡€ç±»å‹çš„ Optional å¯¹è±¡
    - OptionalInt OptionalLong OptionalDouble, å› ä¸ºä»–ä»¬ä¸æ”¯æŒ Stream æ“ä½œ
    - å³ä½¿ OptionalInt èƒ½ç®€åŒ– Optional<Integer>

## å®è·µ:è¯»å–PropertiesæŸå±æ€§
> ä»propertiesæ–‡ä»¶ä¸­è¯»å–æŸä¸ªå±æ€§, æ­£æ•´æ•°å°±è¿”å›è¯¥å€¼, å¦åˆ™è¿”å›0  

```java
    // åŸå§‹å†™æ³•
    public int readDuration(Properties props, String name) {
        String value = props.getProperty(name);
        if (value != null) {
            try {
                int i = Integer.parseInt(value);
                if (i > 0) {
                    return i;
                }
            } catch (NumberFormatException nfe) { }
        }
        return 0;
    }
    // æ”¹è¿›
    public static Optional<Integer> stringToInt(String s) {
        try {
            return Optional.of(Integer.parseInt(s));
        } catch (NumberFormatException e) {
            return Optional.empty();
        }
    }

    public int readDuration(Properties props, String name) {
        return Optional.ofNullable(props.getProperty(name))
            .flatMap(OptionalUtility::stringToInt)
            .filter(i -> i > 0)
            .orElse(0);
    }
```

*******************************

# æ—¶é—´å¤„ç†

1. SimpleDateFormat `yyyy-MM-dd HH:MM:SS` ä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨, Java8 å¯ä½¿ç”¨ `DateTimeFormatter` ä¾‹å¦‚ DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss.SSS")

## ZoneId
>  time-zone ID

## Clock
> å…·æœ‰æ—¶åŒºä¿¡æ¯çš„æ—¶é—´ç±»

a clock can be used instead of System.currentTimeMillis() and TimeZone.getDefault(). 

## Duration
This class models a quantity or amount of time in terms of seconds and nanoseconds.   
It can be accessed using other duration-based units, such as minutes and hours.

> [How to model java.time.duration in Mysql Database](https://stackoverflow.com/questions/28427525/how-to-model-java-time-duration-in-mysql-database)

## Period
> ç±»ä¼¼äºDuration, ä¸åŒç‚¹æ˜¯ date-based 

## Instant 
> ç”¨äºè¡¨ç¤ºæ—¶é—´çº¿ä¸Šçš„ä¸€ä¸ªç¬æ—¶ç‚¹, å¯ç”¨äºè¡¨ç¤ºæ—¶é—´æˆ³, APIæ“ä½œæ›´å‹å¥½

## LocalDateTime
> æ–¹ä¾¿çš„æ–°æ—¶é—´å¤„ç†ç±», ç”¨äºæ›¿ä»£Java5çš„Date, LocalDateTime å°±æ˜¯ LocalDate LocalTime çš„ç»„åˆ

```java
    // LocalDateTime è·å–æ¯«ç§’ä»¥åŠç§’  ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šä¸­å›½çš„æ—¶åŒº ZoneOffset.of("+8")
    ZonedDateTime zonedDateTime = datetime.atZone(ZoneOffset.systemDefault());
    Instant instant = zonedDateTime.toInstant();
    Date date = Date.from(instant);
    
    // LocalDateTime -> Date
    Date.from(datetime.atZone(ZoneId.systemDefault()).toInstant());
    // Date -> LocalDateTime 
    LocalDateTime.ofInstant(date.toInstant(), ZoneOffset.systemDefault());

    // æ ¼å¼åŒ–
    DateTimeFormatter fmt = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
    fmt.format(LocalDateTime.now());
    // è§£æ
    LocalDateTime parse = LocalDateTime.parse(timeStr, fmt);
```

### LocalDate
- è·å–è‡ªç„¶å‘¨å¼€å§‹æ—¶é—´ `LocalDate.now().with(WeekFields.ISO.dayOfWeek(), 1L);`

```java
    // å¸¸è§æ ¼å¼
    DateTimeFormatter format = DateTimeFormatter.ofPattern("yyyyMMdd");
    LocalDate parse = LocalDate.parse("20171018", format);

    // æ ¼å¼ä¸å…¨æ—¶ï¼ˆå¹´æœˆæ—¥ï¼‰éœ€ç‰¹æ®Šå¤„ç† è¡¥å…¨å¯¹åº”é»˜è®¤å€¼
    DateTimeFormatter monthFMT = new DateTimeFormatterBuilder()
                        .appendPattern("yyyy")
                        .parseDefaulting(ChronoField.MONTH_OF_YEAR, 1)
                        .parseDefaulting(ChronoField.DAY_OF_MONTH, 1)
                        .toFormatter();
    LocalDate parse = LocalDate.parse("2017", monthFMT);
```

### LocalTime

## ZoneOffset
æ—¶åŒºåç§»é‡ï¼Œæ¯”å¦‚ï¼š+8:00

## ZonedDateTime
å¸¦æ—¶åŒºçš„æ—¶é—´

## Clock
> [Guide to the Java Clock Class](https://www.baeldung.com/java-clock)  

